# data = read_ascii('../xafsdata/fe2o3_rt1.xmu', labels='energy mu i0')
# data = read_ascii('../xafsdata/cu_metal_rt.xdi', labels='energy i0 i1 mu')
data = read_ascii('../xafsdata/pt_metal_rt.xdi', labels='energy time i1 i0')
data.mu = -log(data.i1 / data.i0)

# data = read_gsexdi('../xafsdata/cu_fluor.xdi')
# data.mu = data.mufluor

TEST_CONVOLVE = False

pre_edge(data)
esigma = core_width('Cu', edge='K')
esigma = core_width('Pt', edge='L3')

xas_deconvolve(data, esigma=esigma, smooth=True)

plot_mu(data, show_norm=True, emin=-50, emax=250)
plot(data.energy, data.deconv, label='deconvolved')

## xas_deconvolve(data, esigma=esigma, smooth=True, form='gaussian')
## data.deconv_gauss = data.deconv
## plot(data.energy, data.deconv_gauss, label='deconv (gaussian)')

if TEST_CONVOLVE:
    test = group(energy=data.energy, norm=data.deconv)
    xas_convolve(test, esigma=esigma)
    plot_mu(data, show_norm=True, emin=-50, emax=250, win=2)
    plot(test.energy, test.conv, label='reconvolved', win=2)
    plot(test.energy, 100*(test.conv-data.norm),
         label='(reconvolved - mu)x100', win=2)
#endif
