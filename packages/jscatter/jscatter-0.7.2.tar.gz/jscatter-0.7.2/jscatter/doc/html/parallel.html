
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>10. parallel &#8212; jscatter 0.7.2 documentation</title>
    <link rel="stylesheet" href="_static//default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.7.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/Jscatter-32x-32.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="11. graceplot" href="GracePlot.html" />
    <link rel="prev" title="9. dls" href="dls.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="GracePlot.html" title="11. graceplot"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="dls.html" title="9. dls"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">jscatter 0.7.2 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="parallel">
<h1>10. parallel<a class="headerlink" href="#parallel" title="Permalink to this headline">¶</a></h1>
<p>Functions for parallel computations on a single multi core machine using the standard library multiprocessing.</p>
<p>Not the programming details, but the way how to speed up some things.</p>
<p>This is no magic and just for convenience for non specialist of parallel computing.
The main thing is to pass additional parameters to the processes (a pool of workers)
and loop only over one parameter in the list to loop over. Opening and closing of the pool is hidden in the function.
In this way we can use a multicore machine with all cpus.</p>
<p>In some test i found that shared memory (sharedmemory ala Sturla Molden) does not really speed up,
if we just want to calculate a function e.g. for a list of different Q values.
Here the pickling of numpy arrays is efficient enough compared to the computation we do.
We use here only non modified input data and return a new dataset , so we dont need to care about 
what happens if one process changes the data needed in another process (race conditions,…).
Please keep in mind and dont complain if you modify input data.</p>
<ul class="simple">
<li>If your computation is faster than the communication (pickling and sending of data) then you dont need this module.</li>
<li>If you want to use a cluster with all cpus, this is not the way.</li>
</ul>
<p>For easier debugging (to find the position of an error in the pdb debugger) use the option debug.
In this case the multiprocessing is not used and the debugger finds the error correctly.</p>
<hr class="docutils" />
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#jscatter.parallel.doForList" title="jscatter.parallel.doForList"><code class="xref py py-obj docutils literal"><span class="pre">doForList</span></code></a>(funktion,&nbsp;looplist,&nbsp;*args,&nbsp;**kwargs)</td>
<td>Calculates function for values in looplist in a pool of workers in parallel usinf multiprocessing.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#jscatter.parallel.doForQlist" title="jscatter.parallel.doForQlist"><code class="xref py py-obj docutils literal"><span class="pre">doForQlist</span></code></a>(funktion,&nbsp;qList,&nbsp;*args,&nbsp;**kwargs)</td>
<td>Calculates for qlist the function in a pool of workers using multiprocessing.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#jscatter.parallel.psphereAverage" title="jscatter.parallel.psphereAverage"><code class="xref py py-obj docutils literal"><span class="pre">psphereAverage</span></code></a>(funktion[,&nbsp;relError])</td>
<td>Parallel evaluation of spherical average of function.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#jscatter.parallel.randomPointsN" title="jscatter.parallel.randomPointsN"><code class="xref py py-obj docutils literal"><span class="pre">randomPointsN</span></code></a>(NN[,&nbsp;r])</td>
<td>N nearly random points on sphere of radius r based on golden ratio.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#jscatter.parallel.rphitheta2xyz" title="jscatter.parallel.rphitheta2xyz"><code class="xref py py-obj docutils literal"><span class="pre">rphitheta2xyz</span></code></a>(RPT)</td>
<td>Transformation  spherical coordinates [r,phi,theta]  to cartesian coordinates [x,y,z]</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#jscatter.parallel.fibonacciLatticePointsOnSphere" title="jscatter.parallel.fibonacciLatticePointsOnSphere"><code class="xref py py-obj docutils literal"><span class="pre">fibonacciLatticePointsOnSphere</span></code></a>(NN[,&nbsp;r])</td>
<td>Fibonacci lattice points on a sphere with radius r (default r=1)</td>
</tr>
</tbody>
</table>
<hr class="docutils" />
<span class="target" id="module-jscatter.parallel"></span><p>Functions for parallel computations on a single multi core machine using the standard library multiprocessing.</p>
<p>Not the programming details, but the way how to speed up some things.</p>
<p>This is no magic and just for convenience for non specialist of parallel computing.
The main thing is to pass additional parameters to the processes (a pool of workers)
and loop only over one parameter in the list to loop over. Opening and closing of the pool is hidden in the function.
In this way we can use a multicore machine with all cpus.</p>
<p>In some test i found that shared memory (sharedmemory ala Sturla Molden) does not really speed up,
if we just want to calculate a function e.g. for a list of different Q values.
Here the pickling of numpy arrays is efficient enough compared to the computation we do.
We use here only non modified input data and return a new dataset , so we dont need to care about 
what happens if one process changes the data needed in another process (race conditions,…).
Please keep in mind and dont complain if you modify input data.</p>
<ul class="simple">
<li>If your computation is faster than the communication (pickling and sending of data) then you dont need this module.</li>
<li>If you want to use a cluster with all cpus, this is not the way.</li>
</ul>
<p>For easier debugging (to find the position of an error in the pdb debugger) use the option debug.
In this case the multiprocessing is not used and the debugger finds the error correctly.</p>
<dl class="function">
<dt id="jscatter.parallel.doForList">
<code class="descclassname">jscatter.parallel.</code><code class="descname">doForList</code><span class="sig-paren">(</span><em>funktion</em>, <em>looplist</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/jscatter/parallel.html#doForList"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#jscatter.parallel.doForList" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates function for values in looplist in a pool of workers in parallel usinf multiprocessing.</p>
<p>Like multiprocessing map_async but distributes automatically all given arguments.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>funktion</strong> : function</p>
<blockquote>
<div><p>Function to process with arguments (looplist[i],args,kwargs)
Return value of function should contain parameters or at least the loopover value to allow a check, if desired.</p>
</div></blockquote>
<p><strong>looplist</strong> : list</p>
<blockquote>
<div><p>List of values to loop over.</p>
</div></blockquote>
<p><strong>loopover</strong> : string, int,default= Not given</p>
<blockquote>
<div><p>Name of argument to use for looping over with values in looplist.
If not given the first argument is used, which should be not included as argument.</p>
</div></blockquote>
<p><strong>ncpu</strong> : int, optional</p>
<blockquote>
<div><div class="line-block">
<div class="line">number of cpus in the pool</div>
<div class="line">not given or 0   -&gt; all cpus are used</div>
<div class="line">int&gt;0      min (ncpu, mp.cpu_count)</div>
<div class="line">int&lt;0      ncpu not to use</div>
</div>
</div></blockquote>
<p><strong>cb</strong> : None, function</p>
<blockquote>
<div><p>Callback after each calculation.</p>
</div></blockquote>
<p><strong>debug</strong> : int</p>
<blockquote>
<div><p>debug &gt; 0 allows serial output for testing</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>list</strong> : list of function return values as  [result1,result2,…..]</p>
<blockquote class="last">
<div><p>The order of return values is not explicitly synced to looplist.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>The return array of function may be prepended with the value looplist[i] as reference.
E.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">c</span><span class="o">+</span><span class="n">d</span><span class="p">]</span>
</pre></div>
</div>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
   <span class="n">res</span><span class="o">=</span><span class="n">x</span><span class="o">+</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">c</span><span class="o">+</span><span class="n">d</span>
   <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">res</span><span class="p">]</span>
<span class="c1"># loop over first argument, here x</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">js</span><span class="o">.</span><span class="n">parallel</span><span class="o">.</span><span class="n">doForList</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">looplist</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="c1"># loop over &#39;d&#39; ignoring the given d=11 (which can be omitted here)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">js</span><span class="o">.</span><span class="n">parallel</span><span class="o">.</span><span class="n">doForList</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">looplist</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="n">loopover</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="jscatter.parallel.doForQlist">
<code class="descclassname">jscatter.parallel.</code><code class="descname">doForQlist</code><span class="sig-paren">(</span><em>funktion</em>, <em>qList</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/jscatter/parallel.html#doForQlist"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#jscatter.parallel.doForQlist" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates for qlist the function in a pool of workers using multiprocessing.</p>
<p>Calcs [function(Qi, <a href="#id1"><span class="problematic" id="id2">*</span></a>args, <a href="#id3"><span class="problematic" id="id4">**</span></a>kwargs) for Qi in qlist ] in parallel.
The return value of function will contain the value Qi as reference.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>funktion</strong> : function</p>
<blockquote>
<div><p>Function to process with arguments (looplist[i],args,kwargs)</p>
</div></blockquote>
<p><strong>qList</strong> : list</p>
<blockquote>
<div><p>List of values for first argument in function.
qList value prepends the arguments args.</p>
</div></blockquote>
<p><strong>ncpu</strong> : int, optional</p>
<blockquote>
<div><div class="line-block">
<div class="line">number of cpus in the pool</div>
<div class="line">not given or 0   -&gt; all cpus are used</div>
<div class="line">int&gt;0      min (ncpu, mp.cpu_count)</div>
<div class="line">int&lt;0      ncpu not to use</div>
</div>
</div></blockquote>
<p><strong>cb :function, optional</strong></p>
<blockquote>
<div><p>Callback after each calculation</p>
</div></blockquote>
<p><strong>debug</strong> : int</p>
<blockquote>
<div><p>debug &gt; 0 allows serial output for testing</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>list</strong> : ndim function_return.ndim+1</p>
<blockquote class="last">
<div><p>The list elements will be prepended with the value qlist[i] as reference.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
   <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">c</span><span class="o">+</span><span class="n">d</span><span class="p">]</span>
<span class="c1"># loop over first argument here x</span>
<span class="n">js</span><span class="o">.</span><span class="n">parallel</span><span class="o">.</span><span class="n">doForList</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">Qlist</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="jscatter.parallel.fibonacciLatticePointsOnSphere">
<code class="descclassname">jscatter.parallel.</code><code class="descname">fibonacciLatticePointsOnSphere</code><span class="sig-paren">(</span><em>NN</em>, <em>r=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/jscatter/parallel.html#fibonacciLatticePointsOnSphere"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#jscatter.parallel.fibonacciLatticePointsOnSphere" title="Permalink to this definition">¶</a></dt>
<dd><p>Fibonacci lattice points on a sphere with radius r (default r=1)</p>
<p>This can be used to integrate efficiently over a sphere with well distributed points.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>NN</strong> : integer</p>
<blockquote>
<div><p>number of points = 2*N+1</p>
</div></blockquote>
<p><strong>r</strong> : float, default 1</p>
<blockquote>
<div><p>radius of sphere</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">list of [r,phi,theta]  pairs in radians</p>
<blockquote class="last">
<div><p>phi  azimuth -pi&lt;phi&lt;pi; theta polar angle  0&lt;theta&lt;pi</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<p class="rubric">References</p>
<table class="docutils citation" frame="void" id="r183" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[R183]</a></td><td>Measurement of Areas on a Sphere Using Fibonacci and Latitude–Longitude Lattices
Á. González Mathematical Geosciences 42, 49-64 (2009)</td></tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jscatter</span> <span class="k">as</span> <span class="nn">js</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="k">import</span> <span class="n">Axes3D</span>
<span class="n">points</span><span class="o">=</span><span class="n">js</span><span class="o">.</span><span class="n">formel</span><span class="o">.</span><span class="n">fibonacciLatticePointsOnSphere</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">pp</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">points</span><span class="p">))</span>
<span class="n">pxyz</span><span class="o">=</span><span class="n">js</span><span class="o">.</span><span class="n">formel</span><span class="o">.</span><span class="n">rphitheta2xyz</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pxyz</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">pxyz</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">pxyz</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">points</span><span class="o">=</span><span class="n">js</span><span class="o">.</span><span class="n">formel</span><span class="o">.</span><span class="n">fibonacciLatticePointsOnSphere</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">pp</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">,</span><span class="n">points</span><span class="p">))</span>
<span class="n">v</span><span class="o">=</span><span class="n">js</span><span class="o">.</span><span class="n">formel</span><span class="o">.</span><span class="n">rphitheta2xyz</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span>
<span class="n">R</span><span class="o">=</span><span class="n">js</span><span class="o">.</span><span class="n">formel</span><span class="o">.</span><span class="n">rotationMatrix</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">))</span>
<span class="n">pxyz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">v</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="c1">#points in polar coordinates</span>
<span class="n">prpt</span><span class="o">=</span><span class="n">js</span><span class="o">.</span><span class="n">formel</span><span class="o">.</span><span class="n">xyz2rphitheta</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">pxyz</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pxyz</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">pxyz</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">pxyz</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="jscatter.parallel.psphereAverage">
<code class="descclassname">jscatter.parallel.</code><code class="descname">psphereAverage</code><span class="sig-paren">(</span><em>funktion</em>, <em>relError=300</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/jscatter/parallel.html#psphereAverage"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#jscatter.parallel.psphereAverage" title="Permalink to this definition">¶</a></dt>
<dd><p>Parallel evaluation of spherical average of function.</p>
<p>A fibonacci lattice on sphere is used.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>funktion</strong> : function</p>
<blockquote>
<div><p>function to evaluate
function first argument gets cartesian coordinate [x,y,z] of point on unit sphere</p>
</div></blockquote>
<p><strong>relError</strong> : float, default 300</p>
<blockquote>
<div><div class="line-block">
<div class="line">determines how points on sphere are selected</div>
<div class="line">&gt;1  Fibonacci Lattice with relError*2+1 points</div>
<div class="line">&lt;1  random points on sphere (Monte Carlo integration)</div>
<div class="line-block">
<div class="line">stops if error is below relError</div>
<div class="line">Error is (stddev of N points) /(mean of N points)/sqrt(N)</div>
</div>
</div>
</div></blockquote>
<p><strong>arg,kwargs :</strong></p>
<blockquote>
<div><p>forwarded to function</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">array like with values from function and appended error</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul class="simple">
<li>Works also on single core machines.</li>
<li>For integration over a continous function as a form factor in scattering the random points are not statistically
independent. Think of neigbouring points on an isosurface which are correlated and therefore the standard deviation is biased..
In this case the Fibonacci lattice is the better choice as the standard deviation in a random sample is not a measure of error
but more a measure of the differneces on the isosurface.</li>
</ul>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
   <span class="k">return</span> <span class="p">[</span><span class="n">js</span><span class="o">.</span><span class="n">formel</span><span class="o">.</span><span class="n">xyz2rphitheta</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">*</span><span class="n">r</span><span class="p">]</span>
<span class="n">js</span><span class="o">.</span><span class="n">parallel</span><span class="o">.</span><span class="n">psphereAverage</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">relError</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="jscatter.parallel.randomPointsN">
<code class="descclassname">jscatter.parallel.</code><code class="descname">randomPointsN</code><span class="sig-paren">(</span><em>NN</em>, <em>r=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/jscatter/parallel.html#randomPointsN"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#jscatter.parallel.randomPointsN" title="Permalink to this definition">¶</a></dt>
<dd><p>N nearly random points on sphere of radius r based on golden ratio.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>NN</strong> : int</p>
<blockquote>
<div><p>number of points</p>
</div></blockquote>
<p><strong>r</strong> : float</p>
<blockquote>
<div><p>radius of sphere</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">array of [r,phi,theta]  pairs in radians</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="jscatter.parallel.rphitheta2xyz">
<code class="descclassname">jscatter.parallel.</code><code class="descname">rphitheta2xyz</code><span class="sig-paren">(</span><em>RPT</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/jscatter/parallel.html#rphitheta2xyz"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#jscatter.parallel.rphitheta2xyz" title="Permalink to this definition">¶</a></dt>
<dd><p>Transformation  spherical coordinates [r,phi,theta]  to cartesian coordinates [x,y,z]</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>RPT</strong> : array Nx3</p>
<blockquote>
<div><div class="line-block">
<div class="line">dim Nx3 with [r,phi,theta] coordinates</div>
<div class="line">r     : float       length</div>
<div class="line">phi   : float   azimuth     -pi &lt; phi &lt; pi</div>
<div class="line">theta : float   polar angle  0 &lt; theta  &lt; pi</div>
</div>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Array with same dimmension as RPT.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/Jscatter1.gif" alt="Logo"/>
            </a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="dls.html"
                        title="previous chapter">9. dls</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="GracePlot.html"
                        title="next chapter">11. graceplot</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/parallel.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="GracePlot.html" title="11. graceplot"
             >next</a> |</li>
        <li class="right" >
          <a href="dls.html" title="9. dls"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">jscatter 0.7.2 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, Ralf Biehl.
      Last updated on Mar 27, 2018.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.6.
    </div>
  </body>
</html>