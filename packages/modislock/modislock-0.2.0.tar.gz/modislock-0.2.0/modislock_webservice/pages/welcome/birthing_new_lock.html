<!doctype html>
<html>
<head>
    <title>Modis Lock Restarting</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="Administration for Modis Cloud Lock">
    <meta name="author" content="Modis GmbH">
    <meta name="theme-color" content="#ffffff">
    <link sizes="180x180" rel="apple-touch-icon" href={{ url_for('static', filename='img/apple-touch-icon.png') }}/>
    <link sizes="32x32" type="image/png" rel="icon" href={{ url_for('static', filename='img/favicon-32x32.png') }}/>
    <link sizes="16x16" type="image/png" rel="icon" href={{ url_for('static', filename='img/favicon-16x16.png') }}/>
    <link rel="manifest" href={{ url_for('static', filename='img/manifest.json') }}/>
    <link rel="mask-icon" href={{ url_for('static', filename='img/safari-pinned-tab.svg') }}/>
    {% assets 'layout_css' %}
        <link rel="stylesheet" href="{{ ASSET_URL }}">
    {% endassets %}
</head>
<body class="gray-bg">
<div class="middle-box text-center animated fadeInDown">
    <div class="row">
        <div class="col-sm-12 col-mg-12 col-lg-12">
            <div class="ibox ">
                <div class="ibox-title">
                    <h5>System Applying New Settings</h5>
                </div>
                <div class="ibox-content">
                    <div class="spiner-example">
                        <div class="sk-spinner sk-spinner-cube-grid">
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                        </div>
                    </div>
                    <p class="text-warning" id="upg_warning" style="display: none">An internal Error has occurred. Please reboot.</p>
                </div>
            </div>
        </div>
    </div>
    <div class="footer">
        <div class="text-center">
            <p class="text-muted ">&copy; <script type="text/javascript">document.write(new Date().getFullYear());</script> Modis GmbH</p>
            <p class="text-muted small ">Made with <i class="fa fa-fw fa-heart-o " style="color:#F00 "></i> in Vienna, Austria</p>
        </div>
    </div>
</div>
{% assets 'layout_js' %}
    <script type="text/javascript" src="{{ ASSET_URL }}"></script>
    <script>
        $(document).ready(function(){
            var failed_attempts = 0;
            var upg_timeout = setInterval(function(){
                $.ajax({
                    type: 'HEAD',
                    url: '{{ domain }}' + '/login',
                    success: function(){
                        clearInterval(upg_timeout);
                        window.location.href = '{{ domain }}' + '/login';
                    },
                    error: function(){
                        failed_attempts++;
                        console.log('Error in querying for page head');
                    }
                });
                // Waits for 10 minutes
                if(failed_attempts >= 20){
                    clearInterval(upg_timeout);
                    $('#upg_warning').show();
                }
            }, 5000);
        });
    </script>
{% endassets %}
</body>
</html>