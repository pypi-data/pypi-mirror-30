(function($){"use strict";var nextId=0;var Filestyle=function(element,options){this.options=options;this.$elementFilestyle=[];this.$element=$(element);};Filestyle.prototype={clear:function(){this.$element.val('');this.$elementFilestyle.find(':text').val('');this.$elementFilestyle.find('.badge').remove();},destroy:function(){this.$element.removeAttr('style').removeData('filestyle');this.$elementFilestyle.remove();},disabled:function(value){if(value===true){if(!this.options.disabled){this.$element.attr('disabled','true');this.$elementFilestyle.find('label').attr('disabled','true');this.options.disabled=true;}}else if(value===false){if(this.options.disabled){this.$element.removeAttr('disabled');this.$elementFilestyle.find('label').removeAttr('disabled');this.options.disabled=false;}}else{return this.options.disabled;}},buttonBefore:function(value){if(value===true){if(!this.options.buttonBefore){this.options.buttonBefore=true;if(this.options.input){this.$elementFilestyle.remove();this.constructor();this.pushNameFiles();}}}else if(value===false){if(this.options.buttonBefore){this.options.buttonBefore=false;if(this.options.input){this.$elementFilestyle.remove();this.constructor();this.pushNameFiles();}}}else{return this.options.buttonBefore;}},icon:function(value){if(value===true){if(!this.options.icon){this.options.icon=true;this.$elementFilestyle.find('label').prepend(this.htmlIcon());}}else if(value===false){if(this.options.icon){this.options.icon=false;this.$elementFilestyle.find('.icon-span-filestyle').remove();}}else{return this.options.icon;}},input:function(value){if(value===true){if(!this.options.input){this.options.input=true;if(this.options.buttonBefore){this.$elementFilestyle.append(this.htmlInput());}else{this.$elementFilestyle.prepend(this.htmlInput());}
this.$elementFilestyle.find('.badge').remove();this.pushNameFiles();this.$elementFilestyle.find('.group-span-filestyle').addClass('input-group-btn');}}else if(value===false){if(this.options.input){this.options.input=false;this.$elementFilestyle.find(':text').remove();var files=this.pushNameFiles();if(files.length>0&&this.options.badge){this.$elementFilestyle.find('label').append(' <span class="badge">'+files.length+'</span>');}
this.$elementFilestyle.find('.group-span-filestyle').removeClass('input-group-btn');}}else{return this.options.input;}},size:function(value){if(value!==undefined){var btn=this.$elementFilestyle.find('label'),input=this.$elementFilestyle.find('input');btn.removeClass('btn-lg btn-sm');input.removeClass('input-lg input-sm');if(value!='nr'){btn.addClass('btn-'+value);input.addClass('input-'+value);}}else{return this.options.size;}},placeholder:function(value){if(value!==undefined){this.options.placeholder=value;this.$elementFilestyle.find('input').attr('placeholder',value);}else{return this.options.placeholder;}},buttonText:function(value){if(value!==undefined){this.options.buttonText=value;this.$elementFilestyle.find('label .buttonText').html(this.options.buttonText);}else{return this.options.buttonText;}},buttonName:function(value){if(value!==undefined){this.options.buttonName=value;this.$elementFilestyle.find('label').attr({'class':'btn '+this.options.buttonName});}else{return this.options.buttonName;}},iconName:function(value){if(value!==undefined){this.$elementFilestyle.find('.icon-span-filestyle').attr({'class':'icon-span-filestyle '+this.options.iconName});}else{return this.options.iconName;}},htmlIcon:function(){if(this.options.icon){return'<span class="icon-span-filestyle '+this.options.iconName+'"></span> ';}else{return'';}},htmlInput:function(){if(this.options.input){return'<input type="text" class="form-control '+(this.options.size=='nr'?'':'input-'+this.options.size)+'" placeholder="'+this.options.placeholder+'" disabled> ';}else{return'';}},pushNameFiles:function(){var content='',files=[];if(this.$element[0].files===undefined){files[0]={'name':this.$element[0]&&this.$element[0].value};}else{files=this.$element[0].files;}
for(var i=0;i<files.length;i++){content+=files[i].name.split("\\").pop()+', ';}
if(content!==''){this.$elementFilestyle.find(':text').val(content.replace(/\, $/g,''));}else{this.$elementFilestyle.find(':text').val('');}
return files;},constructor:function(){var _self=this,html='',id=_self.$element.attr('id'),files=[],btn='',$label;if(id===''||!id){id='filestyle-'+nextId;_self.$element.attr({'id':id});nextId++;}
btn='<span class="group-span-filestyle '+(_self.options.input?'input-group-btn':'')+'">'+
'<label for="'+id+'" class="btn '+_self.options.buttonName+' '+
(_self.options.size=='nr'?'':'btn-'+_self.options.size)+'" '+
(_self.options.disabled?'disabled="true"':'')+'>'+
_self.htmlIcon()+'<span class="buttonText">'+_self.options.buttonText+'</span>'+
'</label>'+
'</span>';html=_self.options.buttonBefore?btn+_self.htmlInput():_self.htmlInput()+btn;_self.$elementFilestyle=$('<div class="bootstrap-filestyle input-group">'+html+'</div>');_self.$elementFilestyle.find('.group-span-filestyle').attr('tabindex',"0").keypress(function(e){if(e.keyCode===13||e.charCode===32){_self.$elementFilestyle.find('label').click();return false;}});_self.$element.css({'position':'absolute','clip':'rect(0px 0px 0px 0px)'}).attr('tabindex',"-1").after(_self.$elementFilestyle);if(_self.options.disabled){_self.$element.attr('disabled','true');}
_self.$element.change(function(){var files=_self.pushNameFiles();if(_self.options.input==false&&_self.options.badge){if(_self.$elementFilestyle.find('.badge').length==0){_self.$elementFilestyle.find('label').append(' <span class="badge">'+files.length+'</span>');}else if(files.length==0){_self.$elementFilestyle.find('.badge').remove();}else{_self.$elementFilestyle.find('.badge').html(files.length);}}else{_self.$elementFilestyle.find('.badge').remove();}});if(window.navigator.userAgent.search(/firefox/i)>-1){_self.$elementFilestyle.find('label').click(function(){_self.$element.click();return false;});}}};var old=$.fn.filestyle;$.fn.filestyle=function(option,value){var get='',element=this.each(function(){if($(this).attr('type')==='file'){var $this=$(this),data=$this.data('filestyle'),options=$.extend({},$.fn.filestyle.defaults,option,typeof option==='object'&&option);if(!data){$this.data('filestyle',(data=new Filestyle(this,options)));data.constructor();}
if(typeof option==='string'){get=data[option](value);}}});if(typeof get!==undefined){return get;}else{return element;}};$.fn.filestyle.defaults={'buttonText':'Choose file','iconName':'glyphicon glyphicon-folder-open','buttonName':'btn-default','size':'nr','input':true,'badge':true,'icon':true,'buttonBefore':false,'disabled':false,'placeholder':''};$.fn.filestyle.noConflict=function(){$.fn.filestyle=old;return this;};$(function(){$('.filestyle').each(function(){var $this=$(this),options={'input':$this.attr('data-input')==='false'?false:true,'icon':$this.attr('data-icon')==='false'?false:true,'buttonBefore':$this.attr('data-buttonBefore')==='true'?true:false,'disabled':$this.attr('data-disabled')==='true'?true:false,'size':$this.attr('data-size'),'buttonText':$this.attr('data-buttonText'),'buttonName':$this.attr('data-buttonName'),'iconName':$this.attr('data-iconName'),'badge':$this.attr('data-badge')==='false'?false:true,'placeholder':$this.attr('data-placeholder')};$this.filestyle(options);});});})(window.jQuery);/*!
 * Bootstrap Confirmation
 * Copyright 2013 Nimit Suwannagate <ethaizone@hotmail.com>
 * Copyright 2014-2017 Damien "Mistic" Sorel <contact@git.strangeplanet.fr>
 * Licensed under the Apache License, Version 2.0
 */
(function($){'use strict';var activeConfirmation;if(!$.fn.popover){throw new Error('Confirmation requires popover.js');}
var Confirmation=function(element,options){options.trigger='click';this.init(element,options);};Confirmation.VERSION='2.4.0';Confirmation.KEYMAP={13:'Enter',27:'Escape',39:'ArrowRight',40:'ArrowDown'};Confirmation.DEFAULTS=$.extend({},$.fn.popover.Constructor.DEFAULTS,{placement:'top',title:'Are you sure?',popout:false,singleton:false,copyAttributes:'href target',buttons:null,onConfirm:$.noop,onCancel:$.noop,btnOkClass:'btn-xs btn-primary',btnOkIcon:'glyphicon glyphicon-ok',btnOkLabel:'Yes',btnCancelClass:'btn-xs btn-default',btnCancelIcon:'glyphicon glyphicon-remove',btnCancelLabel:'No',template:'<div class="popover confirmation">'+
'<div class="arrow"></div>'+
'<h3 class="popover-title"></h3>'+
'<div class="popover-content">'+
'<p class="confirmation-content"></p>'+
'<div class="confirmation-buttons text-center">'+
'<div class="btn-group">'+
'<a href="#" class="btn" data-apply="confirmation"></a>'+
'<a href="#" class="btn" data-dismiss="confirmation"></a>'+
'</div>'+
'</div>'+
'</div>'+
'</div>'
});Confirmation.prototype=$.extend({},$.fn.popover.Constructor.prototype);Confirmation.prototype.constructor=Confirmation;Confirmation.prototype.getDefaults=function(){return Confirmation.DEFAULTS;};Confirmation.prototype.init=function(element,options){$.fn.popover.Constructor.prototype.init.call(this,'confirmation',element,options);if((this.options.popout||this.options.singleton)&&!options.rootSelector){throw new Error('The rootSelector option is required to use popout and singleton features since jQuery 3.');}
this.options._isDelegate=false;if(options.selector){this.options._selector=this._options._selector=options.rootSelector+' '+options.selector;}
else if(options._selector){this.options._selector=options._selector;this.options._isDelegate=true;}
else{this.options._selector=options.rootSelector;}
var self=this;if(!this.options.selector){this.options._attributes={};if(this.options.copyAttributes){if(typeof this.options.copyAttributes==='string'){this.options.copyAttributes=this.options.copyAttributes.split(' ');}}
else{this.options.copyAttributes=[];}
this.options.copyAttributes.forEach(function(attr){this.options._attributes[attr]=this.$element.attr(attr);},this);this.$element.on(this.options.trigger,function(e,ack){if(!ack){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();}});this.$element.on('show.bs.confirmation',function(e){if(self.options.singleton){$(self.options._selector).not($(this)).filter(function(){return $(this).data('bs.confirmation')!==undefined;}).confirmation('hide');}});}
else{this.$element.on(this.options.trigger,this.options.selector,function(e,ack){if(!ack){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();}});}
if(!this.options._isDelegate){this.eventBody=false;this.uid=this.$element[0].id||this.getUID('group_');this.$element.on('shown.bs.confirmation',function(e){if(self.options.popout&&!self.eventBody){self.eventBody=$('body').on('click.bs.confirmation.'+self.uid,function(e){if($(self.options._selector).is(e.target)){return;}
$(self.options._selector).filter(function(){return $(this).data('bs.confirmation')!==undefined;}).confirmation('hide');$('body').off('click.bs.'+self.uid);self.eventBody=false;});}});}};Confirmation.prototype.hasContent=function(){return true;};Confirmation.prototype.setContent=function(){var self=this;var $tip=this.tip();var title=this.getTitle();var content=this.getContent();$tip.find('.popover-title')[this.options.html?'html':'text'](title);$tip.find('.confirmation-content').toggle(!!content).children().detach().end()[this.options.html?(typeof content=='string'?'html':'append'):'text'](content);$tip.on('click',function(e){e.stopPropagation();});if(this.options.buttons){var $group=$tip.find('.confirmation-buttons .btn-group').empty();this.options.buttons.forEach(function(button){$group.append($('<a href="#"></a>').addClass(button.class||'btn btn-xs btn-default').html(button.label||'').attr(button.attr||{}).prepend($('<i></i>').addClass(button.icon),' ').one('click',function(e){if($(this).attr('href')==='#'){e.preventDefault();}
if(button.onClick){button.onClick.call(self.$element);}
if(button.cancel){self.getOnCancel().call(self.$element,button.value);self.$element.trigger('canceled.bs.confirmation',[button.value]);}
else{self.getOnConfirm().call(self.$element,button.value);self.$element.trigger('confirmed.bs.confirmation',[button.value]);}
if(self.inState){self.inState.click=false;}
self.hide();}));},this);}
else{$tip.find('[data-apply="confirmation"]').addClass(this.options.btnOkClass).html(this.options.btnOkLabel).attr(this.options._attributes).prepend($('<i></i>').addClass(this.options.btnOkIcon),' ').off('click').one('click',function(e){if($(this).attr('href')==='#'){e.preventDefault();}
self.getOnConfirm().call(self.$element);self.$element.trigger('confirmed.bs.confirmation');self.$element.trigger(self.options.trigger,[true]);self.hide();});$tip.find('[data-dismiss="confirmation"]').addClass(this.options.btnCancelClass).html(this.options.btnCancelLabel).prepend($('<i></i>').addClass(this.options.btnCancelIcon),' ').off('click').one('click',function(e){e.preventDefault();self.getOnCancel().call(self.$element);self.$element.trigger('canceled.bs.confirmation');if(self.inState){self.inState.click=false;}
self.hide();});}
$tip.removeClass('fade top bottom left right in');if(!$tip.find('.popover-title').html()){$tip.find('.popover-title').hide();}
activeConfirmation=this;$(window).off('keyup.bs.confirmation').on('keyup.bs.confirmation',this._onKeyup.bind(this));};Confirmation.prototype.destroy=function(){if(activeConfirmation===this){activeConfirmation=undefined;$(window).off('keyup.bs.confirmation');}
$.fn.popover.Constructor.prototype.destroy.call(this);};Confirmation.prototype.hide=function(){if(activeConfirmation===this){activeConfirmation=undefined;$(window).off('keyup.bs.confirmation');}
$.fn.popover.Constructor.prototype.hide.call(this);};Confirmation.prototype._onKeyup=function(event){if(!this.$tip){activeConfirmation=undefined;$(window).off('keyup.bs.confirmation');return;}
var key=event.key||Confirmation.KEYMAP[event.keyCode||event.which];var $group=this.$tip.find('.confirmation-buttons .btn-group');var $active=$group.find('.active');var $next;switch(key){case'Escape':this.hide();break;case'ArrowRight':if($active.length&&$active.next().length){$next=$active.next();}
else{$next=$group.children().first();}
$active.removeClass('active');$next.addClass('active').focus();break;case'ArrowLeft':if($active.length&&$active.prev().length){$next=$active.prev();}
else{$next=$group.children().last();}
$active.removeClass('active');$next.addClass('active').focus();break;}};Confirmation.prototype.getOnConfirm=function(){if(this.$element.attr('data-on-confirm')){return getFunctionFromString(this.$element.attr('data-on-confirm'));}
else{return this.options.onConfirm;}};Confirmation.prototype.getOnCancel=function(){if(this.$element.attr('data-on-cancel')){return getFunctionFromString(this.$element.attr('data-on-cancel'));}
else{return this.options.onCancel;}};function getFunctionFromString(functionName){var context=window;var namespaces=functionName.split('.');var func=namespaces.pop();for(var i=0,l=namespaces.length;i<l;i++){context=context[namespaces[i]];}
return function(){context[func].call(this);};}
var old=$.fn.confirmation;$.fn.confirmation=function(option){var options=(typeof option=='object'&&option)||{};options.rootSelector=this.selector||options.rootSelector;return this.each(function(){var $this=$(this);var data=$this.data('bs.confirmation');if(!data&&option=='destroy'){return;}
if(!data){$this.data('bs.confirmation',(data=new Confirmation(this,options)));}
if(typeof option=='string'){data[option]();if(option=='hide'&&data.inState){data.inState.click=false;}}});};$.fn.confirmation.Constructor=Confirmation;$.fn.confirmation.noConflict=function(){$.fn.confirmation=old;return this;};}(jQuery));(function(){$('#submit_restore').click(function(){event.preventDefault();var form_data=new FormData($('#restore_db_form')[0]);$.ajax({type:'POST',url:'/settings/backup/run_restore',data:form_data,contentType:false,cache:false,processData:false,async:false}).done(function(data,textStatus,jqXHR){toastr.success(data['success'],'DATABASE');}).fail(function(data){toastr.error(data['error'],'DATABASE');});});$(".btn-upload-4").on("click",function(){$("#btn_restore_db").fileinput('upload');});$(".btn-reset-4").on("click",function(){$("#btn_restore_db").fileinput('clear');});$("#purge_btn").confirmation({title:'Confirm Purge all Events',btnOkClass:'btn-xs btn-danger',btnOkIcon:'fa fa-exclamation',btnOkLabel:'Purge All',btnCancelClass:'btn-xs btn-default',btnCancelIcon:'fa fa-close',btnCancelLabel:'Cancel',onConfirm:function(){$.ajax({url:'/settings/backup',type:'POST',data:{action:'purge'}}).done(function(data,textStatus,jqXHR){toastr.success(data['success'],'DATABASE')}).fail(function(data){toastr.error(data['error'],'DATABASE')})},onCancel:function(){console.log('Purge cancelled')}});$("#reboot_btn").confirmation({title:'Confirm Reboot',btnOkClass:'btn-xs btn-danger',btnOkIcon:'fa fa-check',btnOkLabel:'Reboot',btnCancelClass:'btn-xs btn-default',btnCancelIcon:'fa fa-close',btnCancelLabel:'Cancel',onConfirm:function(){$.ajax({url:'/settings/backup',type:'POST',data:{action:'reboot'}}).done(function(data,textStatus,jqXHR){window.location.href='/settings/reboot'}).fail(function(data){})},onCancel:function(){console.log('Reboot option cancelled')}});})();