

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Extending PyScaffold &mdash; PyScaffold 3.0a9.post0.dev1+ngb641ddf7.dirty documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/logo.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="PyScaffold 3.0a9.post0.dev1+ngb641ddf7.dirty documentation" href="index.html"/>
        <link rel="next" title="Namespace Extension" href="examples/namespace-extension.html"/>
        <link rel="prev" title="Configuration" href="configuration.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> PyScaffold
          

          
            
            <img src="_static/sidebar.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                3.0a9.post0.dev1+ngb641ddf7.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Extending PyScaffold</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#project-structure-representation">Project Structure Representation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scaffold-actions">Scaffold Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-are-extensions">What are Extensions?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-an-extension">Creating an Extension</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#action-list-helper-methods">Action List Helper Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#structure-helper-methods">Structure Helper Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#activating-extensions">Activating Extensions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="examples/namespace-extension.html">namespace</a></li>
<li class="toctree-l3"><a class="reference internal" href="examples/no-skeleton-extension.html">no-skeleton</a></li>
<li class="toctree-l3"><a class="reference internal" href="examples/cookiecutter-extension.html">cookiecutter</a></li>
<li class="toctree-l3"><a class="reference internal" href="examples/django-extension.html">django</a></li>
<li class="toctree-l3"><a class="reference internal" href="examples/pre-commit-extension.html">pre-commit</a></li>
<li class="toctree-l3"><a class="reference internal" href="examples/tox-extension.html">tox</a></li>
<li class="toctree-l3"><a class="reference internal" href="examples/travis-extension.html">travis</a></li>
<li class="toctree-l3"><a class="reference internal" href="examples/gitlab-ci-extension.html">gitlab</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#conventions-for-community-extensions">Conventions for Community Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#final-considerations">Final Considerations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="python-api.html">Embedding PyScaffold</a></li>
<li class="toctree-l1"><a class="reference internal" href="cookiecutter-integration.html">Cookiecutter Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributions &amp; Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/modules.html">Module Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PyScaffold</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Extending PyScaffold</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/extensions.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="extending-pyscaffold">
<span id="extensions"></span><h1>Extending PyScaffold<a class="headerlink" href="#extending-pyscaffold" title="Permalink to this headline">¶</a></h1>
<p>PyScaffold is carefully designed to cover the essentials of authoring and
distributing Python packages. Most of time, tweaking <code class="docutils literal"><span class="pre">putup</span></code> options is
enough to ensure proper configuration of a project.
However, for advanced use cases a deeper level of programmability may be
required and PyScaffold’s extension systems provides this.</p>
<p>PyScaffold can be extended at runtime by other Python packages.
Therefore it is possible to change the behavior of the <code class="docutils literal"><span class="pre">putup</span></code> command line
tool without changing the PyScaffold code itself. In order to explain how this
mechanism works, the following sections define a few important concepts and
present a comprehensive guide about how to create custom extensions.</p>
<p>Additionally, <a class="reference internal" href="cookiecutter-integration.html#cookiecutter-integration"><span class="std std-ref">Cookiecutter templates</span></a>
can also be used but writing a native PyScaffold extension is the preferred
way.</p>
<div class="section" id="project-structure-representation">
<span id="coreconcepts"></span><h2>Project Structure Representation<a class="headerlink" href="#project-structure-representation" title="Permalink to this headline">¶</a></h2>
<p>Each Python package project is internally represented by PyScaffold as a tree
data structure, that directly relates to a directory entry in the file system.
This tree is implemented as a simple (and possibly nested) <a class="reference external" href="https://docs.python.org/3.6/library/stdtypes.html#dict" title="(in Python v3.6)"><code class="xref py py-obj docutils literal"><span class="pre">dict</span></code></a> in which
keys indicate the path where files will be generated, while values indicate
their content. For instance, the following dict:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;project&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;folder&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;file.txt&#39;</span><span class="p">:</span> <span class="s1">&#39;Hello World!&#39;</span><span class="p">,</span>
            <span class="s1">&#39;another-folder&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;empty-file.txt&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>represents a <code class="docutils literal"><span class="pre">project/folder</span></code> directory in the file system containing two
entries. The first entry is a file named <cite>file.txt</cite> with content <cite>Hello World!</cite>
while the second entry is a sub-directory named <cite>another-folder</cite>. In turn,
<cite>another-folder</cite> contains an empty file named <cite>empty-file.txt</cite>.</p>
<p>Additionally, tuple values are also allowed in order to specify some useful
metadata.  In this case, the first element of the tuple is the file content.
For example, the dict:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;project&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;namespace&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;module.py&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;print(&quot;Hello World!&quot;)&#39;</span><span class="p">,</span> <span class="n">helpers</span><span class="o">.</span><span class="n">NO_OVERWRITE</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>represents a <code class="docutils literal"><span class="pre">project/namespace/module.py</span></code> file with content
<code class="docutils literal"><span class="pre">print(&quot;Hello</span> <span class="pre">World!&quot;)</span></code>, that will not be overwritten if already exists.</p>
<p>This tree representation is often referred in this document as <strong>project
structure</strong> or simply <strong>structure</strong>.</p>
</div>
<div class="section" id="scaffold-actions">
<h2>Scaffold Actions<a class="headerlink" href="#scaffold-actions" title="Permalink to this headline">¶</a></h2>
<p>PyScaffold organizes the generation of a project into a series of steps with
well defined purposes. Each step is called <strong>action</strong> and is implemented as a
simple function that receives two arguments: a project structure and a dict
with options (some of them parsed from command line arguments, other from
default values).</p>
<p>An action <strong>MUST</strong> return a tuple also composed by a project structure and a
dict with options. The return values, thus, are usually modified versions
of the input arguments. Additionally an action can also have side effects, like
creating directories or adding files to version control. The following
pseudo-code illustrates a basic action:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="n">project_structure</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
    <span class="n">new_struct</span><span class="p">,</span> <span class="n">new_opts</span> <span class="o">=</span> <span class="n">modify</span><span class="p">(</span><span class="n">project_structure</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
    <span class="n">some_side_effect</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">new_struct</span><span class="p">,</span> <span class="n">new_opts</span>
</pre></div>
</div>
<p>The output of each action is used as the input of the subsequent action, and
initially the structure argument is just an empty dict. Each action is uniquely
identified by a string in the format <code class="docutils literal"><span class="pre">&lt;module</span> <span class="pre">name&gt;:&lt;function</span> <span class="pre">name&gt;</span></code>,
similarly to the convention used for a <a class="reference external" href="http://setuptools.readthedocs.io/en/latest/setuptools.html?highlight=dynamic#dynamic-discovery-of-services-and-plugins">setuptools entry point</a>.
For example, if an action is defined in the <code class="docutils literal"><span class="pre">action</span></code> function of the
<code class="docutils literal"><span class="pre">extras.py</span></code> file that is part of the <code class="docutils literal"><span class="pre">pyscaffoldext.contrib</span></code> project,
the <strong>action identifier</strong> is <code class="docutils literal"><span class="pre">pyscaffoldext.contrib.extras:action</span></code>.</p>
<p>By default, the sequence of actions taken by PyScaffold is:</p>
<ol class="arabic simple">
<li><a class="reference internal" href="api/pyscaffold.api.html#pyscaffold.api.get_default_options" title="pyscaffold.api.get_default_options"><code class="xref py py-obj docutils literal"><span class="pre">pyscaffold.api:get_default_options</span></code></a></li>
<li><a class="reference internal" href="api/pyscaffold.api.html#pyscaffold.api.verify_options_consistency" title="pyscaffold.api.verify_options_consistency"><code class="xref py py-obj docutils literal"><span class="pre">pyscaffold.api:verify_options_consistency</span></code></a></li>
<li><a class="reference internal" href="api/pyscaffold.html#pyscaffold.structure.define_structure" title="pyscaffold.structure.define_structure"><code class="xref py py-obj docutils literal"><span class="pre">pyscaffold.structure:define_structure</span></code></a></li>
<li><a class="reference internal" href="api/pyscaffold.html#pyscaffold.structure.apply_update_rules" title="pyscaffold.structure.apply_update_rules"><code class="xref py py-obj docutils literal"><span class="pre">pyscaffold.structure:apply_update_rules</span></code></a></li>
<li><a class="reference internal" href="api/pyscaffold.html#pyscaffold.structure.create_structure" title="pyscaffold.structure.create_structure"><code class="xref py py-obj docutils literal"><span class="pre">pyscaffold.structure:create_structure</span></code></a></li>
<li><a class="reference internal" href="api/pyscaffold.api.html#pyscaffold.api.init_git" title="pyscaffold.api.init_git"><code class="xref py py-obj docutils literal"><span class="pre">pyscaffold.api:init_git</span></code></a></li>
</ol>
<p>The project structure is usually empty until <strong>define_structure</strong>.
This action just loads the in-memory dict representation, that is only written
to disk by the <strong>create_structure</strong> action.</p>
<p>Note that, this sequence varies according to the command line options.
To retrieve an updated list, please use <code class="docutils literal"><span class="pre">putup</span> <span class="pre">--list-actions</span></code> or
<code class="docutils literal"><span class="pre">putup</span> <span class="pre">--dry-run</span></code>.</p>
</div>
<div class="section" id="what-are-extensions">
<h2>What are Extensions?<a class="headerlink" href="#what-are-extensions" title="Permalink to this headline">¶</a></h2>
<p>From the standpoint of PyScaffold, an extension is just an class inheriting
from <a class="reference internal" href="api/pyscaffold.api.html#pyscaffold.api.Extension" title="pyscaffold.api.Extension"><code class="xref py py-obj docutils literal"><span class="pre">Extension</span></code></a> overriding and
implementing certain methods. This methods allow inject actions at arbitrary
positions in the aforementioned list. Furthermore, extensions can also remove
actions.</p>
</div>
<div class="section" id="creating-an-extension">
<h2>Creating an Extension<a class="headerlink" href="#creating-an-extension" title="Permalink to this headline">¶</a></h2>
<p>In order to create an extension it is necessary to write a class that inherits
from <a class="reference internal" href="api/pyscaffold.api.html#pyscaffold.api.Extension" title="pyscaffold.api.Extension"><code class="xref py py-obj docutils literal"><span class="pre">Extension</span></code></a> and implements the method
<a class="reference internal" href="api/pyscaffold.api.html#pyscaffold.api.Extension.activate" title="pyscaffold.api.Extension.activate"><code class="xref py py-obj docutils literal"><span class="pre">activate</span></code></a> that receives a list of actions,
registers a custom action that will be called later and returns a modified version
of the list of actions:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">..api</span> <span class="kn">import</span> <span class="n">Extension</span>
<span class="kn">from</span> <span class="nn">..api</span> <span class="kn">import</span> <span class="n">helpers</span>


<span class="k">class</span> <span class="nc">MyExtension</span><span class="p">(</span><span class="n">Extension</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Help text on commandline when running putup -h&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Activate extension</span>

<span class="sd">        Args:</span>
<span class="sd">            actions (list): list of actions to perform</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: updated list of actions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">actions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="s1">&#39;create_structure&#39;</span><span class="p">)</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="n">actions</span><span class="p">,</span> <span class="s1">&#39;init_git&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">actions</span>

    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">struct</span><span class="p">,</span> <span class="n">opts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform some actions that modifies the structure and options</span>

<span class="sd">        Args:</span>
<span class="sd">            struct (dict): project representation as (possibly) nested</span>
<span class="sd">                :obj:`dict`.</span>
<span class="sd">            opts (dict): given options, see :obj:`create_project` for</span>
<span class="sd">                an extensive list.</span>

<span class="sd">        Returns:</span>
<span class="sd">            struct, opts: updated project representation and options</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">....</span>
        <span class="k">return</span> <span class="n">new_actions</span><span class="p">,</span> <span class="n">new_opts</span>
</pre></div>
</div>
<div class="section" id="action-list-helper-methods">
<h3>Action List Helper Methods<a class="headerlink" href="#action-list-helper-methods" title="Permalink to this headline">¶</a></h3>
<p>As implied by the previous example, the <a class="reference internal" href="api/pyscaffold.api.html#module-pyscaffold.api.helpers" title="pyscaffold.api.helpers"><code class="xref py py-mod docutils literal"><span class="pre">helpers</span></code></a> module
provides a series of useful functions and makes it easier to manipulate the
action list, by using <a class="reference internal" href="api/pyscaffold.api.html#pyscaffold.api.helpers.register" title="pyscaffold.api.helpers.register"><code class="xref py py-obj docutils literal"><span class="pre">register</span></code></a> and
<a class="reference internal" href="api/pyscaffold.api.html#pyscaffold.api.helpers.unregister" title="pyscaffold.api.helpers.unregister"><code class="xref py py-obj docutils literal"><span class="pre">unregister</span></code></a>.</p>
<p>Since the action order is relevant, the first function accepts special keyword
arguments (<code class="docutils literal"><span class="pre">before</span></code> and <code class="docutils literal"><span class="pre">after</span></code>) that should be used to place the extension
actions precisely among the default actions.  The value of these arguments can
be presented in 2 different forms:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">helpers</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">actions</span><span class="p">,</span> <span class="n">hook1</span><span class="p">,</span> <span class="n">before</span><span class="o">=</span><span class="s1">&#39;define_structure&#39;</span><span class="p">)</span>
<span class="n">helpers</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">actions</span><span class="p">,</span> <span class="n">hook2</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="s1">&#39;pyscaffold.structure:create_structure&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The first form uses as a position reference the first action with a matching
name, regardless of the module. Accordingly, the second form tries to find an
action that matches both the given name and module. When no reference is given,
<a class="reference internal" href="api/pyscaffold.api.html#pyscaffold.api.helpers.register" title="pyscaffold.api.helpers.register"><code class="xref py py-obj docutils literal"><span class="pre">register</span></code></a> assumes as default position
<code class="docutils literal"><span class="pre">after='pyscaffold.structure:define_structure'</span></code>.  This position is special
since most extensions are expected to create additional files inside the
project. Therefore, it is possible to easily amend the project structure before
it is materialized by <code class="docutils literal"><span class="pre">create_structure</span></code>.</p>
<p>The <a class="reference internal" href="api/pyscaffold.api.html#pyscaffold.api.helpers.unregister" title="pyscaffold.api.helpers.unregister"><code class="xref py py-obj docutils literal"><span class="pre">unregister</span></code></a> function accepts as second
argument a position reference which can similarly present the module name:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">helpers</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="n">actions</span><span class="p">,</span> <span class="s1">&#39;init_git&#39;</span><span class="p">)</span>
<span class="n">helpers</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="n">actions</span><span class="p">,</span> <span class="s1">&#39;pyscaffold.api:init_git&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These functions <strong>DO NOT</strong> modify the actions list, instead they return a
new list with the changes applied.</p>
</div>
</div>
<div class="section" id="structure-helper-methods">
<h3>Structure Helper Methods<a class="headerlink" href="#structure-helper-methods" title="Permalink to this headline">¶</a></h3>
<p>PyScaffold also provides extra facilities to manipulate the project structure.
The following functions are accessible through the
<a class="reference internal" href="api/pyscaffold.api.html#module-pyscaffold.api.helpers" title="pyscaffold.api.helpers"><code class="xref py py-mod docutils literal"><span class="pre">helpers</span></code></a> module:</p>
<ul class="simple">
<li><a class="reference internal" href="api/pyscaffold.api.html#pyscaffold.api.helpers.merge" title="pyscaffold.api.helpers.merge"><code class="xref py py-obj docutils literal"><span class="pre">merge</span></code></a></li>
<li><a class="reference internal" href="api/pyscaffold.api.html#pyscaffold.api.helpers.ensure" title="pyscaffold.api.helpers.ensure"><code class="xref py py-obj docutils literal"><span class="pre">ensure</span></code></a></li>
<li><a class="reference internal" href="api/pyscaffold.api.html#pyscaffold.api.helpers.reject" title="pyscaffold.api.helpers.reject"><code class="xref py py-obj docutils literal"><span class="pre">reject</span></code></a></li>
</ul>
<p>The first function can be used to deep merge a dictionary argument with the
current representation of the to-be-generated directory tree, automatically
considering any metadata present in tuple values. On the other hand, the last
two functions can be used to ensure a single file is present or absent in the
current representation of the project structure, automatically handling parent
directories.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Similarly to the actions list helpers, these functions also <strong>DO NOT</strong>
modify the project structure. Instead they return a new structure with the
changes applied.</p>
</div>
<p>The following example illustrates the implementation of a <code class="docutils literal"><span class="pre">AwesomeFiles</span></code>
extension which defines the <code class="docutils literal"><span class="pre">define_awesome_files</span></code> action:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">..api</span> <span class="kn">import</span> <span class="n">Extension</span>
<span class="kn">from</span> <span class="nn">..api</span> <span class="kn">import</span> <span class="n">helpers</span>

<span class="n">MY_AWESOME_FILE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2"># -*- coding: utf-8 -*-</span>
<span class="s2">from __future__ import print_function</span>

<span class="s2">__author__ = &quot;{author}&quot;</span>
<span class="s2">__copyright__ = &quot;{author}&quot;</span>
<span class="s2">__license__ = &quot;{license}&quot;</span>

<span class="s2">def awesome():</span>
<span class="s2">    return &quot;Awesome!&quot;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">MY_AWESOME_TEST</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">import pytest</span>
<span class="s2">from {qual_pkg}.awesome import awesome</span>

<span class="s2">def test_awesome():</span>
<span class="s2">    assert awesome() == &quot;Awesome!&quot;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">AwesomeFiles</span><span class="p">(</span><span class="n">Extension</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adding some additional awesome files&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">helpers</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">actions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_awesome_files</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">define_awesome_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">struct</span><span class="p">,</span> <span class="n">opts</span><span class="p">):</span>
        <span class="n">struct</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;project&#39;</span><span class="p">]:</span> <span class="p">{</span>
                <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;package&#39;</span><span class="p">]:</span> <span class="p">{</span>
                    <span class="s1">&#39;awesome.py&#39;</span><span class="p">:</span> <span class="n">MY_AWESOME_FILE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">opts</span><span class="p">)</span>
                <span class="p">},</span>
                <span class="s1">&#39;tests&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;awesome_test.py&#39;</span><span class="p">:</span> <span class="p">(</span>
                        <span class="n">MY_AWESOME_TEST</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">opts</span><span class="p">),</span>
                        <span class="n">helpers</span><span class="o">.</span><span class="n">NO_OVERWRITE</span>
                    <span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">})</span>

        <span class="n">struct</span><span class="p">[</span><span class="s1">&#39;.python-version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;3.6.1&#39;</span><span class="p">,</span> <span class="n">helpers</span><span class="o">.</span><span class="n">NO_OVERWRITE</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;awesome_file1&#39;</span><span class="p">,</span> <span class="s1">&#39;awesome_file2&#39;</span><span class="p">]:</span>
            <span class="n">struct</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span>
                <span class="n">struct</span><span class="p">,</span> <span class="p">[</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;project&#39;</span><span class="p">],</span> <span class="s1">&#39;awesome&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">],</span>
                <span class="n">content</span><span class="o">=</span><span class="s1">&#39;AWESOME!&#39;</span><span class="p">,</span> <span class="n">update_rule</span><span class="o">=</span><span class="n">helpers</span><span class="o">.</span><span class="n">NO_CREATE</span><span class="p">)</span>
                <span class="c1"># The second argument is the file path, represented by a</span>
                <span class="c1"># list of file parts or a string.</span>
                <span class="c1"># Alternatively in this example:</span>
                <span class="c1"># path = &#39;{project}/awesome/{filename}&#39;.format(</span>
                <span class="c1">#           filename=filename, **opts)</span>

        <span class="c1"># The `reject` can be used to avoid default files being generated.</span>
        <span class="n">struct</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">reject</span><span class="p">(</span>
            <span class="n">struct</span><span class="p">,</span> <span class="s1">&#39;{project}/{package}/skeleton.py&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">opts</span><span class="p">))</span>
            <span class="c1"># Alternatively in this example:</span>
            <span class="c1"># path = [opts[&#39;project&#39;], opts[&#39;package&#39;], &#39;skeleton.py&#39;])</span>

        <span class="c1"># It is import to remember the return values</span>
        <span class="k">return</span> <span class="n">struct</span><span class="p">,</span> <span class="n">opts</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">project</span></code> and  <code class="docutils literal"><span class="pre">package</span></code> options should be used to provide
the correct location of the files relative to the current working
directory.</p>
</div>
<p>As shown by the previous example, the <a class="reference internal" href="api/pyscaffold.api.html#module-pyscaffold.api.helpers" title="pyscaffold.api.helpers"><code class="xref py py-mod docutils literal"><span class="pre">helpers</span></code></a> module
also presents constants that can be used as metadata. The <code class="docutils literal"><span class="pre">NO_OVERWRITE</span></code> flag
avoids an existing file to be overwritten when <code class="docutils literal"><span class="pre">putup</span></code> is used in update
mode. Similarly, <code class="docutils literal"><span class="pre">NO_CREATE</span></code> avoids creating a file from template in update
mode, even if it does not exist.</p>
<p>For more sophisticated extensions which need to read and parse their
own command line arguments it is necessary to override
<a class="reference internal" href="api/pyscaffold.api.html#pyscaffold.api.Extension.augment_cli" title="pyscaffold.api.Extension.augment_cli"><code class="xref py py-obj docutils literal"><span class="pre">activate</span></code></a> that receives an
<a class="reference external" href="https://docs.python.org/3.6/library/argparse.html#argparse.ArgumentParser" title="(in Python v3.6)"><code class="xref py py-class docutils literal"><span class="pre">argparse.ArgumentParser</span></code></a> argument. This object can then be modified
in order to add custom command line arguments that will later be stored in the
<code class="docutils literal"><span class="pre">opts</span></code> dictionary.
Just remember the convention that after the command line arguments parsing,
the extension function should be stored under the <code class="docutils literal"><span class="pre">extensions</span></code> attribute
(a list) of the <a class="reference external" href="https://docs.python.org/3.6/library/argparse.html#module-argparse" title="(in Python v3.6)"><code class="xref py py-mod docutils literal"><span class="pre">argparse</span></code></a> generated object. For reference check out the
implementation of the <span class="xref std std-ref">namespace extension</span>,</p>
</div>
<div class="section" id="activating-extensions">
<h3>Activating Extensions<a class="headerlink" href="#activating-extensions" title="Permalink to this headline">¶</a></h3>
<p>PyScaffold extensions are not activated by default. Instead, it is necessary
to add a CLI option to do it.
This is possible by setting up a <a class="reference external" href="http://setuptools.readthedocs.io/en/latest/setuptools.html?highlight=dynamic#dynamic-discovery-of-services-and-plugins">setuptools entry point</a> under the
<code class="docutils literal"><span class="pre">pyscaffold.cli</span></code> group.
This entry point should point to our extension class, e.g. <code class="docutils literal"><span class="pre">AwesomeFiles</span></code>
like defined above. If you for instance use a scaffold generated by PyScaffold
to write a PyScaffold extension (we hope you do ;-), you would add the following
to the <code class="docutils literal"><span class="pre">entry_points</span></code> variable in <code class="docutils literal"><span class="pre">setup.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">entry_points</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">[pyscaffold.cli]</span>
<span class="s2">awesome_files = your_package.your_module:AwesomeFiles</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>Some options for the <code class="docutils literal"><span class="pre">putup</span></code> command are already implemented as extensions
and can be used as reference implementation:</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="examples/namespace-extension.html">namespace</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/no-skeleton-extension.html">no-skeleton</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/cookiecutter-extension.html">cookiecutter</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/django-extension.html">django</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/pre-commit-extension.html">pre-commit</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/tox-extension.html">tox</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/travis-extension.html">travis</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/gitlab-ci-extension.html">gitlab</a></li>
</ul>
</div>
</div>
<div class="section" id="conventions-for-community-extensions">
<h2>Conventions for Community Extensions<a class="headerlink" href="#conventions-for-community-extensions" title="Permalink to this headline">¶</a></h2>
<p>In order to make it easy to find PyScaffold extensions, community packages
should be namespaced as in <code class="docutils literal"><span class="pre">pyscaffoldext.${EXTENSION}</span></code> (where <code class="docutils literal"><span class="pre">${EXTENSION}</span></code>
is the name of the extension being developed). Although this naming convention
slightly differs from <a class="reference external" href="https://www.python.org/dev/peps/pep-0423/#use-standard-pattern-for-community-contributions">PEP423</a>, it is close enough and shorter.</p>
<p>Similarly to <code class="docutils literal"><span class="pre">sphinxcontrib-*</span></code> packages, names registered in PyPI should
contain a dash <code class="docutils literal"><span class="pre">-</span></code>, instead of a dot <code class="docutils literal"><span class="pre">.</span></code>. This way, third-party extension
development can be easily bootstrapped with the command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>putput pyscaffoldext-${EXTENSION} -p ${EXTENSION} --namespace pyscaffoldext
</pre></div>
</div>
</div>
<div class="section" id="final-considerations">
<h2>Final Considerations<a class="headerlink" href="#final-considerations" title="Permalink to this headline">¶</a></h2>
<p>When writing extensions, it is important to be consistent with the default
PyScaffold behavior. In particular, PyScaffold uses a <code class="docutils literal"><span class="pre">pretend</span></code> option to
indicate when the actions should not run but instead just indicate the
expected results to the user, that <strong>MUST</strong> be respected.</p>
<p>The <code class="docutils literal"><span class="pre">pretend</span></code> option is automatically observed for files registered in
the project structure representation, but complex actions may require
specialized coding. The <a class="reference internal" href="api/pyscaffold.api.html#module-pyscaffold.api.helpers" title="pyscaffold.api.helpers"><code class="xref py py-mod docutils literal"><span class="pre">helpers</span></code></a> module provides a
special <a class="reference internal" href="api/pyscaffold.html#pyscaffold.log.ReportLogger" title="pyscaffold.log.ReportLogger"><code class="xref py py-class docutils literal"><span class="pre">logger</span></code></a> object useful in
these situations. Please refer to <a class="reference internal" href="examples/no-skeleton-extension.html#cookiecutter-extension"><span class="std std-ref">No Skeleton Extension</span></a> for a
practical example.</p>
<p>Other options that should be considered are the <code class="docutils literal"><span class="pre">update</span></code> and <code class="docutils literal"><span class="pre">force</span></code>
flags. See <a class="reference internal" href="api/pyscaffold.api.html#pyscaffold.api.create_project" title="pyscaffold.api.create_project"><code class="xref py py-obj docutils literal"><span class="pre">pyscaffold.api.create_project</span></code></a> for a list of available
options.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="examples/namespace-extension.html" class="btn btn-neutral float-right" title="Namespace Extension" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="configuration.html" class="btn btn-neutral" title="Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Blue Yonder.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'3.0a9.post0.dev1+ngb641ddf7.dirty',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>