<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="base">
<head><title></title></head>
<body>
<div metal:fill-slot="form" tal:omit-tag="">
  ${form.begin(request.current_route_path(_query=paging and {'paging_id': paging.paging_id} or {}),
    id='pfWrapper')}
</div>
<div id="mainPanel" metal:fill-slot="main">
  <!-- ............................... Buttons ............................ -->
  <div id="buttons">
    <div class="first">
      ${request.breadcrumbs.back_button()}
    </div>
    <div class="last" tal:switch="job is None">
      <div tal:case="True" tal:omit-tag="">
        ${form.submit('sav!.x', _('Create'), class_='buttonMain')}
        ${form.button(route('project_edit', project_id=project['project_id']), _('Cancel'))}
      </div>
      <div tal:case="False" tal:omit-tag="">
        ${form.submit('sav!.x', _('Save'), class_='buttonMain')}
        ${form.button(route('job_view', project_id=job.project_id, job_id=job.job_id), _('Cancel'))}
        ${form.button(route('project_%s' % ('edit' in request.breadcrumbs.back_path() and 'edit' or 'view'),
          project_id=job.project_id), _('View project settings'))}
      </div>
    </div>
    <hr class="hidden"/>
  </div>
  <div id="main">
    <h2 id="subtitle" class="job" title="${_('Background job')}">
      ${project['label']} <em>${job and job.label}</em>
    </h2>
    <!-- ............................. Flash .............................. -->
    <div tal:define="flash load: flash.macro.pt" metal:use-macro="flash"/>
    <!-- .......................... Packs to add .......................... -->
    <div id="dialogBox" tal:condition="paging is not None">
    <div id="dialogBoxTitle">
      <div class="first">${_('Packs to add')}</div>
      <div class="last">
        ${form.submit_image('ccl!', _('Close'), '/Static/Images/close_light.png')}
      </div>
    </div>
    <div id="dialogBoxContent">
      <div class="filter">
          ${form.grid_text('f_label', _('Label:'))}
        <div class="submit">${form.submit('filter', _('Apply filter'), class_='button')}</div>
      </div>
      <h3 class="list">${_('Packs to add')}</h3>
      <div class="listActions">
        <div class="first">${paging.pager_top()}</div>
        <div class="last">
          ${form.submit('add!#.x', _('Add packs'))}
        </div>
      </div>
      <table class="list smallList">
        <caption>${_('Packs')}</caption>
        <tr>
          <th class="checkbox" id="check_all"></th>
          <th>${paging.sortable_column(_('Label'), 'label')}</th>
          <th>${_('Description')}</th>
          <th class="last">${_('Actions')}</th>
        </tr>
        <tr tal:repeat="pack paging">
          <td class="checkbox">${form.checkbox('#%d' % pack.pack_id, id=None, class_='listCheck')}</td>
          <td>${pack.label}</td>
          <td class="info">${pack.description}</td>
          <td class="last actions">
            ${form.submit_image('add!%d' % pack.pack_id, _('Add pack'),
              '/Static/Images/action_add_one.png')}
          </td>
        </tr>
      </table>
      <div class="listPager">
        <div class="first">${paging.pager_bottom()}</div>
        <div class="last">
          ${_('Lines per page:')} ${form.select('page_size', '', PAGE_SIZES, True)}
        </div>
      </div>
    </div>
  </div>
    <!-- ............................. Tabs ............................... -->
    <div id="tabSet">
      ${tab_set.toc('tabJob')}
      <!-- ..... Description ...... -->
      ${tab_set.tab_begin(0, 'd')}
      ${form.grid_text('label', _('Label:'), required=True)}
      ${form.grid_text('description', _('Description:'))}
      ${form.grid_select('processing_id', _('Processing:'),
        [('', u' ')] + processings.items(), required=True)}
      ${form.grid_select('ttl', _('Time To Live:'), ttls, required=True)}
      ${form.grid_select('log_ttl', _('Log Time To Live:'), log_ttls, required=True)}
      ${form.grid_select('period', _('Period:'), PERIOD_VALUES, required=True)}
      ${form.grid_checkbox('stopped', _('Stopped:'))}
      ${tab_set.tab_end()}
      <!-- ......... Packs ........ -->
      ${tab_set.tab_begin(1, 'p')}
      <div class="listActions" tal:condition="job">
        <div class="first">
          <img src="/Static/Images/pack22.png" alt="${_('Packs')}"/>
        </div>
        <div class="last">
          ${form.submit_image('add?', _('Add pack'), '/Static/Images/action_add.png')}
        </div>
      </div>
      <table class="list smallList" tal:condition="job">
        <caption>${_('Packs')}</caption>
        <tr>
          <th>${_('Label')}</th>
          <th>${_('Description')}</th>
          <th class="last">${_('Action')}</th>
        </tr>
        <tr tal:repeat="pack packs">
          <td>
            <a href="${route('pack_view', project_id=pack.project_id, pack_id=pack.pack_id)}">
              ${pack.label}
            </a>
          </td>
          <td class="info">
            ${pack.description}
          </td>
          <td class="last" tal:switch="action == 'del?%d' % pack.pack_id">
            <span tal:case="True" tal:omit-tag="">
              ${form.submit('del!%d.x' % pack.pack_id, _('Confirm removal'), class_='button')}
              ${form.submit_cancel(_('Cancel'))}
            </span>
            <span tal:case="False" tal:omit-tag="">
              ${form.submit_image('del?%d' % pack.pack_id, _('Remove pack'),
              '/Static/Images/action_remove_one.png')}
            </span>
          </td>
        </tr>
      </table>
      <div tal:condition="not job">${_('Create background job before adding packs.')}</div>
      ${tab_set.tab_end()}
      <!-- ..... Connections ...... -->
      ${tab_set.tab_begin(2, 'c')}
      <div class="formItem">
        <label><em>${_('In case of failure:')}</em></label>
        <div>
          ${form.select('task_ko_id', None, [('', u' ')] + project['task_labels'].items())}
          ${_('mode')}
          ${form.select('task_ko_mode', None, LINK_TYPES.items())}
        </div>
      </div>
      <div class="formItem">
        <label><em>${_('In case of success:')}</em></label>
        <div>
          ${form.select('task_ok_id', None, [('', u' ')] + project['task_labels'].items())}
          ${_('mode')}
          ${form.select('task_ok_mode', None, LINK_TYPES.items())}
        </div>
      </div>
      ${tab_set.tab_end()}
    </div>
  </div>
</div>
</body>
</html>
