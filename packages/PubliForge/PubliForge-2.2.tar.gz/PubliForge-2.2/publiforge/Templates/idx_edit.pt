<metal:main use-macro="base"
            xmlns:tal="http://xml.zope.org/namespaces/tal"
            xmlns:metal="http://xml.zope.org/namespaces/metal">
<div id="mainPanel" metal:fill-slot="main">
  <!-- ............................... Buttons ............................ -->
  <div id="buttons">
    <div class="first">
      ${request.breadcrumbs.back_button()}
    </div>
    <div class="last" tal:switch="indexer is None">
      <div tal:case="True" tal:omit-tag="">
        ${form.submit('sav!.x', _('Create'), class_='buttonMain')}
        ${form.button(route('indexer_admin'), _('Cancel'))}
      </div>
      <div tal:case="False" tal:omit-tag="">
        ${form.submit('sav!.x', _('Save'), class_='buttonMain')}
        ${form.button(route('indexer_view', indexer_id=indexer.indexer_id), _('Cancel'))}
      </div>
    </div>
    <hr class="hidden"/>
  </div>
  <div id="main">
    <h2 id="subtitle" class="indexer" title="${_('Indexer settings')}">${indexer and label}</h2>
    <!-- ............................. Flash .............................. -->
    <div tal:define="flash load: flash.macro.pt" metal:use-macro="flash"/>
    <!-- ................................ Tabs ............................ -->
    <div id="tabSet">
      ${tab_set.toc('tabIndexer')}
      <!-- ..... Description ...... -->
      ${tab_set.tab_begin(0, 'd')}
      <div tal:switch="indexer is None" tal:omit-tag="">
        <div tal:case="True" tal:omit-tag="">
          ${form.grid_text('indexer_id', _('Identifier:'), required=True, clear=True)}
        </div>
        <div tal:case="False" tal:omit-tag="">
          ${form.grid_item(_('Identifier:'), indexer.indexer_id, class_='', clear=True)}
        </div>
      </div>
      <div tal:repeat="lang labels" tal:omit-tag="">
        ${form.grid_text('label_%s' % lang, _('Label (${l}):', {'l': lang}),
          required=lang == default_lang, clear=True)}
      </div>
      ${form.grid_select('value_type',
        _('Type of value:'), [('', u' ')] + INDEX_VALUE_TYPES.items(), required=True, clear=True)}
      ${form.grid_select('display', _('Display:'),
        [('', u' ')] + DISPLAYS.items(), clear=True)}
      ${form.grid_select('result_column', _('Result column:'),
        [('', u' '), 1, 2, 3, 4, 5, 6, 7, 8], clear=True)}
      ${tab_set.tab_end()}
      <!-- ...... Extractors ...... -->
      ${tab_set.tab_begin(1, 'e')}
      <div class="listActions"
           tal:condition="indexer and indexer.value_type not in ('filename', 'filetype')">
        <div class="first">
          <img src="/Static/Images/extractor22.png" alt="${_('Extractors')}"/>
          <label>${_('Extractors')}</label>
        </div>
        <div class="last"> </div>
      </div>
      <table class="list smallList"
             tal:condition="indexer and indexer.value_type not in ('filename', 'filetype')">
        <tr>
          <th>${_('Indexed files')}</th>
          <th>${_('Type')}</th>
          <th>${_('Parameter')}</th>
          <th>${_('Limit')}</th>
          <th class="last">${_('Action')}</th>
        </tr>
        <tr tal:repeat="extractor indexer.extractors">
          <td>
            ${form.text('ex_%d_files' % extractor.extractor_id)}
            <span class="error" tal:condition="form.has_error('ex_%d_files' % extractor.extractor_id)"><strong>
              ${form.error('ex_%d_files' % extractor.extractor_id)}
            </strong></span>
          </td>
          <td>
            ${form.select('ex_%d_type' % extractor.extractor_id, None, EXTRACTOR_TYPES.items())}
            <span class="error" tal:condition="form.has_error('ex_%d_type' % extractor.extractor_id)"><strong>
              ${form.error('ex_%d_type' % extractor.extractor_id)}
            </strong></span>
          </td>
          <td>
            ${form.text('ex_%d_param' % extractor.extractor_id)}
            <span class="error" tal:condition="form.has_error('ex_%d_param' % extractor.extractor_id)"><strong>
              ${form.error('ex_%d_param' % extractor.extractor_id)}
            </strong></span>
          </td>
          <td>
            ${form.text('ex_%d_limit' % extractor.extractor_id, size=3)}
            <span class="error" tal:condition="form.has_error('ex_%d_limit' % extractor.extractor_id)"><strong>
              ${form.error('ex_%d_limit' % extractor.extractor_id)}
            </strong></span>
          </td>
          <td class="last actions" tal:switch="action == 'del?%d' % extractor.extractor_id">
            <span tal:case="True" tal:omit-tag="">
              ${form.submit('del!%d.x' % extractor.extractor_id, _('Confirm deletion'), class_='button')}
              ${form.submit_cancel(_('Cancel'))}
            </span>
            <span tal:case="False" tal:omit-tag="">
              ${form.submit_image('del?%d' % extractor.extractor_id, _('Delete extractor'),
                '/Static/Images/action_delete_one.png')}
            </span>
          </td>
        </tr>
        <tr tal:condition="indexer">
          <td>
            ${form.text('ex_files')}
            <span class="error" tal:condition="form.has_error('ex_files')"><strong>
              ${form.error('ex_files')}
            </strong></span>
          </td>
          <td>
            ${form.select('ex_type', None, [('', '')] + EXTRACTOR_TYPES.items())}
            <span class="error" tal:condition="form.has_error('ex_type')"><strong>
              ${form.error('ex_type')}
            </strong></span>
          </td>
          <td>
            ${form.text('ex_param')}
            <span class="error" tal:condition="form.has_error('ex_param')"><strong>
              ${form.error('ex_param')}
            </strong></span>
          </td>
          <td>
            ${form.text('ex_limit', size=3)}
            <span class="error" tal:condition="form.has_error('ex_limit')"><strong>
              ${form.error('ex_limit')}
            </strong></span>
          </td>
          <td> </td>
        </tr>
     </table>
      <div tal:condition="not indexer">${_('Create indexer before adding extractors.')}</div>
      <div tal:condition="indexer and indexer.value_type in ('filename', 'filetype')">
        ${_('This indexer do not use extractors.')}
      </div>
      ${tab_set.tab_end()}
      <!-- ...... Closed list ..... -->
      ${tab_set.tab_begin(2, 'l')}
      <div class="listActions"
           tal:condition="indexer and indexer.value_type in ('select', 'filetype')">
        <div class="first"><img src="/Static/Images/value22.png" alt="${_('values')}"/></div>
        <div class="last"> </div>
      </div>
      <table class="list smallList"
             tal:condition="indexer and indexer.value_type in ('select', 'filetype')">
        <tr>
          <th>${_('Label')}</th>
          <th>${_('Value')}</th>
          <th class="last">${_('Action')}</th>
        </tr>
        <tr tal:repeat="value indexer.values">
          <td>
            ${form.text('val_%d_label' % value.value_id)}
            <span class="error" tal:condition="form.has_error('val_%d_label' % value.value_id)"><strong>
              ${form.error('val_%d_label' % value.value_id)}
            </strong></span>
          </td>
          <td>
            ${form.text('val_%d_value' % value.value_id)}
            <span class="error" tal:condition="form.has_error('val_%d_value' % value.value_id)"><strong>
              ${form.error('val_%d_value' % value.value_id)}
            </strong></span>
          </td>
          <td class="last actions" tal:switch="action == 'dvl?%d' % value.value_id">
            <span tal:case="True" tal:omit-tag="">
              ${form.submit('dvl!%d.x' % value.value_id, _('Confirm deletion'), class_='button')}
              ${form.submit_cancel(_('Cancel'))}
            </span>
            <span tal:case="False" tal:omit-tag="">
              ${form.submit_image('dvl?%d' % value.value_id, _('Delete value'),
                '/Static/Images/action_delete_one.png')}
            </span>
          </td>
        </tr>
        <tr tal:condition="indexer">
          <td>
            ${form.text('val_label')}
            <span class="error" tal:condition="form.has_error('val_label')"><strong>
              ${form.error('val_label')}
            </strong></span>
          </td>
          <td>
            ${form.text('val_value')}
            <span class="error" tal:condition="form.has_error('val_value')"><strong>
              ${form.error('val_value')}
            </strong></span>
          </td>
        </tr>
      </table>
      <div tal:condition="indexer and indexer.value_type not in ('select', 'filetype')">
        ${_('This indexer do not use a closed list of values.')}
      </div>
      <div tal:condition="not indexer">${_('Create indexer before adding values.')}</div>
      ${tab_set.tab_end()}
      </div>
    </div>
</div>
</metal:main>
