<metal:main use-macro="base"
            xmlns:tal="http://xml.zope.org/namespaces/tal"
            xmlns:metal="http://xml.zope.org/namespaces/metal">
<div id="mainPanel" metal:fill-slot="main">
  <div id="main">
    <h2 id="subtitle" class="search" title="${_('Search')}">${_('Advanced search')}</h2>
    <!-- ............................... Search ........................... -->
    <div id="search">
      <div id="scope">
        <div class="label">${_('Scope:')}</div>
        <div class="value">
          <div tal:repeat="item scope">
            ${form.custom_checkbox('~%s' % item[0])}
            <label for="${item[0].lower()}">${item[1]}</label>
          </div>
          <div>
            ${form.custom_checkbox('~ALL~')}
            <label for="all">${_('All storages')}</label>
          </div>
        </div>
      </div>

      <div>
        <div class="label">${_('Filter:')}</div>
        <div class="value">
          <div class="wbFilterConditions">${wfilter.html_conditions()}</div>
          <div class="wbFilterInputs">${wfilter.html_inputs(form, 'div')}</div>
        </div>
      </div>

      <div class="wbFilterExecute">
        ${form.submit('filter', _('Launch search'), class_='buttonMain slow')}
        ${form.submit('crm!all.x', _('Clear filter'), class_='button')}
      </div>
    </div>
    <!-- ............................. Flash .............................. -->
    <div tal:define="flash load: flash.macro.pt" metal:use-macro="flash"/>
    <!-- ............................... Result ........................... -->
    <div tal:condition="paging is not None" tal:define="join import: os.path.join">
      <div class="listActions">
        <div class="first">${paging.pager_top()}</div>
        <div class="last">
          <span tal:condition="'project' in request.session" tal:omit-tag="">
            ${form.submit_image('npk!#', _('Create a pack with selected files for "${p}"',
              dict(p=request.session['project']['label'])), '/Static/Images/action_pack.png')}
          </span>
          ${form.submit_image('sel!#', _('Add selected files to the selection'),
            '/Static/Images/action_select.png')}
          <img src="/Static/Images/action_pipe.png" alt="Pipe"/>
          ${form.submit_image('dnl!#', _('Download files'),
            '/Static/Images/action_download.png')}
          ${form.submit_image('csv!#', _('Export result as CSV'),
            '/Static/Images/action_export_csv.png')}
        </div>
      </div>
      <div id="content">
        <table class="list">
          <tr>
            <th class="checkbox" id="check_all"></th>
            <th tal:repeat="column result_columns" class="search-${column[0]}">
              ${paging.sortable_column(_(column[2]), column[0])}
            </th>
            <th class="last">${_('Actions')}</th>
          </tr>
          <tr tal:repeat="item paging">
            <td class="checkbox">
              ${form.checkbox('#%s' % join(item['storage_id'], item['path']), id=None,
                class_='listCheck')}
            </td>
            <td tal:repeat="column result_columns" class="search-${column[0]}">
              <span tal:switch="column[1]" tal:omit-tag="">
                <a tal:case="'path'" class="selectable"
                   data-path="${join(item['storage_id'], item['path'])}"
                   href="${route('file_render', storage_id=item['storage_id'], path=item['path'])}">
                  ${join(item['storage_id'], item['path'])}
                </a>
                <a tal:case="'image'" tal:condition="item.get(column[0])" class="selectable"
                   data-path="${join(item['storage_id'], item['path'])}"
                   href="${route('file_render', storage_id=item['storage_id'], path=item['path'])}">
                  <img src="${route('file_download', storage_id=item['storage_id'], path=item[column[0]])}"
                       alt="${item[column[0]]}" height="48"/>
                </a>
                <a tal:case="default" class="selectable"
                   title="${join(item['storage_id'], item['path'])}"
                   data-path="${join(item['storage_id'], item['path'])}"
                   href="${route('file_render', storage_id=item['storage_id'], path=item['path'])}">
                  ${item.get(column[0], '')}
                </a>
              </span>
            </td>
            <td class="last actions">
              ${form.submit_image('sel!%s/%s' % (item['storage_id'], item['path']),
                _('Add to selection'), '/Static/Images/action_select_one.png')}
              ${form.button(route('file_info', storage_id=item['storage_id'], path=item['path']),
                src='/Static/Images/action_info_one.png', title=_('Display file information'),
                class_="slow")}
              ${form.button(route('file_download', storage_id=item['storage_id'], path=item['path']),
                src='/Static/Images/action_download_one.png', title=_('Download file'))}
              ${form.button(route('storage_browse', storage_id=item['storage_id'], path=item['path']),
                src='/Static/Images/action_browse.png', title=_('View in storage'), class_="slow")}
            </td>
          </tr>
        </table>
      </div>
      <div class="listPager">
        <div class="first">${paging.pager_bottom()}</div>
        <div class="last">
          ${_('Lines per page:')} ${form.select('page_size', '', PAGE_SIZES, True)}
        </div>
      </div>
    </div>
    <div tal:condition="paging is None and not wfilter.is_empty()"
         class="searchNoHits">
      <strong>${_('No hits')}</strong>
    </div>
  </div>
</div>
</metal:main>
