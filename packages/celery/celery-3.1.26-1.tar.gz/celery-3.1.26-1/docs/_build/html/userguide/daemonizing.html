
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Daemonization &#8212; Celery 4.2.0 documentation</title>
    <link rel="stylesheet" href="../_static/celery.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="Periodic Tasks" href="periodic-tasks.html" />
    <link rel="prev" title="Workers Guide" href="workers.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="periodic-tasks.html" title="Periodic Tasks"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="workers.html" title="Workers Guide"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Celery 4.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">User Guide</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
<div class="deck">

    
        <p>
        This document describes the current stable version of Celery (4.2).
        For development docs,
        <a href="http://docs.celeryproject.org/en/master/userguide/daemonizing.html">go here</a>.
        </p>
    

</div>
    <div class="section" id="daemonization">
<span id="daemonizing"></span><h1>Daemonization<a class="headerlink" href="#daemonization" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#generic-init-scripts" id="id5">Generic init-scripts</a><ul>
<li><a class="reference internal" href="#init-script-celeryd" id="id6">Init-script: <code class="docutils literal notranslate"><span class="pre">celeryd</span></code></a><ul>
<li><a class="reference internal" href="#example-configuration" id="id7">Example configuration</a></li>
<li><a class="reference internal" href="#using-a-login-shell" id="id8">Using a login shell</a></li>
<li><a class="reference internal" href="#example-django-configuration" id="id9">Example Django configuration</a></li>
<li><a class="reference internal" href="#available-options" id="id10">Available options</a></li>
</ul>
</li>
<li><a class="reference internal" href="#init-script-celerybeat" id="id11">Init-script: <code class="docutils literal notranslate"><span class="pre">celerybeat</span></code></a><ul>
<li><a class="reference internal" href="#generic-initd-celerybeat-example" id="id12">Example configuration</a></li>
<li><a class="reference internal" href="#generic-initd-celerybeat-django-example" id="id13">Example Django configuration</a></li>
<li><a class="reference internal" href="#generic-initd-celerybeat-options" id="id14">Available options</a></li>
</ul>
</li>
<li><a class="reference internal" href="#troubleshooting" id="id15">Troubleshooting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage-systemd" id="id16">Usage <code class="docutils literal notranslate"><span class="pre">systemd</span></code></a><ul>
<li><a class="reference internal" href="#service-file-celery-service" id="id17">Service file: celery.service</a><ul>
<li><a class="reference internal" href="#generic-systemd-celery-example" id="id18">Example configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#running-the-worker-with-superuser-privileges-root" id="id19">Running the worker with superuser privileges (root)</a></li>
<li><a class="reference internal" href="#supervisor" id="id20">supervisor</a></li>
<li><a class="reference internal" href="#launchd-macos" id="id21"><code class="docutils literal notranslate"><span class="pre">launchd</span></code> (macOS)</a></li>
</ul>
</div>
<div class="section" id="generic-init-scripts">
<span id="daemon-generic"></span><h2><a class="toc-backref" href="#id5">Generic init-scripts</a><a class="headerlink" href="#generic-init-scripts" title="Permalink to this headline">¶</a></h2>
<p>See the <a class="reference external" href="https://github.com/celery/celery/tree/3.1/extra/generic-init.d/">extra/generic-init.d/</a> directory Celery distribution.</p>
<p>This directory contains generic bash init-scripts for the
<strong class="program">celery worker</strong> program,
these should run on Linux, FreeBSD, OpenBSD, and other Unix-like platforms.</p>
<div class="section" id="init-script-celeryd">
<span id="generic-initd-celeryd"></span><h3><a class="toc-backref" href="#id6">Init-script: <code class="docutils literal notranslate"><span class="pre">celeryd</span></code></a><a class="headerlink" href="#init-script-celeryd" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Usage:</th><td class="field-body"><cite>/etc/init.d/celeryd {start|stop|restart|status}</cite></td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Configuration file:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><code class="file docutils literal notranslate"><span class="pre">/etc/default/celeryd</span></code></td>
</tr>
</tbody>
</table>
<p>To configure this script to run the worker properly you probably need to at least
tell it where to change
directory to when it starts (to find the module containing your app, or your
configuration module).</p>
<p>The daemonization script is configured by the file <code class="file docutils literal notranslate"><span class="pre">/etc/default/celeryd</span></code>.
This is a shell (<strong class="command">sh</strong>) script where you can add environment variables like
the configuration options below.  To add real environment variables affecting
the worker you must also export them (e.g., <strong class="command">export DISPLAY=&quot;:0&quot;</strong>)</p>
<div class="admonition-superuser-privileges-required admonition">
<p class="first admonition-title">Superuser privileges required</p>
<p>The init-scripts can only be used by root,
and the shell configuration file must also be owned by root.</p>
<p>Unprivileged users don’t need to use the init-script,
instead they can use the <strong class="program">celery multi</strong> utility (or
<strong class="program">celery worker --detach</strong>):</p>
<div class="last highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery multi start worker1 <span class="se">\</span>
    -A proj <span class="se">\</span>
    --pidfile<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/run/celery/%n.pid&quot;</span> <span class="se">\</span>
    --logfile<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/log/celery/%n%I.log&quot;</span>

<span class="gp">$</span> celery multi restart worker1 <span class="se">\</span>
    -A proj <span class="se">\</span>
    --logfile<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/log/celery/%n%I.log&quot;</span> <span class="se">\</span>
    --pidfile<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/run/celery/%n.pid</span>

<span class="gp">$</span> celery multi stopwait worker1 --pidfile<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/run/celery/%n.pid&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="example-configuration">
<span id="generic-initd-celeryd-example"></span><h4><a class="toc-backref" href="#id7">Example configuration</a><a class="headerlink" href="#example-configuration" title="Permalink to this headline">¶</a></h4>
<p>This is an example configuration for a Python project.</p>
<p><code class="file docutils literal notranslate"><span class="pre">/etc/default/celeryd</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Names of nodes to start</span>
<span class="c1">#   most people will only start one node:</span>
<span class="nv">CELERYD_NODES</span><span class="o">=</span><span class="s2">&quot;worker1&quot;</span>
<span class="c1">#   but you can also start multiple and configure settings</span>
<span class="c1">#   for each in CELERYD_OPTS</span>
<span class="c1">#CELERYD_NODES=&quot;worker1 worker2 worker3&quot;</span>
<span class="c1">#   alternatively, you can specify the number of nodes to start:</span>
<span class="c1">#CELERYD_NODES=10</span>

<span class="c1"># Absolute or relative path to the &#39;celery&#39; command:</span>
<span class="nv">CELERY_BIN</span><span class="o">=</span><span class="s2">&quot;/usr/local/bin/celery&quot;</span>
<span class="c1">#CELERY_BIN=&quot;/virtualenvs/def/bin/celery&quot;</span>

<span class="c1"># App instance to use</span>
<span class="c1"># comment out this line if you don&#39;t use an app</span>
<span class="nv">CELERY_APP</span><span class="o">=</span><span class="s2">&quot;proj&quot;</span>
<span class="c1"># or fully qualified:</span>
<span class="c1">#CELERY_APP=&quot;proj.tasks:app&quot;</span>

<span class="c1"># Where to chdir at start.</span>
<span class="nv">CELERYD_CHDIR</span><span class="o">=</span><span class="s2">&quot;/opt/Myproject/&quot;</span>

<span class="c1"># Extra command-line arguments to the worker</span>
<span class="nv">CELERYD_OPTS</span><span class="o">=</span><span class="s2">&quot;--time-limit=300 --concurrency=8&quot;</span>
<span class="c1"># Configure node-specific settings by appending node name to arguments:</span>
<span class="c1">#CELERYD_OPTS=&quot;--time-limit=300 -c 8 -c:worker2 4 -c:worker3 2 -Ofair:worker1&quot;</span>

<span class="c1"># Set logging level to DEBUG</span>
<span class="c1">#CELERYD_LOG_LEVEL=&quot;DEBUG&quot;</span>

<span class="c1"># %n will be replaced with the first part of the nodename.</span>
<span class="nv">CELERYD_LOG_FILE</span><span class="o">=</span><span class="s2">&quot;/var/log/celery/%n%I.log&quot;</span>
<span class="nv">CELERYD_PID_FILE</span><span class="o">=</span><span class="s2">&quot;/var/run/celery/%n.pid&quot;</span>

<span class="c1"># Workers should run as an unprivileged user.</span>
<span class="c1">#   You need to create this user manually (or you can choose</span>
<span class="c1">#   a user/group combination that already exists (e.g., nobody).</span>
<span class="nv">CELERYD_USER</span><span class="o">=</span><span class="s2">&quot;celery&quot;</span>
<span class="nv">CELERYD_GROUP</span><span class="o">=</span><span class="s2">&quot;celery&quot;</span>

<span class="c1"># If enabled pid and log directories will be created if missing,</span>
<span class="c1"># and owned by the userid/group configured.</span>
<span class="nv">CELERY_CREATE_DIRS</span><span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
</div>
<div class="section" id="using-a-login-shell">
<h4><a class="toc-backref" href="#id8">Using a login shell</a><a class="headerlink" href="#using-a-login-shell" title="Permalink to this headline">¶</a></h4>
<p>You can inherit the environment of the <code class="docutils literal notranslate"><span class="pre">CELERYD_USER</span></code> by using a login
shell:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CELERYD_SU_ARGS</span><span class="o">=</span><span class="s2">&quot;-l&quot;</span>
</pre></div>
</div>
<p>Note that this isn’t recommended, and that you should only use this option
when absolutely necessary.</p>
</div>
<div class="section" id="example-django-configuration">
<span id="generic-initd-celeryd-django-example"></span><h4><a class="toc-backref" href="#id9">Example Django configuration</a><a class="headerlink" href="#example-django-configuration" title="Permalink to this headline">¶</a></h4>
<p>Django users now uses the exact same template as above,
but make sure that the module that defines your Celery app instance
also sets a default value for <span class="target" id="index-0"></span><a class="reference external" href="http://django.readthedocs.io/en/latest/topics/settings.html#envvar-DJANGO_SETTINGS_MODULE" title="(in Django v2.1)"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">DJANGO_SETTINGS_MODULE</span></code></a>
as shown in the example Django project in <a class="reference internal" href="../django/first-steps-with-django.html#django-first-steps"><span class="std std-ref">First steps with Django</span></a>.</p>
</div>
<div class="section" id="available-options">
<span id="generic-initd-celeryd-options"></span><h4><a class="toc-backref" href="#id10">Available options</a><a class="headerlink" href="#available-options" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERY_APP</span></code></p>
<blockquote>
<div><p>App instance to use (value for <a class="reference internal" href="../reference/celery.bin.celery.html#cmdoption-celery-a"><code class="xref std std-option docutils literal notranslate"><span class="pre">--app</span></code></a> argument).</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERY_BIN</span></code></p>
<blockquote>
<div><p>Absolute or relative path to the <strong class="program">celery</strong> program.
Examples:</p>
<blockquote>
<div><ul class="simple">
<li><code class="file docutils literal notranslate"><span class="pre">celery</span></code></li>
<li><code class="file docutils literal notranslate"><span class="pre">/usr/local/bin/celery</span></code></li>
<li><code class="file docutils literal notranslate"><span class="pre">/virtualenvs/proj/bin/celery</span></code></li>
<li><code class="file docutils literal notranslate"><span class="pre">/virtualenvs/proj/bin/python</span> <span class="pre">-m</span> <span class="pre">celery</span></code></li>
</ul>
</div></blockquote>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERYD_NODES</span></code></p>
<blockquote>
<div><p>List of node names to start (separated by space).</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERYD_OPTS</span></code></p>
<blockquote>
<div><p>Additional command-line arguments for the worker, see
<cite>celery worker –help</cite> for a list. This also supports the extended
syntax used by <cite>multi</cite> to configure settings for individual nodes.
See <cite>celery multi –help</cite> for some multi-node configuration examples.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERYD_CHDIR</span></code></p>
<blockquote>
<div><p>Path to change directory to at start. Default is to stay in the current
directory.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERYD_PID_FILE</span></code></p>
<blockquote>
<div><p>Full path to the PID file. Default is /var/run/celery/%n.pid</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERYD_LOG_FILE</span></code></p>
<blockquote>
<div><p>Full path to the worker log file. Default is /var/log/celery/%n%I.log
<strong>Note</strong>: Using <cite>%I</cite> is important when using the prefork pool as having
multiple processes share the same log file will lead to race conditions.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERYD_LOG_LEVEL</span></code></p>
<blockquote>
<div><p>Worker log level. Default is INFO.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERYD_USER</span></code></p>
<blockquote>
<div><p>User to run the worker as. Default is current user.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERYD_GROUP</span></code></p>
<blockquote>
<div><p>Group to run worker as. Default is current user.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERY_CREATE_DIRS</span></code></p>
<blockquote>
<div><p>Always create directories (log directory and pid file directory).
Default is to only create directories when no custom logfile/pidfile set.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERY_CREATE_RUNDIR</span></code></p>
<blockquote>
<div><p>Always create pidfile directory. By default only enabled when no custom
pidfile location set.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERY_CREATE_LOGDIR</span></code></p>
<blockquote>
<div><p>Always create logfile directory. By default only enable when no custom
logfile location set.</p>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="init-script-celerybeat">
<span id="generic-initd-celerybeat"></span><h3><a class="toc-backref" href="#id11">Init-script: <code class="docutils literal notranslate"><span class="pre">celerybeat</span></code></a><a class="headerlink" href="#init-script-celerybeat" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Usage:</th><td class="field-body"><cite>/etc/init.d/celerybeat {start|stop|restart}</cite></td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Configuration file:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><code class="file docutils literal notranslate"><span class="pre">/etc/default/celerybeat</span></code> or
<code class="file docutils literal notranslate"><span class="pre">/etc/default/celeryd</span></code>.</td>
</tr>
</tbody>
</table>
<div class="section" id="generic-initd-celerybeat-example">
<span id="id1"></span><h4><a class="toc-backref" href="#id12">Example configuration</a><a class="headerlink" href="#generic-initd-celerybeat-example" title="Permalink to this headline">¶</a></h4>
<p>This is an example configuration for a Python project:</p>
<p><cite>/etc/default/celerybeat</cite>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Absolute or relative path to the &#39;celery&#39; command:</span>
<span class="nv">CELERY_BIN</span><span class="o">=</span><span class="s2">&quot;/usr/local/bin/celery&quot;</span>
<span class="c1">#CELERY_BIN=&quot;/virtualenvs/def/bin/celery&quot;</span>

<span class="c1"># App instance to use</span>
<span class="c1"># comment out this line if you don&#39;t use an app</span>
<span class="nv">CELERY_APP</span><span class="o">=</span><span class="s2">&quot;proj&quot;</span>
<span class="c1"># or fully qualified:</span>
<span class="c1">#CELERY_APP=&quot;proj.tasks:app&quot;</span>

<span class="c1"># Where to chdir at start.</span>
<span class="nv">CELERYBEAT_CHDIR</span><span class="o">=</span><span class="s2">&quot;/opt/Myproject/&quot;</span>

<span class="c1"># Extra arguments to celerybeat</span>
<span class="nv">CELERYBEAT_OPTS</span><span class="o">=</span><span class="s2">&quot;--schedule=/var/run/celery/celerybeat-schedule&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="generic-initd-celerybeat-django-example">
<span id="id2"></span><h4><a class="toc-backref" href="#id13">Example Django configuration</a><a class="headerlink" href="#generic-initd-celerybeat-django-example" title="Permalink to this headline">¶</a></h4>
<p>You should use the same template as above, but make sure the
<code class="docutils literal notranslate"><span class="pre">DJANGO_SETTINGS_MODULE</span></code> variable is set (and exported), and that
<code class="docutils literal notranslate"><span class="pre">CELERYD_CHDIR</span></code> is set to the projects directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">DJANGO_SETTINGS_MODULE</span><span class="o">=</span><span class="s2">&quot;settings&quot;</span>

<span class="nv">CELERYD_CHDIR</span><span class="o">=</span><span class="s2">&quot;/opt/MyProject&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="generic-initd-celerybeat-options">
<span id="id3"></span><h4><a class="toc-backref" href="#id14">Available options</a><a class="headerlink" href="#generic-initd-celerybeat-options" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERY_APP</span></code></p>
<blockquote>
<div><p>App instance to use (value for <a class="reference internal" href="../reference/celery.bin.celery.html#cmdoption-celery-a"><code class="xref std std-option docutils literal notranslate"><span class="pre">--app</span></code></a> argument).</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERYBEAT_OPTS</span></code></p>
<blockquote>
<div><p>Additional arguments to <strong class="program">celery beat</strong>, see
<strong class="command">celery beat --help</strong> for a list of available options.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERYBEAT_PID_FILE</span></code></p>
<blockquote>
<div><p>Full path to the PID file. Default is <code class="file docutils literal notranslate"><span class="pre">/var/run/celeryd.pid</span></code>.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERYBEAT_LOG_FILE</span></code></p>
<blockquote>
<div><p>Full path to the log file. Default is <code class="file docutils literal notranslate"><span class="pre">/var/log/celeryd.log</span></code>.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERYBEAT_LOG_LEVEL</span></code></p>
<blockquote>
<div><p>Log level to use. Default is <code class="docutils literal notranslate"><span class="pre">INFO</span></code>.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERYBEAT_USER</span></code></p>
<blockquote>
<div><p>User to run beat as. Default is the current user.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERYBEAT_GROUP</span></code></p>
<blockquote>
<div><p>Group to run beat as. Default is the current user.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERY_CREATE_DIRS</span></code></p>
<blockquote>
<div><p>Always create directories (log directory and pid file directory).
Default is to only create directories when no custom logfile/pidfile set.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERY_CREATE_RUNDIR</span></code></p>
<blockquote>
<div><p>Always create pidfile directory. By default only enabled when no custom
pidfile location set.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">CELERY_CREATE_LOGDIR</span></code></p>
<blockquote>
<div><p>Always create logfile directory. By default only enable when no custom
logfile location set.</p>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="troubleshooting">
<span id="generic-initd-troubleshooting"></span><h3><a class="toc-backref" href="#id15">Troubleshooting</a><a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h3>
<p>If you can’t get the init-scripts to work, you should try running
them in <em>verbose mode</em>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> sh -x /etc/init.d/celeryd start
</pre></div>
</div>
<p>This can reveal hints as to why the service won’t start.</p>
<p>If the worker starts with <em>“OK”</em> but exits almost immediately afterwards
and there’s no evidence in the log file, then there’s probably an error
but as the daemons standard outputs are already closed you’ll
not be able to see them anywhere. For this situation you can use
the <span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">C_FAKEFORK</span></code> environment variable to skip the
daemonization step:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> <span class="nv">C_FAKEFORK</span><span class="o">=</span><span class="m">1</span> sh -x /etc/init.d/celeryd start
</pre></div>
</div>
<p>and now you should be able to see the errors.</p>
<p>Commonly such errors are caused by insufficient permissions
to read from, or write to a file, and also by syntax errors
in configuration modules, user modules, third-party libraries,
or even from Celery itself (if you’ve found a bug you
should <a class="reference internal" href="../contributing.html#reporting-bugs"><span class="std std-ref">report it</span></a>).</p>
</div>
</div>
<div class="section" id="usage-systemd">
<span id="daemon-systemd-generic"></span><h2><a class="toc-backref" href="#id16">Usage <code class="docutils literal notranslate"><span class="pre">systemd</span></code></a><a class="headerlink" href="#usage-systemd" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://github.com/celery/celery/tree/3.1/extra/systemd/">extra/systemd/</a></li>
</ul>
<table class="docutils field-list" frame="void" id="generic-systemd-celery" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Usage:</th><td class="field-body"><cite>systemctl {start|stop|restart|status} celery.service</cite></td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Configuration file:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body">/etc/conf.d/celery</td>
</tr>
</tbody>
</table>
<div class="section" id="service-file-celery-service">
<h3><a class="toc-backref" href="#id17">Service file: celery.service</a><a class="headerlink" href="#service-file-celery-service" title="Permalink to this headline">¶</a></h3>
<p>This is an example systemd file:</p>
<p><code class="file docutils literal notranslate"><span class="pre">/etc/systemd/system/celery.service</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>Celery Service
<span class="nv">After</span><span class="o">=</span>network.target

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">Type</span><span class="o">=</span>forking
<span class="nv">User</span><span class="o">=</span>celery
<span class="nv">Group</span><span class="o">=</span>celery
<span class="nv">EnvironmentFile</span><span class="o">=</span>/etc/conf.d/celery
<span class="nv">WorkingDirectory</span><span class="o">=</span>/opt/celery
<span class="nv">ExecStart</span><span class="o">=</span>/bin/sh -c <span class="s1">&#39;${CELERY_BIN} multi start ${CELERYD_NODES} \</span>
<span class="s1">  -A ${CELERY_APP} --pidfile=${CELERYD_PID_FILE} \</span>
<span class="s1">  --logfile=${CELERYD_LOG_FILE} --loglevel=${CELERYD_LOG_LEVEL} ${CELERYD_OPTS}&#39;</span>
<span class="nv">ExecStop</span><span class="o">=</span>/bin/sh -c <span class="s1">&#39;${CELERY_BIN} multi stopwait ${CELERYD_NODES} \</span>
<span class="s1">  --pidfile=${CELERYD_PID_FILE}&#39;</span>
<span class="nv">ExecReload</span><span class="o">=</span>/bin/sh -c <span class="s1">&#39;${CELERY_BIN} multi restart ${CELERYD_NODES} \</span>
<span class="s1">  -A ${CELERY_APP} --pidfile=${CELERYD_PID_FILE} \</span>
<span class="s1">  --logfile=${CELERYD_LOG_FILE} --loglevel=${CELERYD_LOG_LEVEL} ${CELERYD_OPTS}&#39;</span>

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre></div>
</div>
<p>Once you’ve put that file in <code class="file docutils literal notranslate"><span class="pre">/etc/systemd/system</span></code>, you should run
<strong class="command">systemctl daemon-reload</strong> in order that Systemd acknowledges that file.
You should also run that command each time you modify it.</p>
<p>To configure user, group, <strong class="command">chdir</strong> change settings:
<code class="docutils literal notranslate"><span class="pre">User</span></code>, <code class="docutils literal notranslate"><span class="pre">Group</span></code>, and <code class="docutils literal notranslate"><span class="pre">WorkingDirectory</span></code> defined in
<code class="file docutils literal notranslate"><span class="pre">/etc/systemd/system/celery.service</span></code>.</p>
<p>You can also use systemd-tmpfiles in order to create working directories (for logs and pid).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">file:</th><td class="field-body"><cite>/etc/tmpfiles.d/celery.conf</cite></td>
</tr>
</tbody>
</table>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>d /var/run/celery <span class="m">0755</span> celery celery -
d /var/log/celery <span class="m">0755</span> celery celery -
</pre></div>
</div>
<div class="section" id="generic-systemd-celery-example">
<span id="id4"></span><h4><a class="toc-backref" href="#id18">Example configuration</a><a class="headerlink" href="#generic-systemd-celery-example" title="Permalink to this headline">¶</a></h4>
<p>This is an example configuration for a Python project:</p>
<p><code class="file docutils literal notranslate"><span class="pre">/etc/conf.d/celery</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Name of nodes to start</span>
<span class="c1"># here we have a single node</span>
<span class="nv">CELERYD_NODES</span><span class="o">=</span><span class="s2">&quot;w1&quot;</span>
<span class="c1"># or we could have three nodes:</span>
<span class="c1">#CELERYD_NODES=&quot;w1 w2 w3&quot;</span>

<span class="c1"># Absolute or relative path to the &#39;celery&#39; command:</span>
<span class="nv">CELERY_BIN</span><span class="o">=</span><span class="s2">&quot;/usr/local/bin/celery&quot;</span>
<span class="c1">#CELERY_BIN=&quot;/virtualenvs/def/bin/celery&quot;</span>

<span class="c1"># App instance to use</span>
<span class="c1"># comment out this line if you don&#39;t use an app</span>
<span class="nv">CELERY_APP</span><span class="o">=</span><span class="s2">&quot;proj&quot;</span>
<span class="c1"># or fully qualified:</span>
<span class="c1">#CELERY_APP=&quot;proj.tasks:app&quot;</span>

<span class="c1"># How to call manage.py</span>
<span class="nv">CELERYD_MULTI</span><span class="o">=</span><span class="s2">&quot;multi&quot;</span>

<span class="c1"># Extra command-line arguments to the worker</span>
<span class="nv">CELERYD_OPTS</span><span class="o">=</span><span class="s2">&quot;--time-limit=300 --concurrency=8&quot;</span>

<span class="c1"># - %n will be replaced with the first part of the nodename.</span>
<span class="c1"># - %I will be replaced with the current child process index</span>
<span class="c1">#   and is important when using the prefork pool to avoid race conditions.</span>
<span class="nv">CELERYD_PID_FILE</span><span class="o">=</span><span class="s2">&quot;/var/run/celery/%n.pid&quot;</span>
<span class="nv">CELERYD_LOG_FILE</span><span class="o">=</span><span class="s2">&quot;/var/log/celery/%n%I.log&quot;</span>
<span class="nv">CELERYD_LOG_LEVEL</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="running-the-worker-with-superuser-privileges-root">
<h2><a class="toc-backref" href="#id19">Running the worker with superuser privileges (root)</a><a class="headerlink" href="#running-the-worker-with-superuser-privileges-root" title="Permalink to this headline">¶</a></h2>
<p>Running the worker with superuser privileges is a very dangerous practice.
There should always be a workaround to avoid running as root. Celery may
run arbitrary code in messages serialized with pickle - this is dangerous,
especially when run as root.</p>
<p>By default Celery won’t run workers as root. The associated error
message may not be visible in the logs but may be seen if <span class="target" id="index-2"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">C_FAKEFORK</span></code>
is used.</p>
<p>To force Celery to run workers as root use <span class="target" id="index-3"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">C_FORCE_ROOT</span></code>.</p>
<p>When running as root without <span class="target" id="index-4"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">C_FORCE_ROOT</span></code> the worker will
appear to start with <em>“OK”</em> but exit immediately after with no apparent
errors. This problem may appear when running the project in a new development
or production environment (inadvertently) as root.</p>
</div>
<div class="section" id="supervisor">
<span id="daemon-supervisord"></span><h2><a class="reference external" href="https://pypi.python.org/pypi/supervisor/">supervisor</a><a class="headerlink" href="#supervisor" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://github.com/celery/celery/tree/master/extra/supervisord/">extra/supervisord/</a></li>
</ul>
</div>
<div class="section" id="launchd-macos">
<span id="daemon-launchd"></span><h2><a class="toc-backref" href="#id21"><code class="docutils literal notranslate"><span class="pre">launchd</span></code> (macOS)</a><a class="headerlink" href="#launchd-macos" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://github.com/celery/celery/tree/master/extra/macOS/">extra/macOS</a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/celery_512.png" alt="Logo"/>
            </a></p><iframe src="https://ghbtns.com/github-btn.html?user=celery&repo=celery&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>
<div id="donate">
    <b>Please help support this community project with a donation:</b>
    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
    <input type="hidden" name="cmd" value="_s-xclick">
    <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
    ">
    <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
    <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
    </form>
</div>
  <h4>Previous topic</h4>
  <p class="topless"><a href="workers.html"
                        title="previous chapter">Workers Guide</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="periodic-tasks.html"
                        title="next chapter">Periodic Tasks</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/userguide/daemonizing.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="periodic-tasks.html" title="Periodic Tasks"
             >next</a> |</li>
        <li class="right" >
          <a href="workers.html" title="Workers Guide"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Celery 4.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >User Guide</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../copyright.html">Copyright</a> 2009-2017, Ask Solem &amp; contributors.
    </div>
  </body>
</html>