
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Monitoring and Management Guide &#8212; Celery 4.2.0 documentation</title>
    <link rel="stylesheet" href="../_static/celery.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="Security" href="security.html" />
    <link rel="prev" title="Routing Tasks" href="routing.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="security.html" title="Security"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="routing.html" title="Routing Tasks"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Celery 4.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">User Guide</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
<div class="deck">

    
        <p>
        This document describes the current stable version of Celery (4.2).
        For development docs,
        <a href="http://docs.celeryproject.org/en/master/userguide/monitoring.html">go here</a>.
        </p>
    

</div>
    <div class="section" id="monitoring-and-management-guide">
<span id="guide-monitoring"></span><h1>Monitoring and Management Guide<a class="headerlink" href="#monitoring-and-management-guide" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id3">Introduction</a></li>
<li><a class="reference internal" href="#workers" id="id4">Workers</a><ul>
<li><a class="reference internal" href="#management-command-line-utilities-inspect-control" id="id5">Management Command-line Utilities (<code class="docutils literal notranslate"><span class="pre">inspect</span></code>/<code class="docutils literal notranslate"><span class="pre">control</span></code>)</a><ul>
<li><a class="reference internal" href="#commands" id="id6">Commands</a></li>
<li><a class="reference internal" href="#specifying-destination-nodes" id="id7">Specifying destination nodes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#flower-real-time-celery-web-monitor" id="id8">Flower: Real-time Celery web-monitor</a><ul>
<li><a class="reference internal" href="#features" id="id9">Features</a></li>
<li><a class="reference internal" href="#usage" id="id10">Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#celery-events-curses-monitor" id="id11">celery events: Curses Monitor</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rabbitmq" id="id12">RabbitMQ</a><ul>
<li><a class="reference internal" href="#inspecting-queues" id="id13">Inspecting queues</a></li>
</ul>
</li>
<li><a class="reference internal" href="#redis" id="id14">Redis</a><ul>
<li><a class="reference internal" href="#monitoring-redis-queues" id="id15">Inspecting queues</a></li>
</ul>
</li>
<li><a class="reference internal" href="#munin" id="id16">Munin</a></li>
<li><a class="reference internal" href="#events" id="id17">Events</a><ul>
<li><a class="reference internal" href="#snapshots" id="id18">Snapshots</a><ul>
<li><a class="reference internal" href="#custom-camera" id="id19">Custom Camera</a></li>
</ul>
</li>
<li><a class="reference internal" href="#real-time-processing" id="id20">Real-time processing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#event-reference" id="id21">Event Reference</a><ul>
<li><a class="reference internal" href="#task-events" id="id22">Task Events</a><ul>
<li><a class="reference internal" href="#task-sent" id="id23">task-sent</a></li>
<li><a class="reference internal" href="#task-received" id="id24">task-received</a></li>
<li><a class="reference internal" href="#task-started" id="id25">task-started</a></li>
<li><a class="reference internal" href="#task-succeeded" id="id26">task-succeeded</a></li>
<li><a class="reference internal" href="#task-failed" id="id27">task-failed</a></li>
<li><a class="reference internal" href="#task-rejected" id="id28">task-rejected</a></li>
<li><a class="reference internal" href="#task-revoked" id="id29">task-revoked</a></li>
<li><a class="reference internal" href="#task-retried" id="id30">task-retried</a></li>
</ul>
</li>
<li><a class="reference internal" href="#worker-events" id="id31">Worker Events</a><ul>
<li><a class="reference internal" href="#worker-online" id="id32">worker-online</a></li>
<li><a class="reference internal" href="#worker-heartbeat" id="id33">worker-heartbeat</a></li>
<li><a class="reference internal" href="#worker-offline" id="id34">worker-offline</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id3">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>There are several tools available to monitor and inspect Celery clusters.</p>
<p>This document describes some of these, as as well as
features related to monitoring, like events and broadcast commands.</p>
</div>
<div class="section" id="workers">
<span id="monitoring-workers"></span><h2><a class="toc-backref" href="#id4">Workers</a><a class="headerlink" href="#workers" title="Permalink to this headline">¶</a></h2>
<div class="section" id="management-command-line-utilities-inspect-control">
<span id="monitoring-control"></span><h3><a class="toc-backref" href="#id5">Management Command-line Utilities (<code class="docutils literal notranslate"><span class="pre">inspect</span></code>/<code class="docutils literal notranslate"><span class="pre">control</span></code>)</a><a class="headerlink" href="#management-command-line-utilities-inspect-control" title="Permalink to this headline">¶</a></h3>
<p><strong class="program">celery</strong> can also be used to inspect
and manage worker nodes (and to some degree tasks).</p>
<p>To list all the commands available do:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery <span class="nb">help</span>
</pre></div>
</div>
<p>or to get help for a specific command do:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery &lt;command&gt; --help
</pre></div>
</div>
<div class="section" id="commands">
<h4><a class="toc-backref" href="#id6">Commands</a><a class="headerlink" href="#commands" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first"><strong>shell</strong>: Drop into a Python shell.</p>
<p>The locals will include the <code class="docutils literal notranslate"><span class="pre">celery</span></code> variable: this is the current app.
Also all known tasks will be automatically added to locals (unless the
<a class="reference internal" href="../reference/celery.bin.celery.html#cmdoption-celery-shell-t"><code class="xref std std-option docutils literal notranslate"><span class="pre">--without-tasks</span></code></a> flag is set).</p>
<p>Uses <a class="reference external" href="https://pypi.python.org/pypi/Ipython/">Ipython</a>, <a class="reference external" href="https://pypi.python.org/pypi/bpython/">bpython</a>, or regular <strong class="program">python</strong> in that
order if installed. You can force an implementation using
<a class="reference internal" href="../reference/celery.bin.celery.html#cmdoption-celery-shell-i"><code class="xref std std-option docutils literal notranslate"><span class="pre">--ipython</span></code></a>,
<a class="reference internal" href="../reference/celery.bin.celery.html#cmdoption-celery-shell-b"><code class="xref std std-option docutils literal notranslate"><span class="pre">--bpython</span></code></a>, or
<a class="reference internal" href="../reference/celery.bin.celery.html#cmdoption-celery-shell-p"><code class="xref std std-option docutils literal notranslate"><span class="pre">--python</span></code></a>.</p>
</li>
<li><p class="first"><strong>status</strong>: List active nodes in this cluster</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj status
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><strong>result</strong>: Show the result of a task</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj result -t tasks.add 4e196aa4-0141-4601-8138-7aa33db0f577
</pre></div>
</div>
<p>Note that you can omit the name of the task as long as the
task doesn’t use a custom result backend.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>purge</strong>: Purge messages from all configured task queues.</p>
<blockquote>
<div><p>This command will remove all messages from queues configured in
the <code class="xref std std-setting docutils literal notranslate"><span class="pre">CELERY_QUEUES</span></code> setting:</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">There’s no undo for this operation, and messages will
be permanently deleted!</p>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj purge
</pre></div>
</div>
<p>You can also specify the queues to purge using the <cite>-Q</cite> option:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj purge -Q celery,foo,bar
</pre></div>
</div>
<p>and exclude queues from being purged using the <cite>-X</cite> option:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj purge -X celery
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><strong>inspect active</strong>: List active tasks</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj inspect active
</pre></div>
</div>
<p>These are all the tasks that are currently being executed.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>inspect scheduled</strong>: List scheduled ETA tasks</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj inspect scheduled
</pre></div>
</div>
<p>These are tasks reserved by the worker when they have an
<cite>eta</cite> or <cite>countdown</cite> argument set.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>inspect reserved</strong>: List reserved tasks</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj inspect reserved
</pre></div>
</div>
<p>This will list all tasks that have been prefetched by the worker,
and is currently waiting to be executed (doesn’t include tasks
with an ETA value set).</p>
</div></blockquote>
</li>
<li><p class="first"><strong>inspect revoked</strong>: List history of revoked tasks</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj inspect revoked
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><strong>inspect registered</strong>: List registered tasks</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj inspect registered
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><strong>inspect stats</strong>: Show worker statistics (see <a class="reference internal" href="workers.html#worker-statistics"><span class="std std-ref">Statistics</span></a>)</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj inspect stats
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><strong>inspect query_task</strong>: Show information about task(s) by id.</p>
<blockquote>
<div><p>Any worker having a task in this set of ids reserved/active will respond
with status and information.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj inspect query_task e9f6c8f0-fec9-4ae8-a8c6-cf8c8451d4f8
</pre></div>
</div>
<p>You can also query for information about multiple tasks:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj inspect query_task id1 id2 ... idN
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><strong>control enable_events</strong>: Enable events</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj control enable_events
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><strong>control disable_events</strong>: Disable events</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj control disable_events
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><strong>migrate</strong>: Migrate tasks from one broker to another (<strong>EXPERIMENTAL</strong>).</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj migrate redis://localhost amqp://localhost
</pre></div>
</div>
</div></blockquote>
<p>This command will migrate all the tasks on one broker to another.
As this command is new and experimental you should be sure to have
a backup of the data before proceeding.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All <code class="docutils literal notranslate"><span class="pre">inspect</span></code> and <code class="docutils literal notranslate"><span class="pre">control</span></code> commands supports a
<a class="reference internal" href="../reference/celery.bin.celery.html#cmdoption-celery-inspect-t"><code class="xref std std-option docutils literal notranslate"><span class="pre">--timeout</span></code></a> argument,
This is the number of seconds to wait for responses.
You may have to increase this timeout if you’re not getting a response
due to latency.</p>
</div>
</div>
<div class="section" id="specifying-destination-nodes">
<span id="inspect-destination"></span><h4><a class="toc-backref" href="#id7">Specifying destination nodes</a><a class="headerlink" href="#specifying-destination-nodes" title="Permalink to this headline">¶</a></h4>
<p>By default the inspect and control commands operates on all workers.
You can specify a single, or a list of workers by using the
<a class="reference internal" href="../reference/celery.bin.celery.html#cmdoption-celery-inspect-d"><code class="xref std std-option docutils literal notranslate"><span class="pre">--destination</span></code></a> argument:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj inspect -d w1@e.com,w2@e.com reserved

<span class="gp">$</span> celery -A proj control -d w1@e.com,w2@e.com enable_events
</pre></div>
</div>
</div>
</div>
<div class="section" id="flower-real-time-celery-web-monitor">
<span id="monitoring-flower"></span><h3><a class="toc-backref" href="#id8">Flower: Real-time Celery web-monitor</a><a class="headerlink" href="#flower-real-time-celery-web-monitor" title="Permalink to this headline">¶</a></h3>
<p>Flower is a real-time web based monitor and administration tool for Celery.
It’s under active development, but is already an essential tool.
Being the recommended monitor for Celery, it obsoletes the Django-Admin
monitor, <code class="docutils literal notranslate"><span class="pre">celerymon</span></code> and the <code class="docutils literal notranslate"><span class="pre">ncurses</span></code> based monitor.</p>
<p>Flower is pronounced like “flow”, but you can also use the botanical version
if you prefer.</p>
<div class="section" id="features">
<h4><a class="toc-backref" href="#id9">Features</a><a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Real-time monitoring using Celery Events</p>
<blockquote>
<div><ul class="simple">
<li>Task progress and history</li>
<li>Ability to show task details (arguments, start time, run-time, and more)</li>
<li>Graphs and statistics</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Remote Control</p>
<blockquote>
<div><ul class="simple">
<li>View worker status and statistics</li>
<li>Shutdown and restart worker instances</li>
<li>Control worker pool size and autoscale settings</li>
<li>View and modify the queues a worker instance consumes from</li>
<li>View currently running tasks</li>
<li>View scheduled tasks (ETA/countdown)</li>
<li>View reserved and revoked tasks</li>
<li>Apply time and rate limits</li>
<li>Configuration viewer</li>
<li>Revoke or terminate tasks</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">HTTP API</p>
<blockquote>
<div><ul class="simple">
<li>List workers</li>
<li>Shut down a worker</li>
<li>Restart worker’s pool</li>
<li>Grow worker’s pool</li>
<li>Shrink worker’s pool</li>
<li>Autoscale worker pool</li>
<li>Start consuming from a queue</li>
<li>Stop consuming from a queue</li>
<li>List tasks</li>
<li>List (seen) task types</li>
<li>Get a task info</li>
<li>Execute a task</li>
<li>Execute a task by name</li>
<li>Get a task result</li>
<li>Change soft and hard time limits for a task</li>
<li>Change rate limit for a task</li>
<li>Revoke a task</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">OpenID authentication</p>
</li>
</ul>
<p><strong>Screenshots</strong></p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/dashboard.png"><img alt="../_images/dashboard.png" src="../_images/dashboard.png" style="width: 700px;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/monitor.png"><img alt="../_images/monitor.png" src="../_images/monitor.png" style="width: 700px;" /></a>
</div>
<p>More <a class="reference external" href="https://github.com/mher/flower/tree/master/docs/screenshots">screenshots</a>:</p>
</div>
<div class="section" id="usage">
<h4><a class="toc-backref" href="#id10">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h4>
<p>You can use pip to install Flower:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> pip install flower
</pre></div>
</div>
<p>Running the flower command will start a web-server that you can visit:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj flower
</pre></div>
</div>
<p>The default port is <a class="reference external" href="http://localhost:5555">http://localhost:5555</a>, but you can change this using the
<code class="xref std std-option docutils literal notranslate"><span class="pre">--port</span></code> argument:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj flower --port<span class="o">=</span><span class="m">5555</span>
</pre></div>
</div>
<p>Broker URL can also be passed through the
<a class="reference internal" href="../reference/celery.bin.celery.html#cmdoption-celery-b"><code class="xref std std-option docutils literal notranslate"><span class="pre">--broker</span></code></a> argument :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery flower --broker<span class="o">=</span>amqp://guest:guest@localhost:5672//
<span class="go">or</span>
<span class="gp">$</span> celery flower --broker<span class="o">=</span>redis://guest:guest@localhost:6379/0
</pre></div>
</div>
<p>Then, you can visit flower in your web browser :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> open http://localhost:5555
</pre></div>
</div>
<p>Flower has many more features than are detailed here, including
authorization options. Check out the <a class="reference external" href="https://flower.readthedocs.io/en/latest/">official documentation</a> for more
information.</p>
</div>
</div>
<div class="section" id="celery-events-curses-monitor">
<span id="monitoring-celeryev"></span><h3><a class="toc-backref" href="#id11">celery events: Curses Monitor</a><a class="headerlink" href="#celery-events-curses-monitor" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.0.</span></p>
</div>
<p><cite>celery events</cite> is a simple curses monitor displaying
task and worker history. You can inspect the result and traceback of tasks,
and it also supports some management commands like rate limiting and shutting
down workers. This monitor was started as a proof of concept, and you
probably want to use Flower instead.</p>
<p>Starting:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj events
</pre></div>
</div>
<p>You should see a screen like:</p>
<div class="figure">
<img alt="../_images/celeryevshotsm1.jpg" src="../_images/celeryevshotsm1.jpg" />
</div>
<p><cite>celery events</cite> is also used to start snapshot cameras (see
<a class="reference internal" href="#monitoring-snapshots"><span class="std std-ref">Snapshots</span></a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj events --camera<span class="o">=</span>&lt;camera-class&gt; --frequency<span class="o">=</span><span class="m">1</span>.0
</pre></div>
</div>
<p>and it includes a tool to dump events to <code class="file docutils literal notranslate"><span class="pre">stdout</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj events --dump
</pre></div>
</div>
<p>For a complete list of options use <a class="reference internal" href="../reference/celery.bin.celery.html#cmdoption-celery-help"><code class="xref std std-option docutils literal notranslate"><span class="pre">--help</span></code></a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery events --help
</pre></div>
</div>
</div>
</div>
<div class="section" id="rabbitmq">
<span id="monitoring-rabbitmq"></span><h2><a class="toc-backref" href="#id12">RabbitMQ</a><a class="headerlink" href="#rabbitmq" title="Permalink to this headline">¶</a></h2>
<p>To manage a Celery cluster it is important to know how
RabbitMQ can be monitored.</p>
<p>RabbitMQ ships with the <a class="reference external" href="http://www.rabbitmq.com/man/rabbitmqctl.1.man.html">rabbitmqctl(1)</a> command,
with this you can list queues, exchanges, bindings,
queue lengths, the memory usage of each queue, as well
as manage users, virtual hosts and their permissions.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The default virtual host (<code class="docutils literal notranslate"><span class="pre">&quot;/&quot;</span></code>) is used in these
examples, if you use a custom virtual host you have to add
the <code class="docutils literal notranslate"><span class="pre">-p</span></code> argument to the command, for example:
<code class="docutils literal notranslate"><span class="pre">rabbitmqctl</span> <span class="pre">list_queues</span> <span class="pre">-p</span> <span class="pre">my_vhost</span> <span class="pre">…</span></code></p>
</div>
<div class="section" id="inspecting-queues">
<span id="monitoring-rmq-queues"></span><h3><a class="toc-backref" href="#id13">Inspecting queues</a><a class="headerlink" href="#inspecting-queues" title="Permalink to this headline">¶</a></h3>
<p>Finding the number of tasks in a queue:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> rabbitmqctl list_queues name messages messages_ready <span class="se">\</span>
                          messages_unacknowledged
</pre></div>
</div>
<p>Here <cite>messages_ready</cite> is the number of messages ready
for delivery (sent but not received), <cite>messages_unacknowledged</cite>
is the number of messages that’s been received by a worker but
not acknowledged yet (meaning it is in progress, or has been reserved).
<cite>messages</cite> is the sum of ready and unacknowledged messages.</p>
<p>Finding the number of workers currently consuming from a queue:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> rabbitmqctl list_queues name consumers
</pre></div>
</div>
<p>Finding the amount of memory allocated to a queue:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> rabbitmqctl list_queues name memory
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Tip:</th><td class="field-body">Adding the <code class="docutils literal notranslate"><span class="pre">-q</span></code> option to <a class="reference external" href="http://www.rabbitmq.com/man/rabbitmqctl.1.man.html">rabbitmqctl(1)</a> makes the output
easier to parse.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="redis">
<span id="monitoring-redis"></span><h2><a class="toc-backref" href="#id14">Redis</a><a class="headerlink" href="#redis" title="Permalink to this headline">¶</a></h2>
<p>If you’re using Redis as the broker, you can monitor the Celery cluster using
the <cite>redis-cli(1)</cite> command to list lengths of queues.</p>
<div class="section" id="monitoring-redis-queues">
<span id="id1"></span><h3><a class="toc-backref" href="#id15">Inspecting queues</a><a class="headerlink" href="#monitoring-redis-queues" title="Permalink to this headline">¶</a></h3>
<p>Finding the number of tasks in a queue:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> redis-cli -h HOST -p PORT -n DATABASE_NUMBER llen QUEUE_NAME
</pre></div>
</div>
<p>The default queue is named <cite>celery</cite>. To get all available queues, invoke:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> redis-cli -h HOST -p PORT -n DATABASE_NUMBER keys <span class="se">\*</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Queue keys only exists when there are tasks in them, so if a key
doesn’t exist it simply means there are no messages in that queue.
This is because in Redis a list with no elements in it is automatically
removed, and hence it won’t show up in the <cite>keys</cite> command output,
and <cite>llen</cite> for that list returns 0.</p>
<p class="last">Also, if you’re using Redis for other purposes, the
output of the <cite>keys</cite> command will include unrelated values stored in
the database. The recommended way around this is to use a
dedicated <cite>DATABASE_NUMBER</cite> for Celery, you can also use
database numbers to separate Celery applications from each other (virtual
hosts), but this won’t affect the monitoring events used by for example
Flower as Redis pub/sub commands are global rather than database based.</p>
</div>
</div>
</div>
<div class="section" id="munin">
<span id="monitoring-munin"></span><h2><a class="toc-backref" href="#id16">Munin</a><a class="headerlink" href="#munin" title="Permalink to this headline">¶</a></h2>
<p>This is a list of known Munin plug-ins that can be useful when
maintaining a Celery cluster.</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">rabbitmq-munin</span></code>: Munin plug-ins for RabbitMQ.</p>
<blockquote>
<div><p><a class="reference external" href="https://github.com/ask/rabbitmq-munin">https://github.com/ask/rabbitmq-munin</a></p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">celery_tasks</span></code>: Monitors the number of times each task type has
been executed (requires <cite>celerymon</cite>).</p>
<blockquote>
<div><p><a class="reference external" href="http://exchange.munin-monitoring.org/plugins/celery_tasks-2/details">http://exchange.munin-monitoring.org/plugins/celery_tasks-2/details</a></p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">celery_task_states</span></code>: Monitors the number of tasks in each state
(requires <cite>celerymon</cite>).</p>
<blockquote>
<div><p><a class="reference external" href="http://exchange.munin-monitoring.org/plugins/celery_tasks/details">http://exchange.munin-monitoring.org/plugins/celery_tasks/details</a></p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="events">
<span id="monitoring-events"></span><h2><a class="toc-backref" href="#id17">Events</a><a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h2>
<p>The worker has the ability to send a message whenever some event
happens. These events are then captured by tools like Flower,
and <strong class="program">celery events</strong> to monitor the cluster.</p>
<div class="section" id="snapshots">
<span id="monitoring-snapshots"></span><h3><a class="toc-backref" href="#id18">Snapshots</a><a class="headerlink" href="#snapshots" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.1.</span></p>
</div>
<p>Even a single worker can produce a huge amount of events, so storing
the history of all events on disk may be very expensive.</p>
<p>A sequence of events describes the cluster state in that time period,
by taking periodic snapshots of this state you can keep all history, but
still only periodically write it to disk.</p>
<p>To take snapshots you need a Camera class, with this you can define
what should happen every time the state is captured;  You can
write it to a database, send it by email or something else entirely.</p>
<p><strong class="program">celery events</strong> is then used to take snapshots with the camera,
for example if you want to capture state every 2 seconds using the
camera <code class="docutils literal notranslate"><span class="pre">myapp.Camera</span></code> you run <strong class="program">celery events</strong> with the following
arguments:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj events -c myapp.Camera --frequency<span class="o">=</span><span class="m">2</span>.0
</pre></div>
</div>
<div class="section" id="custom-camera">
<span id="monitoring-camera"></span><h4><a class="toc-backref" href="#id19">Custom Camera</a><a class="headerlink" href="#custom-camera" title="Permalink to this headline">¶</a></h4>
<p>Cameras can be useful if you need to capture events and do something
with those events at an interval. For real-time event processing
you should use <code class="xref py py-class docutils literal notranslate"><span class="pre">app.events.Receiver</span></code> directly, like in
<a class="reference internal" href="#event-real-time-example"><span class="std std-ref">Real-time processing</span></a>.</p>
<p>Here is an example camera, dumping the snapshot to screen:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pformat</span>

<span class="kn">from</span> <span class="nn">celery.events.snapshot</span> <span class="kn">import</span> <span class="n">Polaroid</span>

<span class="k">class</span> <span class="nc">DumpCam</span><span class="p">(</span><span class="n">Polaroid</span><span class="p">):</span>
    <span class="n">clear_after</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c1"># clear after flush (incl, state.event_count).</span>

    <span class="k">def</span> <span class="nf">on_shutter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">state</span><span class="o">.</span><span class="n">event_count</span><span class="p">:</span>
            <span class="c1"># No new events since last snapshot.</span>
            <span class="k">return</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Workers: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pformat</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">workers</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)))</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Tasks: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pformat</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">tasks</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)))</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Total: {0.event_count} events, {0.task_count} tasks&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">state</span><span class="p">))</span>
</pre></div>
</div>
<p>See the API reference for <a class="reference internal" href="../reference/celery.events.state.html#module-celery.events.state" title="celery.events.state"><code class="xref py py-mod docutils literal notranslate"><span class="pre">celery.events.state</span></code></a> to read more
about state objects.</p>
<p>Now you can use this cam with <strong class="program">celery events</strong> by specifying
it with the <a class="reference internal" href="../reference/celery.bin.events.html#cmdoption-celery-events-c"><code class="xref std std-option docutils literal notranslate"><span class="pre">-c</span></code></a> option:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj events -c myapp.DumpCam --frequency<span class="o">=</span><span class="m">2</span>.0
</pre></div>
</div>
<p>Or you can use it programmatically like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">Celery</span>
<span class="kn">from</span> <span class="nn">myapp</span> <span class="kn">import</span> <span class="n">DumpCam</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">State</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">recv</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">Receiver</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">handlers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;*&#39;</span><span class="p">:</span> <span class="n">state</span><span class="o">.</span><span class="n">event</span><span class="p">})</span>
        <span class="k">with</span> <span class="n">DumpCam</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">):</span>
            <span class="n">recv</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="n">broker</span><span class="o">=</span><span class="s1">&#39;amqp://guest@localhost//&#39;</span><span class="p">)</span>
    <span class="n">main</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="real-time-processing">
<span id="event-real-time-example"></span><h3><a class="toc-backref" href="#id20">Real-time processing</a><a class="headerlink" href="#real-time-processing" title="Permalink to this headline">¶</a></h3>
<p>To process events in real-time you need the following</p>
<ul>
<li><p class="first">An event consumer (this is the <code class="docutils literal notranslate"><span class="pre">Receiver</span></code>)</p>
</li>
<li><p class="first">A set of handlers called when events come in.</p>
<blockquote>
<div><p>You can have different handlers for each event type,
or a catch-all handler can be used (‘*’)</p>
</div></blockquote>
</li>
<li><p class="first">State (optional)</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">app.events.State</span></code> is a convenient in-memory representation
of tasks and workers in the cluster that’s updated as events come in.</p>
<p>It encapsulates solutions for many common things, like checking if a
worker is still alive (by verifying heartbeats), merging event fields
together as events come in, making sure time-stamps are in sync, and so on.</p>
</li>
</ul>
<p>Combining these you can easily process events in real-time:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">Celery</span>


<span class="k">def</span> <span class="nf">my_monitor</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">State</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">announce_failed_tasks</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="n">state</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="c1"># task name is sent only with -received event, and state</span>
        <span class="c1"># will keep track of this for us.</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>

        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TASK FAILED: </span><span class="si">%s</span><span class="s1">[</span><span class="si">%s</span><span class="s1">] </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">task</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">info</span><span class="p">(),))</span>

    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">recv</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">Receiver</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">handlers</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;task-failed&#39;</span><span class="p">:</span> <span class="n">announce_failed_tasks</span><span class="p">,</span>
                <span class="s1">&#39;*&#39;</span><span class="p">:</span> <span class="n">state</span><span class="o">.</span><span class="n">event</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">recv</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">wakeup</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="n">broker</span><span class="o">=</span><span class="s1">&#39;amqp://guest@localhost//&#39;</span><span class="p">)</span>
    <span class="n">my_monitor</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">wakeup</span></code> argument to <code class="docutils literal notranslate"><span class="pre">capture</span></code> sends a signal to all workers
to force them to send a heartbeat. This way you can immediately see
workers when the monitor starts.</p>
</div>
<p>You can listen to specific events by specifying the handlers:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">Celery</span>

<span class="k">def</span> <span class="nf">my_monitor</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">State</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">announce_failed_tasks</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="n">state</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="c1"># task name is sent only with -received event, and state</span>
        <span class="c1"># will keep track of this for us.</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>

        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TASK FAILED: </span><span class="si">%s</span><span class="s1">[</span><span class="si">%s</span><span class="s1">] </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">task</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">info</span><span class="p">(),))</span>

    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">recv</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">Receiver</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">handlers</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;task-failed&#39;</span><span class="p">:</span> <span class="n">announce_failed_tasks</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">recv</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">wakeup</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="n">broker</span><span class="o">=</span><span class="s1">&#39;amqp://guest@localhost//&#39;</span><span class="p">)</span>
    <span class="n">my_monitor</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="event-reference">
<span id="id2"></span><h2><a class="toc-backref" href="#id21">Event Reference</a><a class="headerlink" href="#event-reference" title="Permalink to this headline">¶</a></h2>
<p>This list contains the events sent by the worker, and their arguments.</p>
<div class="section" id="task-events">
<span id="event-reference-task"></span><h3><a class="toc-backref" href="#id22">Task Events</a><a class="headerlink" href="#task-events" title="Permalink to this headline">¶</a></h3>
<div class="section" id="task-sent">
<span id="std:event-task-sent"></span><h4><a class="toc-backref" href="#id23">task-sent</a><a class="headerlink" href="#task-sent" title="Permalink to this headline">¶</a></h4>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">signature:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">task-sent(uuid,</span> <span class="pre">name,</span> <span class="pre">args,</span> <span class="pre">kwargs,</span> <span class="pre">retries,</span> <span class="pre">eta,</span> <span class="pre">expires,</span>
<span class="pre">queue,</span> <span class="pre">exchange,</span> <span class="pre">routing_key,</span> <span class="pre">root_id,</span> <span class="pre">parent_id)</span></code></td>
</tr>
</tbody>
</table>
<p>Sent when a task message is published and
the <a class="reference internal" href="configuration.html#std:setting-task_send_sent_event"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_send_sent_event</span></code></a> setting is enabled.</p>
</div>
<div class="section" id="task-received">
<span id="std:event-task-received"></span><h4><a class="toc-backref" href="#id24">task-received</a><a class="headerlink" href="#task-received" title="Permalink to this headline">¶</a></h4>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">signature:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">task-received(uuid,</span> <span class="pre">name,</span> <span class="pre">args,</span> <span class="pre">kwargs,</span> <span class="pre">retries,</span> <span class="pre">eta,</span> <span class="pre">hostname,</span>
<span class="pre">timestamp,</span> <span class="pre">root_id,</span> <span class="pre">parent_id)</span></code></td>
</tr>
</tbody>
</table>
<p>Sent when the worker receives a task.</p>
</div>
<div class="section" id="task-started">
<span id="std:event-task-started"></span><h4><a class="toc-backref" href="#id25">task-started</a><a class="headerlink" href="#task-started" title="Permalink to this headline">¶</a></h4>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">signature:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">task-started(uuid,</span> <span class="pre">hostname,</span> <span class="pre">timestamp,</span> <span class="pre">pid)</span></code></td>
</tr>
</tbody>
</table>
<p>Sent just before the worker executes the task.</p>
</div>
<div class="section" id="task-succeeded">
<span id="std:event-task-succeeded"></span><h4><a class="toc-backref" href="#id26">task-succeeded</a><a class="headerlink" href="#task-succeeded" title="Permalink to this headline">¶</a></h4>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">signature:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">task-succeeded(uuid,</span> <span class="pre">result,</span> <span class="pre">runtime,</span> <span class="pre">hostname,</span> <span class="pre">timestamp)</span></code></td>
</tr>
</tbody>
</table>
<p>Sent if the task executed successfully.</p>
<p>Run-time is the time it took to execute the task using the pool.
(Starting from the task is sent to the worker pool, and ending when the
pool result handler callback is called).</p>
</div>
<div class="section" id="task-failed">
<span id="std:event-task-failed"></span><h4><a class="toc-backref" href="#id27">task-failed</a><a class="headerlink" href="#task-failed" title="Permalink to this headline">¶</a></h4>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">signature:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">task-failed(uuid,</span> <span class="pre">exception,</span> <span class="pre">traceback,</span> <span class="pre">hostname,</span> <span class="pre">timestamp)</span></code></td>
</tr>
</tbody>
</table>
<p>Sent if the execution of the task failed.</p>
</div>
<div class="section" id="task-rejected">
<span id="std:event-task-rejected"></span><h4><a class="toc-backref" href="#id28">task-rejected</a><a class="headerlink" href="#task-rejected" title="Permalink to this headline">¶</a></h4>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">signature:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">task-rejected(uuid,</span> <span class="pre">requeued)</span></code></td>
</tr>
</tbody>
</table>
<p>The task was rejected by the worker, possibly to be re-queued or moved to a
dead letter queue.</p>
</div>
<div class="section" id="task-revoked">
<span id="std:event-task-revoked"></span><h4><a class="toc-backref" href="#id29">task-revoked</a><a class="headerlink" href="#task-revoked" title="Permalink to this headline">¶</a></h4>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">signature:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">task-revoked(uuid,</span> <span class="pre">terminated,</span> <span class="pre">signum,</span> <span class="pre">expired)</span></code></td>
</tr>
</tbody>
</table>
<p>Sent if the task has been revoked (Note that this is likely
to be sent by more than one worker).</p>
<ul class="simple">
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">terminated</span></code> is set to true if the task process was terminated,</dt>
<dd>and the <code class="docutils literal notranslate"><span class="pre">signum</span></code> field set to the signal used.</dd>
</dl>
</li>
<li><code class="docutils literal notranslate"><span class="pre">expired</span></code> is set to true if the task expired.</li>
</ul>
</div>
<div class="section" id="task-retried">
<span id="std:event-task-retried"></span><h4><a class="toc-backref" href="#id30">task-retried</a><a class="headerlink" href="#task-retried" title="Permalink to this headline">¶</a></h4>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">signature:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">task-retried(uuid,</span> <span class="pre">exception,</span> <span class="pre">traceback,</span> <span class="pre">hostname,</span> <span class="pre">timestamp)</span></code></td>
</tr>
</tbody>
</table>
<p>Sent if the task failed, but will be retried in the future.</p>
</div>
</div>
<div class="section" id="worker-events">
<span id="event-reference-worker"></span><h3><a class="toc-backref" href="#id31">Worker Events</a><a class="headerlink" href="#worker-events" title="Permalink to this headline">¶</a></h3>
<div class="section" id="worker-online">
<span id="std:event-worker-online"></span><h4><a class="toc-backref" href="#id32">worker-online</a><a class="headerlink" href="#worker-online" title="Permalink to this headline">¶</a></h4>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">signature:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">worker-online(hostname,</span> <span class="pre">timestamp,</span> <span class="pre">freq,</span> <span class="pre">sw_ident,</span> <span class="pre">sw_ver,</span> <span class="pre">sw_sys)</span></code></td>
</tr>
</tbody>
</table>
<p>The worker has connected to the broker and is online.</p>
<ul class="simple">
<li><cite>hostname</cite>: Nodename of the worker.</li>
<li><cite>timestamp</cite>: Event time-stamp.</li>
<li><cite>freq</cite>: Heartbeat frequency in seconds (float).</li>
<li><cite>sw_ident</cite>: Name of worker software (e.g., <code class="docutils literal notranslate"><span class="pre">py-celery</span></code>).</li>
<li><cite>sw_ver</cite>: Software version (e.g., 2.2.0).</li>
<li><cite>sw_sys</cite>: Operating System (e.g., Linux/Darwin).</li>
</ul>
</div>
<div class="section" id="worker-heartbeat">
<span id="std:event-worker-heartbeat"></span><h4><a class="toc-backref" href="#id33">worker-heartbeat</a><a class="headerlink" href="#worker-heartbeat" title="Permalink to this headline">¶</a></h4>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">signature:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">worker-heartbeat(hostname,</span> <span class="pre">timestamp,</span> <span class="pre">freq,</span> <span class="pre">sw_ident,</span> <span class="pre">sw_ver,</span> <span class="pre">sw_sys,</span>
<span class="pre">active,</span> <span class="pre">processed)</span></code></td>
</tr>
</tbody>
</table>
<p>Sent every minute, if the worker hasn’t sent a heartbeat in 2 minutes,
it is considered to be offline.</p>
<ul class="simple">
<li><cite>hostname</cite>: Nodename of the worker.</li>
<li><cite>timestamp</cite>: Event time-stamp.</li>
<li><cite>freq</cite>: Heartbeat frequency in seconds (float).</li>
<li><cite>sw_ident</cite>: Name of worker software (e.g., <code class="docutils literal notranslate"><span class="pre">py-celery</span></code>).</li>
<li><cite>sw_ver</cite>: Software version (e.g., 2.2.0).</li>
<li><cite>sw_sys</cite>: Operating System (e.g., Linux/Darwin).</li>
<li><cite>active</cite>: Number of currently executing tasks.</li>
<li><cite>processed</cite>: Total number of tasks processed by this worker.</li>
</ul>
</div>
<div class="section" id="worker-offline">
<span id="std:event-worker-offline"></span><h4><a class="toc-backref" href="#id34">worker-offline</a><a class="headerlink" href="#worker-offline" title="Permalink to this headline">¶</a></h4>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">signature:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">worker-offline(hostname,</span> <span class="pre">timestamp,</span> <span class="pre">freq,</span> <span class="pre">sw_ident,</span> <span class="pre">sw_ver,</span> <span class="pre">sw_sys)</span></code></td>
</tr>
</tbody>
</table>
<p>The worker has disconnected from the broker.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/celery_512.png" alt="Logo"/>
            </a></p><iframe src="https://ghbtns.com/github-btn.html?user=celery&repo=celery&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>
<div id="donate">
    <b>Please help support this community project with a donation:</b>
    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
    <input type="hidden" name="cmd" value="_s-xclick">
    <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----MIIHTwYJKoZIhvcNAQcEoIIHQDCCBzwCAQExggEwMIIBLAIBADCBlDCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20CAQAwDQYJKoZIhvcNAQEBBQAEgYA2+c723xlntHKQYQR9yn9BEtUhDoUUlnOqhniqvNMWB4k2R0JpVkrNSu5JCbdjNOqDXKHoRfIWe3HXJJMPZBJKFMD5Izprb6xEZlTGaWnlrGXFfkdBaILQQgWYqV0DnuNmtDXCvfYmyu0p1K04wLjAJ1ufnBSP1UaS6BTcoIOOuTELMAkGBSsOAwIaBQAwgcwGCSqGSIb3DQEHATAUBggqhkiG9w0DBwQIFg/2qPwa7UCAgah20QLIllcp0VHazYo2C9h8c6gn8MTcTnpW0WFXhz9ylc/i5dCXabkrrLBBfg8NygAuvYRr4k1zdC0AJIgsV/6rSAhehabRvjRDH2EZ8OieqHfIPfkAcTm+JqbS6Z27lXkebYPnJzhkZxW7+ZC6hU/H40JFXChTag8lhqJfZELiOZLWxxilj2mkwlkdMx1YL6lcPAA7ajpAwjsnJYd/9VxLA6MDmcOu+TKgggOHMIIDgzCCAuygAwIBAgIBADANBgkqhkiG9w0BAQUFADCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20wHhcNMDQwMjEzMTAxMzE1WhcNMzUwMjEzMTAxMzE1WjCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAMFHTt38RMxLXJyO2SmS+Ndl72T7oKJ4u4uw+6awntALWh03PewmIJuzbALScsTS4sZoS1fKciBGoh11gIfHzylvkdNe/hJl66/RGqrj5rFb08sAABNTzDTiqqNpJeBsYs/c2aiGozptX2RlnBktH+SUNpAajW724Nv2Wvhif6sFAgMBAAGjge4wgeswHQYDVR0OBBYEFJaffLvGbxe9WT9S1wob7BDWZJRrMIG7BgNVHSMEgbMwgbCAFJaffLvGbxe9WT9S1wob7BDWZJRroYGUpIGRMIGOMQswCQYDVQQGEwJVUzELMAkGA1UECBMCQ0ExFjAUBgNVBAcTDU1vdW50YWluIFZpZXcxFDASBgNVBAoTC1BheVBhbCBJbmMuMRMwEQYDVQQLFApsaXZlX2NlcnRzMREwDwYDVQQDFAhsaXZlX2FwaTEcMBoGCSqGSIb3DQEJARYNcmVAcGF5cGFsLmNvbYIBADAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBBQUAA4GBAIFfOlaagFrl71+jq6OKidbWFSE+Q4FqROvdgIONth+8kSK//Y/4ihuE4Ymvzn5ceE3S/iBSQQMjyvb+s2TWbQYDwcp129OPIbD9epdr4tJOUNiSojw7BHwYRiPh58S1xGlFgHFXwrEBb3dgNbMUa+u4qectsMAXpVHnD9wIyfmHMYIBmjCCAZYCAQEwgZQwgY4xCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEWMBQGA1UEBxMNTW91bnRhaW4gVmlldzEUMBIGA1UEChMLUGF5UGFsIEluYy4xEzARBgNVBAsUCmxpdmVfY2VydHMxETAPBgNVBAMUCGxpdmVfYXBpMRwwGgYJKoZIhvcNAQkBFg1yZUBwYXlwYWwuY29tAgEAMAkGBSsOAwIaBQCgXTAYBgkqhkiG9w0BCQMxCwYJKoZIhvcNAQcBMBwGCSqGSIb3DQEJBTEPFw0xNTEyMTAxOTEzMzBaMCMGCSqGSIb3DQEJBDEWBBTUno4gI/mmaVaGVpgB/CWwQd3DeDANBgkqhkiG9w0BAQEFAASBgFmZ1j1Ss/FNl/JRIOakhBJEdm2KGLH0d2ewwTYIgIkEKSdc5Rg2/2xFS/dglcs5Te3R2GzaqjGlNSKldsk/MgZP/BudpHAASQ09hrfDy5TaBlRRl1Yu0WzGBKcVm/WRh0v2TVV8vBHVGiJD+aY5epgRXXI/XUKD0bp8tVV1T7LS-----END PKCS7-----
    ">
    <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
    <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
    </form>
</div>
  <h4>Previous topic</h4>
  <p class="topless"><a href="routing.html"
                        title="previous chapter">Routing Tasks</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="security.html"
                        title="next chapter">Security</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/userguide/monitoring.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="security.html" title="Security"
             >next</a> |</li>
        <li class="right" >
          <a href="routing.html" title="Routing Tasks"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Celery 4.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >User Guide</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../copyright.html">Copyright</a> 2009-2017, Ask Solem &amp; contributors.
    </div>
  </body>
</html>