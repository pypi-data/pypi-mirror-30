
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Periodic Tasks &#8212; Celery 4.2.0 documentation</title>
    <link rel="stylesheet" href="../_static/celery.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="Routing Tasks" href="routing.html" />
    <link rel="prev" title="Daemonization" href="daemonizing.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="routing.html" title="Routing Tasks"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="daemonizing.html" title="Daemonization"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Celery 4.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">User Guide</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
<div class="deck">

    
        <p>
        This document describes the current stable version of Celery (4.2).
        For development docs,
        <a href="http://docs.celeryproject.org/en/master/userguide/periodic-tasks.html">go here</a>.
        </p>
    

</div>
    <div class="section" id="periodic-tasks">
<span id="guide-beat"></span><h1>Periodic Tasks<a class="headerlink" href="#periodic-tasks" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#time-zones" id="id2">Time Zones</a></li>
<li><a class="reference internal" href="#entries" id="id3">Entries</a><ul>
<li><a class="reference internal" href="#available-fields" id="id4">Available Fields</a></li>
</ul>
</li>
<li><a class="reference internal" href="#crontab-schedules" id="id5">Crontab schedules</a></li>
<li><a class="reference internal" href="#solar-schedules" id="id6">Solar schedules</a></li>
<li><a class="reference internal" href="#starting-the-scheduler" id="id7">Starting the Scheduler</a><ul>
<li><a class="reference internal" href="#using-custom-scheduler-classes" id="id8">Using custom scheduler classes</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p><strong class="program">celery beat</strong> is a scheduler; It kicks off tasks at regular intervals,
that are then executed by available worker nodes in the cluster.</p>
<p>By default the entries are taken from the <a class="reference internal" href="configuration.html#std:setting-beat_schedule"><code class="xref std std-setting docutils literal notranslate"><span class="pre">beat_schedule</span></code></a> setting,
but custom stores can also be used, like storing the entries in a SQL database.</p>
<p>You have to ensure only a single scheduler is running for a schedule
at a time, otherwise you’d end up with duplicate tasks. Using
a centralized approach means the schedule doesn’t have to be synchronized,
and the service can operate without using locks.</p>
</div>
<div class="section" id="time-zones">
<span id="beat-timezones"></span><h2><a class="toc-backref" href="#id2">Time Zones</a><a class="headerlink" href="#time-zones" title="Permalink to this headline">¶</a></h2>
<p>The periodic task schedules uses the UTC time zone by default,
but you can change the time zone used using the <a class="reference internal" href="configuration.html#std:setting-timezone"><code class="xref std std-setting docutils literal notranslate"><span class="pre">timezone</span></code></a>
setting.</p>
<p>An example time zone could be <cite>Europe/London</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">timezone</span> <span class="o">=</span> <span class="s1">&#39;Europe/London&#39;</span>
</pre></div>
</div>
<p>This setting must be added to your app, either by configuration it directly
using (<code class="docutils literal notranslate"><span class="pre">app.conf.timezone</span> <span class="pre">=</span> <span class="pre">'Europe/London'</span></code>), or by adding
it to your configuration module if you have set one up using
<code class="docutils literal notranslate"><span class="pre">app.config_from_object</span></code>. See <a class="reference internal" href="../getting-started/first-steps-with-celery.html#celerytut-configuration"><span class="std std-ref">Configuration</span></a> for
more information about configuration options.</p>
<p>The default scheduler (storing the schedule in the <code class="file docutils literal notranslate"><span class="pre">celerybeat-schedule</span></code>
file) will automatically detect that the time zone has changed, and so will
reset the schedule itself, but other schedulers may not be so smart (e.g., the
Django database scheduler, see below) and in that case you’ll have to reset the
schedule manually.</p>
<div class="admonition-django-users admonition">
<p class="first admonition-title">Django Users</p>
<p>Celery recommends and is compatible with the new <code class="docutils literal notranslate"><span class="pre">USE_TZ</span></code> setting introduced
in Django 1.4.</p>
<p>For Django users the time zone specified in the <code class="docutils literal notranslate"><span class="pre">TIME_ZONE</span></code> setting
will be used, or you can specify a custom time zone for Celery alone
by using the <a class="reference internal" href="configuration.html#std:setting-timezone"><code class="xref std std-setting docutils literal notranslate"><span class="pre">timezone</span></code></a> setting.</p>
<p>The database scheduler won’t reset when timezone related settings
change, so you must do this manually:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py shell
<span class="gp">&gt;</span>&gt;&gt; from djcelery.models import PeriodicTask
<span class="gp">&gt;</span>&gt;&gt; PeriodicTask.objects.update<span class="o">(</span><span class="nv">last_run_at</span><span class="o">=</span>None<span class="o">)</span>
</pre></div>
</div>
<p>Django-Celery only supports Celery 4.0 and below, for Celery 4.0 and above, do as follow:</p>
<div class="last highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py shell
<span class="gp">&gt;</span>&gt;&gt; from django_celery_beat.models import PeriodicTask
<span class="gp">&gt;</span>&gt;&gt; PeriodicTask.objects.update<span class="o">(</span><span class="nv">last_run_at</span><span class="o">=</span>None<span class="o">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="entries">
<span id="beat-entries"></span><h2><a class="toc-backref" href="#id3">Entries</a><a class="headerlink" href="#entries" title="Permalink to this headline">¶</a></h2>
<p>To call a task periodically you have to add an entry to the
beat schedule list.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">Celery</span>
<span class="kn">from</span> <span class="nn">celery.schedules</span> <span class="kn">import</span> <span class="n">crontab</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">()</span>

<span class="nd">@app.on_after_configure.connect</span>
<span class="k">def</span> <span class="nf">setup_periodic_tasks</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># Calls test(&#39;hello&#39;) every 10 seconds.</span>
    <span class="n">sender</span><span class="o">.</span><span class="n">add_periodic_task</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">test</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;add every 10&#39;</span><span class="p">)</span>

    <span class="c1"># Calls test(&#39;world&#39;) every 30 seconds</span>
    <span class="n">sender</span><span class="o">.</span><span class="n">add_periodic_task</span><span class="p">(</span><span class="mf">30.0</span><span class="p">,</span> <span class="n">test</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">),</span> <span class="n">expires</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># Executes every Monday morning at 7:30 a.m.</span>
    <span class="n">sender</span><span class="o">.</span><span class="n">add_periodic_task</span><span class="p">(</span>
        <span class="n">crontab</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">day_of_week</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">test</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="s1">&#39;Happy Mondays!&#39;</span><span class="p">),</span>
    <span class="p">)</span>

<span class="nd">@app.task</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</pre></div>
</div>
<p>Setting these up from within the <a class="reference internal" href="../reference/celery.html#celery.Celery.on_after_configure" title="celery.Celery.on_after_configure"><code class="xref py py-data docutils literal notranslate"><span class="pre">on_after_configure</span></code></a> handler means
that we’ll not evaluate the app at module level when using <code class="docutils literal notranslate"><span class="pre">test.s()</span></code>.</p>
<p>The <a class="reference internal" href="../reference/celery.html#celery.Celery.add_periodic_task" title="celery.Celery.add_periodic_task"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_periodic_task()</span></code></a> function will add the entry to the
<a class="reference internal" href="configuration.html#std:setting-beat_schedule"><code class="xref std std-setting docutils literal notranslate"><span class="pre">beat_schedule</span></code></a> setting behind the scenes, and the same setting
can also be used to set up periodic tasks manually:</p>
<p>Example: Run the <cite>tasks.add</cite> task every 30 seconds.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">beat_schedule</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;add-every-30-seconds&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="s1">&#39;tasks.add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;schedule&#39;</span><span class="p">:</span> <span class="mf">30.0</span><span class="p">,</span>
        <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="p">},</span>
<span class="p">}</span>
<span class="n">app</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">timezone</span> <span class="o">=</span> <span class="s1">&#39;UTC&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you’re wondering where these settings should go then
please see <a class="reference internal" href="../getting-started/first-steps-with-celery.html#celerytut-configuration"><span class="std std-ref">Configuration</span></a>. You can either
set these options on your app directly or you can keep
a separate module for configuration.</p>
<p class="last">If you want to use a single item tuple for <cite>args</cite>, don’t forget
that the constructor is a comma, and not a pair of parentheses.</p>
</div>
<p>Using a <a class="reference external" href="https://docs.python.org/dev/library/datetime.html#datetime.timedelta" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">timedelta</span></code></a> for the schedule means the task will
be sent in 30 second intervals (the first task will be sent 30 seconds
after <cite>celery beat</cite> starts, and then every 30 seconds
after the last run).</p>
<p>A Crontab like schedule also exists, see the section on <a class="reference internal" href="#crontab-schedules">Crontab schedules</a>.</p>
<p>Like with <strong class="command">cron</strong>, the tasks may overlap if the first task doesn’t complete
before the next. If that’s a concern you should use a locking
strategy to ensure only one instance can run at a time (see for example
<a class="reference internal" href="../tutorials/task-cookbook.html#cookbook-task-serial"><span class="std std-ref">Ensuring a task is only executed one at a time</span></a>).</p>
<div class="section" id="available-fields">
<span id="beat-entry-fields"></span><h3><a class="toc-backref" href="#id4">Available Fields</a><a class="headerlink" href="#available-fields" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><cite>task</cite></p>
<blockquote>
<div><p>The name of the task to execute.</p>
</div></blockquote>
</li>
<li><p class="first"><cite>schedule</cite></p>
<blockquote>
<div><p>The frequency of execution.</p>
<p>This can be the number of seconds as an integer, a
<a class="reference external" href="https://docs.python.org/dev/library/datetime.html#datetime.timedelta" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">timedelta</span></code></a>, or a <a class="reference internal" href="../reference/celery.schedules.html#celery.schedules.crontab" title="celery.schedules.crontab"><code class="xref py py-class docutils literal notranslate"><span class="pre">crontab</span></code></a>.
You can also define your own custom schedule types, by extending the
interface of <a class="reference internal" href="../reference/celery.schedules.html#celery.schedules.schedule" title="celery.schedules.schedule"><code class="xref py py-class docutils literal notranslate"><span class="pre">schedule</span></code></a>.</p>
</div></blockquote>
</li>
<li><p class="first"><cite>args</cite></p>
<blockquote>
<div><p>Positional arguments (<a class="reference external" href="https://docs.python.org/dev/library/stdtypes.html#list" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> or <a class="reference external" href="https://docs.python.org/dev/library/stdtypes.html#tuple" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a>).</p>
</div></blockquote>
</li>
<li><p class="first"><cite>kwargs</cite></p>
<blockquote>
<div><p>Keyword arguments (<a class="reference external" href="https://docs.python.org/dev/library/stdtypes.html#dict" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>).</p>
</div></blockquote>
</li>
<li><p class="first"><cite>options</cite></p>
<blockquote>
<div><p>Execution options (<a class="reference external" href="https://docs.python.org/dev/library/stdtypes.html#dict" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>).</p>
<p>This can be any argument supported by
<code class="xref py py-meth docutils literal notranslate"><span class="pre">apply_async()</span></code> –
<cite>exchange</cite>, <cite>routing_key</cite>, <cite>expires</cite>, and so on.</p>
</div></blockquote>
</li>
<li><p class="first"><cite>relative</cite></p>
<blockquote>
<div><p>If <cite>relative</cite> is true <a class="reference external" href="https://docs.python.org/dev/library/datetime.html#datetime.timedelta" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">timedelta</span></code></a> schedules are scheduled
“by the clock.” This means the frequency is rounded to the nearest
second, minute, hour or day depending on the period of the
<a class="reference external" href="https://docs.python.org/dev/library/datetime.html#datetime.timedelta" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">timedelta</span></code></a>.</p>
<p>By default <cite>relative</cite> is false, the frequency isn’t rounded and will be
relative to the time when <strong class="program">celery beat</strong> was started.</p>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="crontab-schedules">
<span id="beat-crontab"></span><h2><a class="toc-backref" href="#id5">Crontab schedules</a><a class="headerlink" href="#crontab-schedules" title="Permalink to this headline">¶</a></h2>
<p>If you want more control over when the task is executed, for
example, a particular time of day or day of the week, you can use
the <a class="reference internal" href="../reference/celery.schedules.html#celery.schedules.crontab" title="celery.schedules.crontab"><code class="xref py py-class docutils literal notranslate"><span class="pre">crontab</span></code></a> schedule type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">celery.schedules</span> <span class="kn">import</span> <span class="n">crontab</span>

<span class="n">app</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">beat_schedule</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Executes every Monday morning at 7:30 a.m.</span>
    <span class="s1">&#39;add-every-monday-morning&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="s1">&#39;tasks.add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;schedule&#39;</span><span class="p">:</span> <span class="n">crontab</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">day_of_week</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The syntax of these Crontab expressions are very flexible.</p>
<p>Some examples:</p>
<p>See <a class="reference internal" href="../reference/celery.schedules.html#celery.schedules.crontab" title="celery.schedules.crontab"><code class="xref py py-class docutils literal notranslate"><span class="pre">celery.schedules.crontab</span></code></a> for more documentation.</p>
</div>
<div class="section" id="solar-schedules">
<span id="beat-solar"></span><h2><a class="toc-backref" href="#id6">Solar schedules</a><a class="headerlink" href="#solar-schedules" title="Permalink to this headline">¶</a></h2>
<p>If you have a task that should be executed according to sunrise,
sunset, dawn or dusk, you can use the
<a class="reference internal" href="../reference/celery.schedules.html#celery.schedules.solar" title="celery.schedules.solar"><code class="xref py py-class docutils literal notranslate"><span class="pre">solar</span></code></a> schedule type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">celery.schedules</span> <span class="kn">import</span> <span class="n">solar</span>

<span class="n">app</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">beat_schedule</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Executes at sunset in Melbourne</span>
    <span class="s1">&#39;add-at-melbourne-sunset&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="s1">&#39;tasks.add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;schedule&#39;</span><span class="p">:</span> <span class="n">solar</span><span class="p">(</span><span class="s1">&#39;sunset&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">37.81753</span><span class="p">,</span> <span class="mf">144.96715</span><span class="p">),</span>
        <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The arguments are simply: <code class="docutils literal notranslate"><span class="pre">solar(event,</span> <span class="pre">latitude,</span> <span class="pre">longitude)</span></code></p>
<p>Be sure to use the correct sign for latitude and longitude:</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="34%" />
<col width="39%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Sign</strong></td>
<td><strong>Argument</strong></td>
<td><strong>Meaning</strong></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">+</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">latitude</span></code></td>
<td>North</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">-</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">latitude</span></code></td>
<td>South</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">+</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">longitude</span></code></td>
<td>East</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">-</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">longitude</span></code></td>
<td>West</td>
</tr>
</tbody>
</table>
<p>Possible event types are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="48%" />
<col width="52%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Event</strong></td>
<td><strong>Meaning</strong></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">dawn_astronomical</span></code></td>
<td>Execute at the moment after which the sky
is no longer completely dark. This is when
the sun is 18 degrees below the horizon.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">dawn_nautical</span></code></td>
<td>Execute when there’s enough sunlight for
the horizon and some objects to be
distinguishable; formally, when the sun is
12 degrees below the horizon.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">dawn_civil</span></code></td>
<td>Execute when there’s enough light for
objects to be distinguishable so that
outdoor activities can commence;
formally, when the Sun is 6 degrees below
the horizon.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">sunrise</span></code></td>
<td>Execute when the upper edge of the sun
appears over the eastern horizon in the
morning.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">solar_noon</span></code></td>
<td>Execute when the sun is highest above the
horizon on that day.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">sunset</span></code></td>
<td>Execute when the trailing edge of the sun
disappears over the western horizon in the
evening.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">dusk_civil</span></code></td>
<td>Execute at the end of civil twilight, when
objects are still distinguishable and some
stars and planets are visible. Formally,
when the sun is 6 degrees below the
horizon.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">dusk_nautical</span></code></td>
<td>Execute when the sun is 12 degrees below
the horizon. Objects are no longer
distinguishable, and the horizon is no
longer visible to the naked eye.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">dusk_astronomical</span></code></td>
<td>Execute at the moment after which the sky
becomes completely dark; formally, when
the sun is 18 degrees below the horizon.</td>
</tr>
</tbody>
</table>
<p>All solar events are calculated using UTC, and are therefore
unaffected by your timezone setting.</p>
<p>In polar regions, the sun may not rise or set every day. The scheduler
is able to handle these cases (i.e., a <code class="docutils literal notranslate"><span class="pre">sunrise</span></code> event won’t run on a day
when the sun doesn’t rise). The one exception is <code class="docutils literal notranslate"><span class="pre">solar_noon</span></code>, which is
formally defined as the moment the sun transits the celestial meridian,
and will occur every day even if the sun is below the horizon.</p>
<p>Twilight is defined as the period between dawn and sunrise; and between
sunset and dusk. You can schedule an event according to “twilight”
depending on your definition of twilight (civil, nautical, or astronomical),
and whether you want the event to take place at the beginning or end
of twilight, using the appropriate event from the list above.</p>
<p>See <a class="reference internal" href="../reference/celery.schedules.html#celery.schedules.solar" title="celery.schedules.solar"><code class="xref py py-class docutils literal notranslate"><span class="pre">celery.schedules.solar</span></code></a> for more documentation.</p>
</div>
<div class="section" id="starting-the-scheduler">
<span id="beat-starting"></span><h2><a class="toc-backref" href="#id7">Starting the Scheduler</a><a class="headerlink" href="#starting-the-scheduler" title="Permalink to this headline">¶</a></h2>
<p>To start the <strong class="program">celery beat</strong> service:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj beat
</pre></div>
</div>
<p>You can also embed <cite>beat</cite> inside the worker by enabling the
workers <a class="reference internal" href="../reference/celery.bin.worker.html#cmdoption-celery-worker-b"><code class="xref std std-option docutils literal notranslate"><span class="pre">-B</span></code></a> option, this is convenient if you’ll
never run more than one worker node, but it’s not commonly used and for that
reason isn’t recommended for production use:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj worker -B
</pre></div>
</div>
<p>Beat needs to store the last run times of the tasks in a local database
file (named <cite>celerybeat-schedule</cite> by default), so it needs access to
write in the current directory, or alternatively you can specify a custom
location for this file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj beat -s /home/celery/var/run/celerybeat-schedule
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To daemonize beat see <a class="reference internal" href="daemonizing.html#daemonizing"><span class="std std-ref">Daemonization</span></a>.</p>
</div>
<div class="section" id="using-custom-scheduler-classes">
<span id="beat-custom-schedulers"></span><h3><a class="toc-backref" href="#id8">Using custom scheduler classes</a><a class="headerlink" href="#using-custom-scheduler-classes" title="Permalink to this headline">¶</a></h3>
<p>Custom scheduler classes can be specified on the command-line (the
<a class="reference internal" href="../reference/celery.bin.beat.html#cmdoption-celery-beat-scheduler"><code class="xref std std-option docutils literal notranslate"><span class="pre">--scheduler</span></code></a> argument).</p>
<p>The default scheduler is the <a class="reference internal" href="../reference/celery.beat.html#celery.beat.PersistentScheduler" title="celery.beat.PersistentScheduler"><code class="xref py py-class docutils literal notranslate"><span class="pre">celery.beat.PersistentScheduler</span></code></a>,
that simply keeps track of the last run times in a local <a class="reference external" href="https://docs.python.org/dev/library/shelve.html#module-shelve" title="(in Python v3.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">shelve</span></code></a>
database file.</p>
<p>There’s also the <a class="reference external" href="https://pypi.python.org/pypi/django-celery-beat/">django-celery-beat</a> extension that stores the schedule
in the Django database, and presents a convenient admin interface to manage
periodic tasks at runtime.</p>
<p>To install and use this extension:</p>
<ol class="arabic">
<li><p class="first">Use <strong class="command">pip</strong> to install the package:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> pip install django-celery-beat
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Add the <code class="docutils literal notranslate"><span class="pre">django_celery_beat</span></code> module to <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code> in your
Django project’ <code class="file docutils literal notranslate"><span class="pre">settings.py</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="s1">&#39;django_celery_beat&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note that there is no dash in the module name, only underscores.</p>
</li>
<li><p class="first">Apply Django database migrations so that the necessary tables are created:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py migrate
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Start the <strong class="program">celery beat</strong> service using the <code class="docutils literal notranslate"><span class="pre">django_celery_beat.schedulers:DatabaseScheduler</span></code> scheduler:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A proj beat -l info --scheduler django_celery_beat.schedulers:DatabaseScheduler
</pre></div>
</div>
</div></blockquote>
<p>Note:  You may also add this as an settings option directly.</p>
</li>
<li><p class="first">Visit the Django-Admin interface to set up some periodic tasks.</p>
</li>
</ol>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/celery_512.png" alt="Logo"/>
            </a></p><iframe src="https://ghbtns.com/github-btn.html?user=celery&repo=celery&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>
<div id="donate">
    <b>Please help support this community project with a donation:</b>
    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
    <input type="hidden" name="cmd" value="_s-xclick">
    <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
    ">
    <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
    <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
    </form>
</div>
  <h4>Previous topic</h4>
  <p class="topless"><a href="daemonizing.html"
                        title="previous chapter">Daemonization</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="routing.html"
                        title="next chapter">Routing Tasks</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/userguide/periodic-tasks.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="routing.html" title="Routing Tasks"
             >next</a> |</li>
        <li class="right" >
          <a href="daemonizing.html" title="Daemonization"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Celery 4.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >User Guide</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../copyright.html">Copyright</a> 2009-2017, Ask Solem &amp; contributors.
    </div>
  </body>
</html>