
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Change history for Celery 2.1 &#8212; Celery 4.2.0 documentation</title>
    <link rel="stylesheet" href="../_static/celery.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="Change history for Celery 2.0" href="changelog-2.0.html" />
    <link rel="prev" title="Change history for Celery 2.2" href="changelog-2.2.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="changelog-2.0.html" title="Change history for Celery 2.0"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="changelog-2.2.html" title="Change history for Celery 2.2"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Celery 4.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">History</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
<div class="deck">

    
        <p>
        This document describes the current stable version of Celery (4.2).
        For development docs,
        <a href="http://docs.celeryproject.org/en/master/history/changelog-2.1.html">go here</a>.
        </p>
    

</div>
    <div class="section" id="change-history-for-celery-2-1">
<span id="changelog-2-1"></span><h1>Change history for Celery 2.1<a class="headerlink" href="#change-history-for-celery-2-1" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#version-2-1-4" id="id11">2.1.4</a><ul>
<li><a class="reference internal" href="#fixes" id="id12">Fixes</a></li>
<li><a class="reference internal" href="#documentation" id="id13">Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-2-1-3" id="id14">2.1.3</a></li>
<li><a class="reference internal" href="#version-2-1-2" id="id15">2.1.2</a><ul>
<li><a class="reference internal" href="#v212-fixes" id="id16">Fixes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-2-1-1" id="id17">2.1.1</a><ul>
<li><a class="reference internal" href="#v211-fixes" id="id18">Fixes</a></li>
<li><a class="reference internal" href="#news" id="id19">News</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-2-1-0" id="id20">2.1.0</a><ul>
<li><a class="reference internal" href="#important-notes" id="id21">Important Notes</a></li>
<li><a class="reference internal" href="#v210-news" id="id22">News</a></li>
<li><a class="reference internal" href="#v210-fixes" id="id23">Fixes</a></li>
<li><a class="reference internal" href="#experimental" id="id24">Experimental</a></li>
<li><a class="reference internal" href="#v210-documentation" id="id25">Documentation</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="version-2-1-4">
<span id="id1"></span><h2><a class="toc-backref" href="#id11">2.1.4</a><a class="headerlink" href="#version-2-1-4" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">release-date:</th><td class="field-body">2010-12-03 12:00 p.m. CEST</td>
</tr>
<tr class="field-even field"><th class="field-name">release-by:</th><td class="field-body">Ask Solem</td>
</tr>
</tbody>
</table>
<div class="section" id="fixes">
<span id="v214-fixes"></span><h3><a class="toc-backref" href="#id12">Fixes</a><a class="headerlink" href="#fixes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Execution options to <cite>apply_async</cite> now takes precedence over options
returned by active routers. This was a regression introduced recently
(<span class="xref issue">Issue #244</span>).</li>
<li>curses monitor: Long arguments are now truncated so curses
doesn’t crash with out of bounds errors (<span class="xref issue">Issue #235</span>).</li>
<li>multi: Channel errors occurring while handling control commands no
longer crash the worker but are instead logged with severity error.</li>
<li>SQLAlchemy database backend: Fixed a race condition occurring when
the client wrote the pending state. Just like the Django database backend,
it does no longer save the pending state (<span class="xref issue">Issue #261</span> + <span class="xref issue">Issue #262</span>).</li>
<li>Error email body now uses <cite>repr(exception)</cite> instead of <cite>str(exception)</cite>,
as the latter could result in Unicode decode errors (<span class="xref issue">Issue #245</span>).</li>
<li>Error email timeout value is now configurable by using the
<a class="reference external" href="http://django.readthedocs.io/en/latest/ref/settings.html#std:setting-EMAIL_TIMEOUT" title="(in Django v2.1)"><code class="xref std std-setting docutils literal notranslate"><span class="pre">EMAIL_TIMEOUT</span></code></a> setting.</li>
<li><cite>celeryev</cite>: Now works on Windows (but the curses monitor won’t work without
having curses).</li>
<li>Unit test output no longer emits non-standard characters.</li>
<li>worker: The broadcast consumer is now closed if the connection is reset.</li>
<li>worker: Now properly handles errors occurring while trying to acknowledge
the message.</li>
<li><dl class="first docutils">
<dt><cite>TaskRequest.on_failure</cite> now encodes traceback using the current file-system</dt>
<dd>encoding (<span class="xref issue">Issue #286</span>).</dd>
</dl>
</li>
<li><cite>EagerResult</cite> can now be pickled (<span class="xref issue">Issue #288</span>).</li>
</ul>
</div>
<div class="section" id="documentation">
<span id="v214-documentation"></span><h3><a class="toc-backref" href="#id13">Documentation</a><a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Adding <a class="reference internal" href="../contributing.html#contributing"><span class="std std-ref">Contributing</span></a>.</li>
<li>Added <a class="reference internal" href="../userguide/optimizing.html#guide-optimizing"><span class="std std-ref">Optimizing</span></a>.</li>
<li>Added <a class="reference internal" href="../faq.html#faq-security"><span class="std std-ref">Security</span></a> section to the FAQ.</li>
</ul>
</div>
</div>
<div class="section" id="version-2-1-3">
<span id="id2"></span><h2><a class="toc-backref" href="#id14">2.1.3</a><a class="headerlink" href="#version-2-1-3" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">release-date:</th><td class="field-body">2010-11-09 05:00 p.m. CEST</td>
</tr>
<tr class="field-even field"><th class="field-name">release-by:</th><td class="field-body">Ask Solem</td>
</tr>
</tbody>
</table>
<ul id="v213-fixes">
<li><p class="first">Fixed deadlocks in <cite>timer2</cite> which could lead to <cite>djcelerymon</cite>/<cite>celeryev -c</cite>
hanging.</p>
</li>
<li><p class="first"><cite>EventReceiver</cite>: now sends heartbeat request to find workers.</p>
<blockquote>
<div><p>This means <strong class="program">celeryev</strong> and friends finds workers immediately
at start-up.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">celeryev</span></code> curses monitor: Set screen_delay to 10ms, so the screen
refreshes more often.</p>
</li>
<li><p class="first">Fixed pickling errors when pickling <code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncResult</span></code> on older Python
versions.</p>
</li>
<li><p class="first">worker: prefetch count was decremented by ETA tasks even if there
were no active prefetch limits.</p>
</li>
</ul>
</div>
<div class="section" id="version-2-1-2">
<span id="id3"></span><h2><a class="toc-backref" href="#id15">2.1.2</a><a class="headerlink" href="#version-2-1-2" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">release-data:</th><td class="field-body">TBA</td>
</tr>
</tbody>
</table>
<div class="section" id="v212-fixes">
<span id="id4"></span><h3><a class="toc-backref" href="#id16">Fixes</a><a class="headerlink" href="#v212-fixes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>worker: Now sends the <a class="reference internal" href="../userguide/monitoring.html#std:event-task-retried"><code class="xref std std-event docutils literal notranslate"><span class="pre">task-retried</span></code></a> event for retried tasks.</li>
<li>worker: Now honors ignore result for
<a class="reference internal" href="../reference/celery.exceptions.html#celery.exceptions.WorkerLostError" title="celery.exceptions.WorkerLostError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">WorkerLostError</span></code></a> and timeout errors.</li>
<li><code class="docutils literal notranslate"><span class="pre">celerybeat</span></code>: Fixed <a class="reference external" href="https://docs.python.org/dev/library/exceptions.html#UnboundLocalError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">UnboundLocalError</span></code></a> in <code class="docutils literal notranslate"><span class="pre">celerybeat</span></code> logging
when using logging setup signals.</li>
<li>worker: All log messages now includes <cite>exc_info</cite>.</li>
</ul>
</div>
</div>
<div class="section" id="version-2-1-1">
<span id="id5"></span><h2><a class="toc-backref" href="#id17">2.1.1</a><a class="headerlink" href="#version-2-1-1" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">release-date:</th><td class="field-body">2010-10-14 02:00 p.m. CEST</td>
</tr>
<tr class="field-even field"><th class="field-name">release-by:</th><td class="field-body">Ask Solem</td>
</tr>
</tbody>
</table>
<div class="section" id="v211-fixes">
<span id="id6"></span><h3><a class="toc-backref" href="#id18">Fixes</a><a class="headerlink" href="#v211-fixes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Now working on Windows again.</p>
<blockquote>
<div><p>Removed dependency on the <a class="reference external" href="https://docs.python.org/dev/library/pwd.html#module-pwd" title="(in Python v3.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pwd</span></code></a>/<a class="reference external" href="https://docs.python.org/dev/library/grp.html#module-grp" title="(in Python v3.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">grp</span></code></a> modules.</p>
</div></blockquote>
</li>
<li><p class="first">snapshots: Fixed race condition leading to loss of events.</p>
</li>
<li><p class="first">worker: Reject tasks with an ETA that cannot be converted to a time stamp.</p>
<blockquote>
<div><p>See <span class="xref issue">issue #209</span></p>
</div></blockquote>
</li>
<li><p class="first">concurrency.processes.pool: The semaphore was released twice for each task
(both at ACK and result ready).</p>
<blockquote>
<div><p>This has been fixed, and it is now released only once per task.</p>
</div></blockquote>
</li>
<li><p class="first">docs/configuration: Fixed typo <cite>CELERYD_TASK_SOFT_TIME_LIMIT</cite> -&gt;
<code class="xref std std-setting docutils literal notranslate"><span class="pre">CELERYD_TASK_SOFT_TIME_LIMIT</span></code>.</p>
<blockquote>
<div><p>See <span class="xref issue">issue #214</span></p>
</div></blockquote>
</li>
<li><p class="first">control command <cite>dump_scheduled</cite>: was using old .info attribute</p>
</li>
<li><dl class="first docutils">
<dt>multi: Fixed <cite>set changed size during iteration</cite> bug</dt>
<dd><p class="first last">occurring in the restart command.</p>
</dd>
</dl>
</li>
<li><p class="first">worker: Accidentally tried to use additional command-line arguments.</p>
<blockquote>
<div><p>This would lead to an error like:</p>
<blockquote>
<div><p><cite>got multiple values for keyword argument ‘concurrency’</cite>.</p>
<p>Additional command-line arguments are now ignored, and doesn’t
produce this error. However – we do reserve the right to use
positional arguments in the future, so please don’t depend on this
behavior.</p>
</div></blockquote>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">celerybeat</span></code>: Now respects routers and task execution options again.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">celerybeat</span></code>: Now reuses the publisher instead of the connection.</p>
</li>
<li><p class="first">Cache result backend: Using <a class="reference external" href="https://docs.python.org/dev/library/functions.html#float" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a> as the expires argument
to <cite>cache.set</cite> is deprecated by the Memcached libraries,
so we now automatically cast to <a class="reference external" href="https://docs.python.org/dev/library/functions.html#int" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>.</p>
</li>
<li><p class="first">unit tests: No longer emits logging and warnings in test output.</p>
</li>
</ul>
</div>
<div class="section" id="news">
<span id="v211-news"></span><h3><a class="toc-backref" href="#id19">News</a><a class="headerlink" href="#news" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Now depends on carrot version 0.10.7.</p>
</li>
<li><p class="first">Added <code class="xref std std-setting docutils literal notranslate"><span class="pre">CELERY_REDIRECT_STDOUTS</span></code>, and
<code class="xref std std-setting docutils literal notranslate"><span class="pre">CELERYD_REDIRECT_STDOUTS_LEVEL</span></code> settings.</p>
<blockquote>
<div><p><code class="xref std std-setting docutils literal notranslate"><span class="pre">CELERY_REDIRECT_STDOUTS</span></code> is used by the worker and
beat. All output to <cite>stdout</cite> and <cite>stderr</cite> will be
redirected to the current logger if enabled.</p>
<p><code class="xref std std-setting docutils literal notranslate"><span class="pre">CELERY_REDIRECT_STDOUTS_LEVEL</span></code> decides the log level used and is
<code class="xref py py-const docutils literal notranslate"><span class="pre">WARNING</span></code> by default.</p>
</div></blockquote>
</li>
<li><p class="first">Added <code class="xref std std-setting docutils literal notranslate"><span class="pre">CELERYBEAT_SCHEDULER</span></code> setting.</p>
<blockquote>
<div><p>This setting is used to define the default for the -S option to
<strong class="program">celerybeat</strong>.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">CELERYBEAT_SCHEDULER</span> <span class="o">=</span> <span class="s1">&#39;djcelery.schedulers.DatabaseScheduler&#39;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Added Task.expires: Used to set default expiry time for tasks.</p>
</li>
<li><p class="first">New remote control commands: <cite>add_consumer</cite> and <cite>cancel_consumer</cite>.</p>
<blockquote>
<div><dl class="method">
<dt>
<code class="descname">add_consumer(queue, exchange, exchange_type, routing_key,</code></dt>
<dt>
<code class="descname">**options)</code></dt>
<dd><p>Tells the worker to declare and consume from the specified
declaration.</p>
</dd></dl>

<dl class="method">
<dt id="cancel_consumer">
<code class="descname">cancel_consumer</code><span class="sig-paren">(</span><em>queue_name</em><span class="sig-paren">)</span><a class="headerlink" href="#cancel_consumer" title="Permalink to this definition">¶</a></dt>
<dd><p>Tells the worker to stop consuming from queue (by queue name).</p>
</dd></dl>

<p>Commands also added to <strong class="program">celeryctl</strong> and
<code class="xref py py-class docutils literal notranslate"><span class="pre">inspect</span></code>.</p>
<p>Example using <code class="docutils literal notranslate"><span class="pre">celeryctl</span></code> to start consuming from queue “queue”, in
exchange “exchange”, of type “direct” using binding key “key”:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celeryctl inspect add_consumer queue exchange direct key
<span class="gp">$</span> celeryctl inspect cancel_consumer queue
</pre></div>
</div>
<p>See <a class="reference internal" href="../userguide/monitoring.html#monitoring-control"><span class="std std-ref">Management Command-line Utilities (inspect/control)</span></a> for more information about the
<strong class="program">celeryctl</strong> program.</p>
<p>Another example using <code class="xref py py-class docutils literal notranslate"><span class="pre">inspect</span></code>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celery.task.control</span> <span class="kn">import</span> <span class="n">inspect</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="o">.</span><span class="n">add_consumer</span><span class="p">(</span><span class="n">queue</span><span class="o">=</span><span class="s1">&#39;queue&#39;</span><span class="p">,</span> <span class="n">exchange</span><span class="o">=</span><span class="s1">&#39;exchange&#39;</span><span class="p">,</span>
<span class="gp">... </span>                     <span class="n">exchange_type</span><span class="o">=</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span>
<span class="gp">... </span>                     <span class="n">routing_key</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">,</span>
<span class="gp">... </span>                     <span class="n">durable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
<span class="gp">... </span>                     <span class="n">auto_delete</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="o">.</span><span class="n">cancel_consumer</span><span class="p">(</span><span class="s1">&#39;queue&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">celerybeat</span></code>: Now logs the traceback if a message can’t be sent.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">celerybeat</span></code>: Now enables a default socket timeout of 30 seconds.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">README</span></code>/introduction/homepage: Added link to <a class="reference external" href="https://github.com/ask/flask-celery">Flask-Celery</a>.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="version-2-1-0">
<span id="id7"></span><h2><a class="toc-backref" href="#id20">2.1.0</a><a class="headerlink" href="#version-2-1-0" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">release-date:</th><td class="field-body">2010-10-08 12:00 p.m. CEST</td>
</tr>
<tr class="field-even field"><th class="field-name">release-by:</th><td class="field-body">Ask Solem</td>
</tr>
</tbody>
</table>
<div class="section" id="important-notes">
<span id="v210-important"></span><h3><a class="toc-backref" href="#id21">Important Notes</a><a class="headerlink" href="#important-notes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Celery is now following the versioning semantics defined by <a class="reference external" href="http://semver.org">semver</a>.</p>
<blockquote>
<div><p>This means we’re no longer allowed to use odd/even versioning semantics
By our previous versioning scheme this stable release should’ve
been version 2.2.</p>
</div></blockquote>
</li>
</ul>
<ul>
<li><p class="first">Now depends on Carrot 0.10.7.</p>
</li>
<li><p class="first">No longer depends on SQLAlchemy, this needs to be installed separately
if the database result backend is used.</p>
</li>
<li><p class="first"><a class="reference external" href="https://pypi.python.org/pypi/django-celery/">django-celery</a> now comes with a monitor for the Django Admin
interface. This can also be used if you’re not a Django user.
(Update: Django-Admin monitor has been replaced with Flower, see the
Monitoring guide).</p>
</li>
<li><p class="first">If you get an error after upgrading saying:
<cite>AttributeError: ‘module’ object has no attribute ‘system’</cite>,</p>
<blockquote>
<div><p>Then this is because the <cite>celery.platform</cite> module has been
renamed to <cite>celery.platforms</cite> to not collide with the built-in
<a class="reference external" href="https://docs.python.org/dev/library/platform.html#module-platform" title="(in Python v3.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">platform</span></code></a> module.</p>
<p>You have to remove the old <code class="file docutils literal notranslate"><span class="pre">platform.py</span></code> (and maybe
<code class="file docutils literal notranslate"><span class="pre">platform.pyc</span></code>) file from your previous Celery installation.</p>
<p>To do this use <strong class="program">python</strong> to find the location
of this module:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python
<span class="gp">&gt;</span>&gt;&gt; import celery.platform
<span class="gp">&gt;</span>&gt;&gt; celery.platform
<span class="go">&lt;module &#39;celery.platform&#39; from &#39;/opt/devel/celery/celery/platform.pyc&#39;&gt;</span>
</pre></div>
</div>
<p>Here the compiled module is in <code class="file docutils literal notranslate"><span class="pre">/opt/devel/celery/celery/</span></code>,
to remove the offending files do:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> rm -f /opt/devel/celery/celery/platform.py*
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="v210-news">
<span id="id8"></span><h3><a class="toc-backref" href="#id22">News</a><a class="headerlink" href="#v210-news" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Added support for expiration of AMQP results (requires RabbitMQ 2.1.0)</p>
<blockquote>
<div><p>The new configuration option <code class="xref std std-setting docutils literal notranslate"><span class="pre">CELERY_AMQP_TASK_RESULT_EXPIRES</span></code>
sets the expiry time in seconds (can be int or float):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">CELERY_AMQP_TASK_RESULT_EXPIRES</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span>  <span class="c1"># 30 minutes.</span>
<span class="n">CELERY_AMQP_TASK_RESULT_EXPIRES</span> <span class="o">=</span> <span class="mf">0.80</span>     <span class="c1"># 800 ms.</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">celeryev</span></code>: Event Snapshots</p>
<blockquote>
<div><p>If enabled, the worker sends messages about what the worker is doing.
These messages are called “events”.
The events are used by real-time monitors to show what the
cluster is doing, but they’re not very useful for monitoring
over a longer period of time. Snapshots
lets you take “pictures” of the clusters state at regular intervals.
This can then be stored in a database to generate statistics
with, or even monitoring over longer time periods.</p>
<p><a class="reference external" href="https://pypi.python.org/pypi/django-celery/">django-celery</a> now comes with a Celery monitor for the Django
Admin interface. To use this you need to run the <a class="reference external" href="https://pypi.python.org/pypi/django-celery/">django-celery</a>
snapshot camera, which stores snapshots to the database at configurable
intervals.</p>
<p>To use the Django admin monitor you need to do the following:</p>
<ol class="arabic">
<li><p class="first">Create the new database tables:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py syncdb
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Start the <a class="reference external" href="https://pypi.python.org/pypi/django-celery/">django-celery</a> snapshot camera:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py celerycam
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Open up the django admin to monitor your cluster.</p>
</li>
</ol>
<p>The admin interface shows tasks, worker nodes, and even
lets you perform some actions, like revoking and rate limiting tasks,
and shutting down worker nodes.</p>
<p>There’s also a Debian init.d script for <a class="reference internal" href="../reference/celery.bin.events.html#module-celery.bin.events" title="celery.bin.events"><code class="xref py py-mod docutils literal notranslate"><span class="pre">events</span></code></a> available,
see <a class="reference internal" href="../userguide/daemonizing.html#daemonizing"><span class="std std-ref">Daemonization</span></a> for more information.</p>
<p>New command-line arguments to <code class="docutils literal notranslate"><span class="pre">celeryev</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="../reference/celery.bin.events.html#cmdoption-celery-events-c"><code class="xref std std-option docutils literal notranslate"><span class="pre">celery</span> <span class="pre">events</span> <span class="pre">--camera</span></code></a>: Snapshot camera class to use.</li>
<li><a class="reference internal" href="../reference/celery.bin.events.html#cmdoption-celery-events-logfile"><code class="xref std std-option docutils literal notranslate"><span class="pre">celery</span> <span class="pre">events</span> <span class="pre">--logfile</span></code></a>: Log file</li>
<li><a class="reference internal" href="../reference/celery.bin.events.html#cmdoption-celery-events-l"><code class="xref std std-option docutils literal notranslate"><span class="pre">celery</span> <span class="pre">events</span> <span class="pre">--loglevel</span></code></a>: Log level</li>
<li><a class="reference internal" href="../reference/celery.bin.events.html#cmdoption-celery-events-r"><code class="xref std std-option docutils literal notranslate"><span class="pre">celery</span> <span class="pre">events</span> <span class="pre">--maxrate</span></code></a>: Shutter rate limit.</li>
<li><a class="reference internal" href="../reference/celery.bin.events.html#cmdoption-celery-events-f"><code class="xref std std-option docutils literal notranslate"><span class="pre">celery</span> <span class="pre">events</span> <span class="pre">--freq</span></code></a>: Shutter frequency</li>
</ul>
</div></blockquote>
<p>The <a class="reference internal" href="../reference/celery.bin.events.html#cmdoption-celery-events-c"><code class="xref std std-option docutils literal notranslate"><span class="pre">--camera</span></code></a> argument is the name
of a class used to take snapshots with. It must support the interface
defined by <a class="reference internal" href="../internals/reference/celery.events.snapshot.html#celery.events.snapshot.Polaroid" title="celery.events.snapshot.Polaroid"><code class="xref py py-class docutils literal notranslate"><span class="pre">celery.events.snapshot.Polaroid</span></code></a>.</p>
<p>Shutter frequency controls how often the camera thread wakes up,
while the rate limit controls how often it will actually take
a snapshot.
The rate limit can be an integer (snapshots/s), or a rate limit string
which has the same syntax as the task rate limit strings (<cite>“200/m”</cite>,
<cite>“10/s”</cite>, <cite>“1/h”,</cite> etc).</p>
<p>For the Django camera case, this rate limit can be used to control
how often the snapshots are written to the database, and the frequency
used to control how often the thread wakes up to check if there’s
anything new.</p>
<p>The rate limit is off by default, which means it will take a snapshot
for every <a class="reference internal" href="../reference/celery.bin.events.html#cmdoption-celery-events-f"><code class="xref std std-option docutils literal notranslate"><span class="pre">--frequency</span></code></a> seconds.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="xref py py-func docutils literal notranslate"><span class="pre">broadcast()</span></code>: Added callback argument, this can be
used to process replies immediately as they arrive.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">celeryctl</span></code>: New command line utility to manage and inspect worker nodes,
apply tasks and inspect the results of tasks.</p>
<blockquote>
<div><div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">The <a class="reference internal" href="../userguide/monitoring.html#monitoring-control"><span class="std std-ref">Management Command-line Utilities (inspect/control)</span></a> section in the <a class="reference internal" href="../userguide/index.html#guide"><span class="std std-ref">User Guide</span></a>.</p>
</div>
<p>Some examples:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celeryctl apply tasks.add -a <span class="s1">&#39;[2, 2]&#39;</span> --countdown<span class="o">=</span><span class="m">10</span>

<span class="gp">$</span> celeryctl inspect active
<span class="gp">$</span> celeryctl inspect registered_tasks
<span class="gp">$</span> celeryctl inspect scheduled
<span class="gp">$</span> celeryctl inspect --help
<span class="gp">$</span> celeryctl apply --help
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Added the ability to set an expiry date and time for tasks.</p>
<blockquote>
<div><p>Example:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Task expires after one minute from now.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">task</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">expires</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Also supports datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">task</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span>
<span class="gp">... </span>                 <span class="n">expires</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>When a worker receives a task that’s been expired it will be
marked as revoked (<a class="reference internal" href="../reference/celery.exceptions.html#celery.exceptions.TaskRevokedError" title="celery.exceptions.TaskRevokedError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TaskRevokedError</span></code></a>).</p>
</div></blockquote>
</li>
<li><p class="first">Changed the way logging is configured.</p>
<blockquote>
<div><p>We now configure the root logger instead of only configuring
our custom logger. In addition we don’t hijack
the multiprocessing logger anymore, but instead use a custom logger name
for different applications:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Application</strong></th>
<th class="head"><strong>Logger Name</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">celeryd</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">&quot;celery&quot;</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">celerybeat</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">&quot;celery.beat&quot;</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">celeryev</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">&quot;celery.ev&quot;</span></code></td>
</tr>
</tbody>
</table>
<p>This means that the <cite>loglevel</cite> and <cite>logfile</cite> arguments will
affect all registered loggers (even those from third-party libraries).
Unless you configure the loggers manually as shown below, that is.</p>
<p><em>Users can choose to configure logging by subscribing to the
:signal:`~celery.signals.setup_logging` signal:</em></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">logging.config</span> <span class="kn">import</span> <span class="n">fileConfig</span>
<span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">signals</span>

<span class="nd">@signals.setup_logging.connect</span>
<span class="k">def</span> <span class="nf">setup_logging</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">fileConfig</span><span class="p">(</span><span class="s1">&#39;logging.conf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If there are no receivers for this signal, the logging subsystem
will be configured using the
<a class="reference internal" href="../reference/celery.bin.worker.html#cmdoption-celery-worker-l"><code class="xref std std-option docutils literal notranslate"><span class="pre">--loglevel</span></code></a>/
<a class="reference internal" href="../reference/celery.bin.worker.html#cmdoption-celery-worker-f"><code class="xref std std-option docutils literal notranslate"><span class="pre">--logfile</span></code></a>
arguments, this will be used for <em>all defined loggers</em>.</p>
<p>Remember that the worker also redirects stdout and stderr
to the Celery logger, if manually configure logging
you also need to redirect the standard outs manually:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="kn">from</span> <span class="nn">logging.config</span> <span class="kn">import</span> <span class="n">fileConfig</span>
 <span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">log</span>

<span class="k">def</span> <span class="nf">setup_logging</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
     <span class="kn">import</span> <span class="nn">logging</span>
     <span class="n">fileConfig</span><span class="p">(</span><span class="s1">&#39;logging.conf&#39;</span><span class="p">)</span>
     <span class="n">stdouts</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;mystdoutslogger&#39;</span><span class="p">)</span>
     <span class="n">log</span><span class="o">.</span><span class="n">redirect_stdouts_to_logger</span><span class="p">(</span><span class="n">stdouts</span><span class="p">,</span> <span class="n">loglevel</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">worker Added command line option
<a class="reference internal" href="../reference/celery.bin.worker.html#cmdoption-celery-worker-i"><code class="xref std std-option docutils literal notranslate"><span class="pre">--include</span></code></a>:</p>
<blockquote>
<div><p>A comma separated list of (task) modules to be imported.</p>
<p>Example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celeryd -I app1.tasks,app2.tasks
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">worker: now emits a warning if running as the root user (euid is 0).</p>
</li>
<li><p class="first"><code class="xref py py-func docutils literal notranslate"><span class="pre">celery.messaging.establish_connection()</span></code>: Ability to override defaults
used using keyword argument “defaults”.</p>
</li>
<li><p class="first">worker: Now uses <cite>multiprocessing.freeze_support()</cite> so that it should work
with <strong>py2exe</strong>, <strong>PyInstaller</strong>, <strong>cx_Freeze</strong>, etc.</p>
</li>
<li><p class="first">worker: Now includes more meta-data for the <a class="reference internal" href="../userguide/tasks.html#std:state-STARTED"><code class="xref std std-state docutils literal notranslate"><span class="pre">STARTED</span></code></a> state: PID and
host name of the worker that started the task.</p>
<blockquote>
<div><p>See <span class="xref issue">issue #181</span></p>
</div></blockquote>
</li>
<li><p class="first">subtask: Merge additional keyword arguments to <cite>subtask()</cite> into task keyword
arguments.</p>
<blockquote>
<div><p>For example:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">subtask</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">},</span> <span class="n">baz</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">args</span>
<span class="go">(1, 2)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">kwargs</span>
<span class="go">{&#39;foo&#39;: &#39;bar&#39;, &#39;baz&#39;: 1}</span>
</pre></div>
</div>
<p>See <span class="xref issue">issue #182</span>.</p>
</div></blockquote>
</li>
<li><p class="first">worker: Now emits a warning if there’s already a worker node using the same
name running on the same virtual host.</p>
</li>
<li><p class="first">AMQP result backend: Sending of results are now retried if the connection
is down.</p>
</li>
<li><dl class="first docutils">
<dt>AMQP result backend: <cite>result.get()</cite>: Wait for next state if state isn’t</dt>
<dd><p class="first last">in <code class="xref py py-data docutils literal notranslate"><span class="pre">READY_STATES</span></code>.</p>
</dd>
</dl>
</li>
<li><p class="first">TaskSetResult now supports subscription.</p>
<blockquote>
<div><div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">TaskSet</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span><span class="o">.</span><span class="n">apply_async</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Added <cite>Task.send_error_emails</cite> + <cite>Task.error_whitelist</cite>, so these can
be configured per task instead of just by the global setting.</p>
</li>
<li><p class="first">Added <cite>Task.store_errors_even_if_ignored</cite>, so it can be changed per Task,
not just by the global setting.</p>
</li>
<li><p class="first">The Crontab scheduler no longer wakes up every second, but implements
<cite>remaining_estimate</cite> (<em>Optimization</em>).</p>
</li>
<li><dl class="first docutils">
<dt>worker:  Store <a class="reference internal" href="../userguide/tasks.html#std:state-FAILURE"><code class="xref std std-state docutils literal notranslate"><span class="pre">FAILURE</span></code></a> result if the</dt>
<dd><p class="first last"><a class="reference internal" href="../reference/celery.exceptions.html#celery.exceptions.WorkerLostError" title="celery.exceptions.WorkerLostError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">WorkerLostError</span></code></a> exception occurs (worker process
disappeared).</p>
</dd>
</dl>
</li>
<li><p class="first">worker: Store <a class="reference internal" href="../userguide/tasks.html#std:state-FAILURE"><code class="xref std std-state docutils literal notranslate"><span class="pre">FAILURE</span></code></a> result if one of the <cite>*TimeLimitExceeded</cite>
exceptions occurs.</p>
</li>
<li><p class="first">Refactored the periodic task responsible for cleaning up results.</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt>The backend cleanup task is now only added to the schedule if</dt>
<dd><code class="xref std std-setting docutils literal notranslate"><span class="pre">CELERY_TASK_RESULT_EXPIRES</span></code> is set.</dd>
</dl>
</li>
<li>If the schedule already contains a periodic task named
“celery.backend_cleanup” it won’t change it, so the behavior of the
backend cleanup task can be easily changed.</li>
<li>The task is now run every day at 4:00 AM, rather than every day since
the first time it was run (using Crontab schedule instead of
<cite>run_every</cite>)</li>
<li><dl class="first docutils">
<dt>Renamed <cite>celery.task.builtins.DeleteExpiredTaskMetaTask</cite></dt>
<dd>-&gt; <code class="xref py py-class docutils literal notranslate"><span class="pre">celery.task.builtins.backend_cleanup</span></code></dd>
</dl>
</li>
<li>The task itself has been renamed from “celery.delete_expired_task_meta”
to “celery.backend_cleanup”</li>
</ul>
<p>See <span class="xref issue">issue #134</span>.</p>
</div></blockquote>
</li>
<li><p class="first">Implemented <cite>AsyncResult.forget</cite> for SQLAlchemy/Memcached/Redis/Tokyo Tyrant
backends (forget and remove task result).</p>
<blockquote>
<div><p>See <span class="xref issue">issue #184</span>.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TaskSetResult.join</span></code>:
Added ‘propagate=True’ argument.</p>
<p>When set to <code class="xref py py-const docutils literal notranslate"><span class="pre">False</span></code> exceptions occurring in subtasks will
not be re-raised.</p>
</li>
<li><p class="first">Added <cite>Task.update_state(task_id, state, meta)</cite>
as a shortcut to <cite>task.backend.store_result(task_id, meta, state)</cite>.</p>
<blockquote>
<div><p>The backend interface is “private” and the terminology outdated,
so better to move this to <code class="xref py py-class docutils literal notranslate"><span class="pre">Task</span></code> so it can be
used.</p>
</div></blockquote>
</li>
<li><p class="first">timer2: Set <cite>self.running=False</cite> in
<a class="reference internal" href="../internals/reference/celery.utils.timer2.html#celery.utils.timer2.Timer.stop" title="celery.utils.timer2.Timer.stop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">stop()</span></code></a> so it won’t try to join again on
subsequent calls to <cite>stop()</cite>.</p>
</li>
<li><p class="first">Log colors are now disabled by default on Windows.</p>
</li>
<li><p class="first"><cite>celery.platform</cite> renamed to <a class="reference internal" href="../internals/reference/celery.platforms.html#module-celery.platforms" title="celery.platforms"><code class="xref py py-mod docutils literal notranslate"><span class="pre">celery.platforms</span></code></a>, so it doesn’t
collide with the built-in <a class="reference external" href="https://docs.python.org/dev/library/platform.html#module-platform" title="(in Python v3.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">platform</span></code></a> module.</p>
</li>
<li><p class="first">Exceptions occurring in Mediator+Pool callbacks are now caught and logged
instead of taking down the worker.</p>
</li>
<li><p class="first">Redis result backend: Now supports result expiration using the Redis
<cite>EXPIRE</cite> command.</p>
</li>
<li><p class="first">unit tests: Don’t leave threads running at tear down.</p>
</li>
<li><p class="first">worker: Task results shown in logs are now truncated to 46 chars.</p>
</li>
<li><dl class="first docutils">
<dt><cite>Task.__name__</cite> is now an alias to <cite>self.__class__.__name__</cite>.</dt>
<dd><p class="first last">This way tasks introspects more like regular functions.</p>
</dd>
</dl>
</li>
<li><p class="first"><cite>Task.retry</cite>: Now raises <a class="reference external" href="https://docs.python.org/dev/library/exceptions.html#TypeError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a> if kwargs argument is empty.</p>
<blockquote>
<div><p>See <span class="xref issue">issue #164</span>.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">timedelta_seconds</span></code>: Use <code class="docutils literal notranslate"><span class="pre">timedelta.total_seconds</span></code> if running on Python 2.7</p>
</li>
<li><p class="first"><a class="reference external" href="http://kombu.readthedocs.io/en/master/reference/kombu.utils.limits.html#kombu.utils.limits.TokenBucket" title="(in Kombu v4.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">TokenBucket</span></code></a>: Generic Token Bucket algorithm</p>
</li>
<li><p class="first"><a class="reference internal" href="../reference/celery.events.state.html#module-celery.events.state" title="celery.events.state"><code class="xref py py-mod docutils literal notranslate"><span class="pre">celery.events.state</span></code></a>: Recording of cluster state can now
be paused and resumed, including support for buffering.</p>
<blockquote>
<div><dl class="method">
<dt id="State.freeze">
<code class="descclassname">State.</code><code class="descname">freeze</code><span class="sig-paren">(</span><em>buffer=True</em><span class="sig-paren">)</span><a class="headerlink" href="#State.freeze" title="Permalink to this definition">¶</a></dt>
<dd><p>Pauses recording of the stream.</p>
<p>If <cite>buffer</cite> is true, events received while being frozen will be
buffered, and may be replayed later.</p>
</dd></dl>

<dl class="method">
<dt id="State.thaw">
<code class="descclassname">State.</code><code class="descname">thaw</code><span class="sig-paren">(</span><em>replay=True</em><span class="sig-paren">)</span><a class="headerlink" href="#State.thaw" title="Permalink to this definition">¶</a></dt>
<dd><p>Resumes recording of the stream.</p>
<p>If <cite>replay</cite> is true, then the recorded buffer will be applied.</p>
</dd></dl>

<dl class="method">
<dt id="State.freeze_while">
<code class="descclassname">State.</code><code class="descname">freeze_while</code><span class="sig-paren">(</span><em>fun</em><span class="sig-paren">)</span><a class="headerlink" href="#State.freeze_while" title="Permalink to this definition">¶</a></dt>
<dd><p>With a function to apply, freezes the stream before,
and replays the buffer after the function returns.</p>
</dd></dl>

</div></blockquote>
</li>
<li><p class="first"><a class="reference internal" href="../reference/celery.events.html#celery.events.EventReceiver.capture" title="celery.events.EventReceiver.capture"><code class="xref py py-meth docutils literal notranslate"><span class="pre">EventReceiver.capture</span></code></a>
Now supports a timeout keyword argument.</p>
</li>
<li><p class="first">worker: The mediator thread is now disabled if
<code class="xref std std-setting docutils literal notranslate"><span class="pre">CELERY_RATE_LIMITS</span></code> is enabled, and tasks are directly sent to the
pool without going through the ready queue (<em>Optimization</em>).</p>
</li>
</ul>
</div>
<div class="section" id="v210-fixes">
<span id="id9"></span><h3><a class="toc-backref" href="#id23">Fixes</a><a class="headerlink" href="#v210-fixes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Pool: Process timed out by <cite>TimeoutHandler</cite> must be joined by the Supervisor,
so don’t remove it from the internal process list.</p>
<blockquote>
<div><p>See <span class="xref issue">issue #192</span>.</p>
</div></blockquote>
</li>
<li><p class="first"><cite>TaskPublisher.delay_task</cite> now supports exchange argument, so exchange can be
overridden when sending tasks in bulk using the same publisher</p>
<blockquote>
<div><p>See <span class="xref issue">issue #187</span>.</p>
</div></blockquote>
</li>
<li><p class="first">the worker no longer marks tasks as revoked if <code class="xref std std-setting docutils literal notranslate"><span class="pre">CELERY_IGNORE_RESULT</span></code>
is enabled.</p>
<blockquote>
<div><p>See <span class="xref issue">issue #207</span>.</p>
</div></blockquote>
</li>
<li><p class="first">AMQP Result backend: Fixed bug with <cite>result.get()</cite> if
<code class="xref std std-setting docutils literal notranslate"><span class="pre">CELERY_TRACK_STARTED</span></code> enabled.</p>
<blockquote>
<div><p><cite>result.get()</cite> would stop consuming after receiving the
<a class="reference internal" href="../userguide/tasks.html#std:state-STARTED"><code class="xref std std-state docutils literal notranslate"><span class="pre">STARTED</span></code></a> state.</p>
</div></blockquote>
</li>
<li><p class="first">Fixed bug where new processes created by the pool supervisor becomes stuck
while reading from the task Queue.</p>
<blockquote>
<div><p>See <a class="reference external" href="http://bugs.python.org/issue10037">http://bugs.python.org/issue10037</a></p>
</div></blockquote>
</li>
<li><p class="first">Fixed timing issue when declaring the remote control command reply queue</p>
<blockquote>
<div><p>This issue could result in replies being lost, but have now been fixed.</p>
</div></blockquote>
</li>
<li><p class="first">Backward compatible <cite>LoggerAdapter</cite> implementation: Now works for Python 2.4.</p>
<blockquote>
<div><p>Also added support for several new methods:
<cite>fatal</cite>, <cite>makeRecord</cite>, <cite>_log</cite>, <cite>log</cite>, <cite>isEnabledFor</cite>,
<cite>addHandler</cite>, <cite>removeHandler</cite>.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="experimental">
<span id="v210-experimental"></span><h3><a class="toc-backref" href="#id24">Experimental</a><a class="headerlink" href="#experimental" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">multi: Added daemonization support.</p>
<blockquote>
<div><p>multi can now be used to start, stop and restart worker nodes:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celeryd-multi start jerry elaine george kramer
</pre></div>
</div>
<p>This also creates PID files and log files (<code class="file docutils literal notranslate"><span class="pre">celeryd&#64;jerry.pid</span></code>,
…, <code class="file docutils literal notranslate"><span class="pre">celeryd&#64;jerry.log</span></code>. To specify a location for these files
use the <cite>–pidfile</cite> and <cite>–logfile</cite> arguments with the <cite>%n</cite>
format:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celeryd-multi start jerry elaine george kramer <span class="se">\</span>
                --logfile<span class="o">=</span>/var/log/celeryd@%n.log <span class="se">\</span>
                --pidfile<span class="o">=</span>/var/run/celeryd@%n.pid
</pre></div>
</div>
<p>Stopping:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celeryd-multi stop jerry elaine george kramer
</pre></div>
</div>
<p>Restarting. The nodes will be restarted one by one as the old ones
are shutdown:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celeryd-multi restart jerry elaine george kramer
</pre></div>
</div>
<p>Killing the nodes (<strong>WARNING</strong>: Will discard currently executing tasks):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celeryd-multi <span class="nb">kill</span> jerry elaine george kramer
</pre></div>
</div>
<p>See <cite>celeryd-multi help</cite> for help.</p>
</div></blockquote>
</li>
<li><p class="first">multi: <cite>start</cite> command renamed to <cite>show</cite>.</p>
<blockquote>
<div><p><cite>celeryd-multi start</cite> will now actually start and detach worker nodes.
To just generate the commands you have to use <cite>celeryd-multi show</cite>.</p>
</div></blockquote>
</li>
<li><p class="first">worker: Added <cite>–pidfile</cite> argument.</p>
<blockquote>
<div><p>The worker will write its pid when it starts. The worker will
not be started if this file exists and the pid contained is still alive.</p>
</div></blockquote>
</li>
<li><p class="first">Added generic init.d script using <cite>celeryd-multi</cite></p>
<blockquote>
<div><p><a class="reference external" href="https://github.com/celery/celery/tree/master/extra/generic-init.d/celeryd">https://github.com/celery/celery/tree/master/extra/generic-init.d/celeryd</a></p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="v210-documentation">
<span id="id10"></span><h3><a class="toc-backref" href="#id25">Documentation</a><a class="headerlink" href="#v210-documentation" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Added User guide section: Monitoring</p>
</li>
<li><p class="first">Added user guide section: Periodic Tasks</p>
<blockquote>
<div><p>Moved from <cite>getting-started/periodic-tasks</cite> and updated.</p>
</div></blockquote>
</li>
<li><p class="first">tutorials/external moved to new section: “community”.</p>
</li>
<li><p class="first">References has been added to all sections in the documentation.</p>
<blockquote>
<div><p>This makes it easier to link between documents.</p>
</div></blockquote>
</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/celery_512.png" alt="Logo"/>
            </a></p><iframe src="https://ghbtns.com/github-btn.html?user=celery&repo=celery&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>
<div id="donate">
    <b>Please help support this community project with a donation:</b>
    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
    <input type="hidden" name="cmd" value="_s-xclick">
    <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----MIIHTwYJKoZIhvcNAQcEoIIHQDCCBzwCAQExggEwMIIBLAIBADCBlDCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20CAQAwDQYJKoZIhvcNAQEBBQAEgYA2+c723xlntHKQYQR9yn9BEtUhDoUUlnOqhniqvNMWB4k2R0JpVkrNSu5JCbdjNOqDXKHoRfIWe3HXJJMPZBJKFMD5Izprb6xEZlTGaWnlrGXFfkdBaILQQgWYqV0DnuNmtDXCvfYmyu0p1K04wLjAJ1ufnBSP1UaS6BTcoIOOuTELMAkGBSsOAwIaBQAwgcwGCSqGSIb3DQEHATAUBggqhkiG9w0DBwQIFg/2qPwa7UCAgah20QLIllcp0VHazYo2C9h8c6gn8MTcTnpW0WFXhz9ylc/i5dCXabkrrLBBfg8NygAuvYRr4k1zdC0AJIgsV/6rSAhehabRvjRDH2EZ8OieqHfIPfkAcTm+JqbS6Z27lXkebYPnJzhkZxW7+ZC6hU/H40JFXChTag8lhqJfZELiOZLWxxilj2mkwlkdMx1YL6lcPAA7ajpAwjsnJYd/9VxLA6MDmcOu+TKgggOHMIIDgzCCAuygAwIBAgIBADANBgkqhkiG9w0BAQUFADCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20wHhcNMDQwMjEzMTAxMzE1WhcNMzUwMjEzMTAxMzE1WjCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAMFHTt38RMxLXJyO2SmS+Ndl72T7oKJ4u4uw+6awntALWh03PewmIJuzbALScsTS4sZoS1fKciBGoh11gIfHzylvkdNe/hJl66/RGqrj5rFb08sAABNTzDTiqqNpJeBsYs/c2aiGozptX2RlnBktH+SUNpAajW724Nv2Wvhif6sFAgMBAAGjge4wgeswHQYDVR0OBBYEFJaffLvGbxe9WT9S1wob7BDWZJRrMIG7BgNVHSMEgbMwgbCAFJaffLvGbxe9WT9S1wob7BDWZJRroYGUpIGRMIGOMQswCQYDVQQGEwJVUzELMAkGA1UECBMCQ0ExFjAUBgNVBAcTDU1vdW50YWluIFZpZXcxFDASBgNVBAoTC1BheVBhbCBJbmMuMRMwEQYDVQQLFApsaXZlX2NlcnRzMREwDwYDVQQDFAhsaXZlX2FwaTEcMBoGCSqGSIb3DQEJARYNcmVAcGF5cGFsLmNvbYIBADAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBBQUAA4GBAIFfOlaagFrl71+jq6OKidbWFSE+Q4FqROvdgIONth+8kSK//Y/4ihuE4Ymvzn5ceE3S/iBSQQMjyvb+s2TWbQYDwcp129OPIbD9epdr4tJOUNiSojw7BHwYRiPh58S1xGlFgHFXwrEBb3dgNbMUa+u4qectsMAXpVHnD9wIyfmHMYIBmjCCAZYCAQEwgZQwgY4xCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEWMBQGA1UEBxMNTW91bnRhaW4gVmlldzEUMBIGA1UEChMLUGF5UGFsIEluYy4xEzARBgNVBAsUCmxpdmVfY2VydHMxETAPBgNVBAMUCGxpdmVfYXBpMRwwGgYJKoZIhvcNAQkBFg1yZUBwYXlwYWwuY29tAgEAMAkGBSsOAwIaBQCgXTAYBgkqhkiG9w0BCQMxCwYJKoZIhvcNAQcBMBwGCSqGSIb3DQEJBTEPFw0xNTEyMTAxOTEzMzBaMCMGCSqGSIb3DQEJBDEWBBTUno4gI/mmaVaGVpgB/CWwQd3DeDANBgkqhkiG9w0BAQEFAASBgFmZ1j1Ss/FNl/JRIOakhBJEdm2KGLH0d2ewwTYIgIkEKSdc5Rg2/2xFS/dglcs5Te3R2GzaqjGlNSKldsk/MgZP/BudpHAASQ09hrfDy5TaBlRRl1Yu0WzGBKcVm/WRh0v2TVV8vBHVGiJD+aY5epgRXXI/XUKD0bp8tVV1T7LS-----END PKCS7-----
    ">
    <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
    <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
    </form>
</div>
  <h4>Previous topic</h4>
  <p class="topless"><a href="changelog-2.2.html"
                        title="previous chapter">Change history for Celery 2.2</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="changelog-2.0.html"
                        title="next chapter">Change history for Celery 2.0</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/history/changelog-2.1.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="changelog-2.0.html" title="Change history for Celery 2.0"
             >next</a> |</li>
        <li class="right" >
          <a href="changelog-2.2.html" title="Change history for Celery 2.2"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Celery 4.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >History</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../copyright.html">Copyright</a> 2009-2017, Ask Solem &amp; contributors.
    </div>
  </body>
</html>