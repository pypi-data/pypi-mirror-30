
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Message Protocol &#8212; Celery 4.2.0 documentation</title>
    <link rel="stylesheet" href="../_static/celery.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="“The Big Instance” Refactor" href="app-overview.html" />
    <link rel="prev" title="Internals: The worker" href="worker.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="app-overview.html" title="“The Big Instance” Refactor"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="worker.html" title="Internals: The worker"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Celery 4.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Internals</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
<div class="deck">

    
        <p>
        This document describes the current stable version of Celery (4.2).
        For development docs,
        <a href="http://docs.celeryproject.org/en/master/internals/protocol.html">go here</a>.
        </p>
    

</div>
    <div class="section" id="message-protocol">
<span id="id1"></span><h1>Message Protocol<a class="headerlink" href="#message-protocol" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#task-messages" id="id3">Task messages</a><ul>
<li><a class="reference internal" href="#version-2" id="id4">Version 2</a><ul>
<li><a class="reference internal" href="#definition" id="id5">Definition</a></li>
<li><a class="reference internal" href="#example" id="id6">Example</a></li>
<li><a class="reference internal" href="#changes-from-version-1" id="id7">Changes from version 1</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-1" id="id8">Version 1</a><ul>
<li><a class="reference internal" href="#message-body" id="id9">Message body</a></li>
<li><a class="reference internal" href="#example-message" id="id10">Example message</a></li>
</ul>
</li>
<li><a class="reference internal" href="#task-serialization" id="id11">Task Serialization</a></li>
</ul>
</li>
<li><a class="reference internal" href="#event-messages" id="id12">Event Messages</a><ul>
<li><a class="reference internal" href="#standard-body-fields" id="id13">Standard body fields</a></li>
<li><a class="reference internal" href="#standard-event-types" id="id14">Standard event types</a></li>
<li><a class="reference internal" href="#id2" id="id15">Example message</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="task-messages">
<span id="internals-task-message-protocol"></span><span id="message-protocol-task"></span><h2><a class="toc-backref" href="#id3">Task messages</a><a class="headerlink" href="#task-messages" title="Permalink to this headline">¶</a></h2>
<div class="section" id="version-2">
<span id="message-protocol-task-v2"></span><h3><a class="toc-backref" href="#id4">Version 2</a><a class="headerlink" href="#version-2" title="Permalink to this headline">¶</a></h3>
<div class="section" id="definition">
<h4><a class="toc-backref" href="#id5">Definition</a><a class="headerlink" href="#definition" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">properties</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;correlation_id&#39;</span><span class="p">:</span> <span class="n">uuid</span> <span class="n">task_id</span><span class="p">,</span>
    <span class="s1">&#39;content_type&#39;</span><span class="p">:</span> <span class="n">string</span> <span class="n">mimetype</span><span class="p">,</span>
    <span class="s1">&#39;content_encoding&#39;</span><span class="p">:</span> <span class="n">string</span> <span class="n">encoding</span><span class="p">,</span>

    <span class="c1"># optional</span>
    <span class="s1">&#39;reply_to&#39;</span><span class="p">:</span> <span class="n">string</span> <span class="n">queue_or_url</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="n">string</span> <span class="s1">&#39;py&#39;</span>
    <span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="n">string</span> <span class="n">task</span><span class="p">,</span>
    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">uuid</span> <span class="n">task_id</span><span class="p">,</span>
    <span class="s1">&#39;root_id&#39;</span><span class="p">:</span> <span class="n">uuid</span> <span class="n">root_id</span><span class="p">,</span>
    <span class="s1">&#39;parent_id&#39;</span><span class="p">:</span> <span class="n">uuid</span> <span class="n">parent_id</span><span class="p">,</span>
    <span class="s1">&#39;group&#39;</span><span class="p">:</span> <span class="n">uuid</span> <span class="n">group_id</span><span class="p">,</span>

    <span class="c1"># optional</span>
    <span class="s1">&#39;meth&#39;</span><span class="p">:</span> <span class="n">string</span> <span class="n">method_name</span><span class="p">,</span>
    <span class="s1">&#39;shadow&#39;</span><span class="p">:</span> <span class="n">string</span> <span class="n">alias_name</span><span class="p">,</span>
    <span class="s1">&#39;eta&#39;</span><span class="p">:</span> <span class="n">iso8601</span> <span class="n">ETA</span><span class="p">,</span>
    <span class="s1">&#39;expires&#39;</span><span class="p">:</span> <span class="n">iso8601</span> <span class="n">expires</span><span class="p">,</span>
    <span class="s1">&#39;retries&#39;</span><span class="p">:</span> <span class="nb">int</span> <span class="n">retries</span><span class="p">,</span>
    <span class="s1">&#39;timelimit&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">soft</span><span class="p">,</span> <span class="n">hard</span><span class="p">),</span>
    <span class="s1">&#39;argsrepr&#39;</span><span class="p">:</span> <span class="nb">str</span> <span class="nb">repr</span><span class="p">(</span><span class="n">args</span><span class="p">),</span>
    <span class="s1">&#39;kwargsrepr&#39;</span><span class="p">:</span> <span class="nb">str</span> <span class="nb">repr</span><span class="p">(</span><span class="n">kwargs</span><span class="p">),</span>
    <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="nb">str</span> <span class="n">nodename</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">body</span> <span class="o">=</span> <span class="p">(</span>
    <span class="nb">object</span><span class="p">[]</span> <span class="n">args</span><span class="p">,</span>
    <span class="n">Mapping</span> <span class="n">kwargs</span><span class="p">,</span>
    <span class="n">Mapping</span> <span class="n">embed</span> <span class="p">{</span>
        <span class="s1">&#39;callbacks&#39;</span><span class="p">:</span> <span class="n">Signature</span><span class="p">[]</span> <span class="n">callbacks</span><span class="p">,</span>
        <span class="s1">&#39;errbacks&#39;</span><span class="p">:</span> <span class="n">Signature</span><span class="p">[]</span> <span class="n">errbacks</span><span class="p">,</span>
        <span class="s1">&#39;chain&#39;</span><span class="p">:</span> <span class="n">Signature</span><span class="p">[]</span> <span class="n">chain</span><span class="p">,</span>
        <span class="s1">&#39;chord&#39;</span><span class="p">:</span> <span class="n">Signature</span> <span class="n">chord_callback</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="example">
<h4><a class="toc-backref" href="#id6">Example</a><a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<p>This example sends a task message using version 2 of the protocol:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># chain: add(add(add(2, 2), 4), 8) == 2 + 2 + 4 + 8</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">task_id</span> <span class="o">=</span> <span class="n">uuid</span><span class="p">()</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">basic_publish</span><span class="p">(</span>
    <span class="n">message</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">((</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="n">application_headers</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;py&#39;</span><span class="p">,</span>
        <span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="s1">&#39;proj.tasks.add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;argsrepr&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">args</span><span class="p">),</span>
        <span class="s1">&#39;kwargsrepr&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">kwargs</span><span class="p">),</span>
        <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="s1">&#39;@&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()])</span>
    <span class="p">}</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;correlation_id&#39;</span><span class="p">:</span> <span class="n">task_id</span><span class="p">,</span>
        <span class="s1">&#39;content_type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
        <span class="s1">&#39;content_encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="changes-from-version-1">
<h4><a class="toc-backref" href="#id7">Changes from version 1</a><a class="headerlink" href="#changes-from-version-1" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Protocol version detected by the presence of a <code class="docutils literal notranslate"><span class="pre">task</span></code> message header.</p>
</li>
<li><p class="first">Support for multiple languages via the <code class="docutils literal notranslate"><span class="pre">lang</span></code> header.</p>
<blockquote>
<div><p>Worker may redirect the message to a worker that supports
the language.</p>
</div></blockquote>
</li>
<li><p class="first">Meta-data moved to headers.</p>
<blockquote>
<div><p>This means that workers/intermediates can inspect the message
and make decisions based on the headers without decoding
the payload (that may be language specific, for example serialized by the
Python specific pickle serializer).</p>
</div></blockquote>
</li>
<li><p class="first">Always UTC</p>
<blockquote>
<div><p>There’s no <code class="docutils literal notranslate"><span class="pre">utc</span></code> flag anymore, so any time information missing timezone
will be expected to be in UTC time.</p>
</div></blockquote>
</li>
<li><p class="first">Body is only for language specific data.</p>
<blockquote>
<div><ul class="simple">
<li>Python stores args/kwargs and embedded signatures in body.</li>
<li>If a message uses raw encoding then the raw data
will be passed as a single argument to the function.</li>
<li>Java/C, etc. can use a Thrift/protobuf document as the body</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">origin</span></code> is the name of the node sending the task.</p>
</li>
<li><p class="first">Dispatches to actor based on <code class="docutils literal notranslate"><span class="pre">task</span></code>, <code class="docutils literal notranslate"><span class="pre">meth</span></code> headers</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">meth</span></code> is unused by Python, but may be used in the future
to specify class+method pairs.</p>
</div></blockquote>
</li>
<li><p class="first">Chain gains a dedicated field.</p>
<blockquote>
<div><p>Reducing the chain into a recursive <code class="docutils literal notranslate"><span class="pre">callbacks</span></code> argument
causes problems when the recursion limit is exceeded.</p>
<p>This is fixed in the new message protocol by specifying
a list of signatures, each task will then pop a task off the list
when sending the next message:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">execute_task</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="n">chain</span> <span class="o">=</span> <span class="n">embed</span><span class="p">[</span><span class="s1">&#39;chain&#39;</span><span class="p">]</span>
<span class="k">if</span> <span class="n">chain</span><span class="p">:</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">maybe_signature</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
    <span class="n">sig</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">chain</span><span class="o">=</span><span class="n">chain</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">correlation_id</span></code> replaces <code class="docutils literal notranslate"><span class="pre">task_id</span></code> field.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">root_id</span></code> and <code class="docutils literal notranslate"><span class="pre">parent_id</span></code> fields helps keep track of work-flows.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">shadow</span></code> lets you specify a different name for logs, monitors
can be used for concepts like tasks that calls a function
specified as argument:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">celery.utils.imports</span> <span class="kn">import</span> <span class="n">qualname</span>

<span class="k">class</span> <span class="nc">PickleTask</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">unpack_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fun</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">()):</span>
        <span class="k">return</span> <span class="n">fun</span><span class="p">,</span> <span class="n">args</span>

    <span class="k">def</span> <span class="nf">apply_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="n">fun</span><span class="p">,</span> <span class="n">real_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">PickleTask</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span>
            <span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">real_args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">),</span> <span class="n">shadow</span><span class="o">=</span><span class="n">qualname</span><span class="p">(</span><span class="n">fun</span><span class="p">),</span> <span class="o">**</span><span class="n">options</span>
        <span class="p">)</span>

<span class="nd">@app.task</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">PickleTask</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="version-1">
<span id="task-message-protocol-v1"></span><span id="message-protocol-task-v1"></span><h3><a class="toc-backref" href="#id8">Version 1</a><a class="headerlink" href="#version-1" title="Permalink to this headline">¶</a></h3>
<p>In version 1 of the protocol all fields are stored in the message body:
meaning workers and intermediate consumers must deserialize the payload
to read the fields.</p>
<div class="section" id="message-body">
<h4><a class="toc-backref" href="#id9">Message body</a><a class="headerlink" href="#message-body" title="Permalink to this headline">¶</a></h4>
<ul>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">task</span></code></dt>
<dd><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><cite>string</cite>:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<p class="last">Name of the task. <strong>required</strong></p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">id</span></code></dt>
<dd><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><cite>string</cite>:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<p class="last">Unique id of the task (UUID). <strong>required</strong></p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">args</span></code></dt>
<dd><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><cite>list</cite>:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<p class="last">List of arguments. Will be an empty list if not provided.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">kwargs</span></code></dt>
<dd><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><cite>dictionary</cite>:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<p class="last">Dictionary of keyword arguments. Will be an empty dictionary if not
provided.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">retries</span></code></dt>
<dd><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><cite>int</cite>:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<p class="last">Current number of times this task has been retried.
Defaults to <cite>0</cite> if not specified.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">eta</span></code></dt>
<dd><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2"><cite>string</cite> (ISO 8601):</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"></td>
</tr>
</tbody>
</table>
<p class="last">Estimated time of arrival. This is the date and time in ISO 8601
format. If not provided the message isn’t scheduled, but will be
executed asap.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">expires</span></code></dt>
<dd><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2"><cite>string</cite> (ISO 8601):</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.0.2.</span></p>
</div>
<p class="last">Expiration date. This is the date and time in ISO 8601 format.
If not provided the message will never expire. The message
will be expired when the message is received and the expiration date
has been exceeded.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">taskset</span></code></dt>
<dd><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><cite>string</cite>:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<p class="last">The group this task is part of (if any).</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">chord</span></code></dt>
<dd><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><cite>Signature</cite>:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.3.</span></p>
</div>
<p class="last">Signifies that this task is one of the header parts of a chord. The value
of this key is the body of the cord that should be executed when all of
the tasks in the header has returned.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">utc</span></code></dt>
<dd><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><cite>bool</cite>:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.5.</span></p>
</div>
<p class="last">If true time uses the UTC timezone, if not the current local timezone
should be used.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">callbacks</span></code></dt>
<dd><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2"><cite>&lt;list&gt;Signature</cite>:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.0.</span></p>
</div>
<p class="last">A list of signatures to call if the task exited successfully.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">errbacks</span></code></dt>
<dd><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2"><cite>&lt;list&gt;Signature</cite>:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.0.</span></p>
</div>
<p class="last">A list of signatures to call if an error occurs while executing the task.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">timelimit</span></code></dt>
<dd><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2"><cite>&lt;tuple&gt;(float, float)</cite>:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.1.</span></p>
</div>
<p>Task execution time limit settings. This is a tuple of hard and soft time
limit value (<cite>int</cite>/<cite>float</cite> or <code class="xref py py-const docutils literal notranslate"><span class="pre">None</span></code> for no limit).</p>
<p>Example value specifying a soft time limit of 3 seconds, and a hard time
limit of 10 seconds:</p>
<div class="last highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;timelimit&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)}</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="example-message">
<h4><a class="toc-backref" href="#id10">Example message</a><a class="headerlink" href="#example-message" title="Permalink to this headline">¶</a></h4>
<p>This is an example invocation of a <cite>celery.task.ping</cite> task in json
format:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;4cc7438e-afd4-4f8f-a2f3-f46567e7ca77&quot;</span><span class="p">,</span>
 <span class="s2">&quot;task&quot;</span><span class="o">:</span> <span class="s2">&quot;celery.task.PingTask&quot;</span><span class="p">,</span>
 <span class="s2">&quot;args&quot;</span><span class="o">:</span> <span class="p">[],</span>
 <span class="s2">&quot;kwargs&quot;</span><span class="o">:</span> <span class="p">{},</span>
 <span class="s2">&quot;retries&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s2">&quot;eta&quot;</span><span class="o">:</span> <span class="s2">&quot;2009-11-17T12:30:56.527191&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="task-serialization">
<h3><a class="toc-backref" href="#id11">Task Serialization</a><a class="headerlink" href="#task-serialization" title="Permalink to this headline">¶</a></h3>
<p>Several types of serialization formats are supported using the
<cite>content_type</cite> message header.</p>
<p>The MIME-types supported by default are shown in the following table.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Scheme</th>
<th class="head">MIME Type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>json</td>
<td>application/json</td>
</tr>
<tr class="row-odd"><td>yaml</td>
<td>application/x-yaml</td>
</tr>
<tr class="row-even"><td>pickle</td>
<td>application/x-python-serialize</td>
</tr>
<tr class="row-odd"><td>msgpack</td>
<td>application/x-msgpack</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="event-messages">
<span id="message-protocol-event"></span><h2><a class="toc-backref" href="#id12">Event Messages</a><a class="headerlink" href="#event-messages" title="Permalink to this headline">¶</a></h2>
<p>Event messages are always JSON serialized and can contain arbitrary message
body fields.</p>
<p>Since version 4.0. the body can consist of either a single mapping (one event),
or a list of mappings (multiple events).</p>
<p>There are also standard fields that must always be present in an event
message:</p>
<div class="section" id="standard-body-fields">
<h3><a class="toc-backref" href="#id13">Standard body fields</a><a class="headerlink" href="#standard-body-fields" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><em>string</em> <code class="docutils literal notranslate"><span class="pre">type</span></code></p>
<blockquote>
<div><p>The type of event. This is a string containing the <em>category</em> and
<em>action</em> separated by a dash delimiter (e.g., <code class="docutils literal notranslate"><span class="pre">task-succeeded</span></code>).</p>
</div></blockquote>
</li>
<li><p class="first"><em>string</em> <code class="docutils literal notranslate"><span class="pre">hostname</span></code></p>
<blockquote>
<div><p>The fully qualified hostname of where the event occurred at.</p>
</div></blockquote>
</li>
<li><p class="first"><em>unsigned long long</em> <code class="docutils literal notranslate"><span class="pre">clock</span></code></p>
<blockquote>
<div><p>The logical clock value for this event (Lamport time-stamp).</p>
</div></blockquote>
</li>
<li><p class="first"><em>float</em> <code class="docutils literal notranslate"><span class="pre">timestamp</span></code></p>
<blockquote>
<div><p>The UNIX time-stamp corresponding to the time of when the event occurred.</p>
</div></blockquote>
</li>
<li><p class="first"><em>signed short</em> <code class="docutils literal notranslate"><span class="pre">utcoffset</span></code></p>
<blockquote>
<div><p>This field describes the timezone of the originating host, and is
specified as the number of hours ahead of/behind UTC (e.g., -2 or
+1).</p>
</div></blockquote>
</li>
<li><p class="first"><em>unsigned long long</em> <code class="docutils literal notranslate"><span class="pre">pid</span></code></p>
<blockquote>
<div><p>The process id of the process the event originated in.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="standard-event-types">
<h3><a class="toc-backref" href="#id14">Standard event types</a><a class="headerlink" href="#standard-event-types" title="Permalink to this headline">¶</a></h3>
<p>For a list of standard event types and their fields see the
<a class="reference internal" href="../userguide/monitoring.html#event-reference"><span class="std std-ref">Event Reference</span></a>.</p>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id15">Example message</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>This is the message fields for a <code class="docutils literal notranslate"><span class="pre">task-succeeded</span></code> event:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">properties</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;routing_key&#39;</span><span class="p">:</span> <span class="s1">&#39;task.succeeded&#39;</span><span class="p">,</span>
    <span class="s1">&#39;exchange&#39;</span><span class="p">:</span> <span class="s1">&#39;celeryev&#39;</span><span class="p">,</span>
    <span class="s1">&#39;content_type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
    <span class="s1">&#39;content_encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;delivery_mode&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;worker1@george.vandelay.com&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">body</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;task-succeeded&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;worker1@george.vandelay.com&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pid&#39;</span><span class="p">:</span> <span class="mi">6335</span><span class="p">,</span>
    <span class="s1">&#39;clock&#39;</span><span class="p">:</span> <span class="mi">393912923921</span><span class="p">,</span>
    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="mf">1401717709.101747</span><span class="p">,</span>
    <span class="s1">&#39;utcoffset&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;uuid&#39;</span><span class="p">:</span> <span class="s1">&#39;9011d855-fdd1-4f8f-adb3-a413b499eafb&#39;</span><span class="p">,</span>
    <span class="s1">&#39;retval&#39;</span><span class="p">:</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span>
    <span class="s1">&#39;runtime&#39;</span><span class="p">:</span> <span class="mf">0.0003212</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/celery_512.png" alt="Logo"/>
            </a></p><iframe src="https://ghbtns.com/github-btn.html?user=celery&repo=celery&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>
<div id="donate">
    <b>Please help support this community project with a donation:</b>
    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
    <input type="hidden" name="cmd" value="_s-xclick">
    <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
    ">
    <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
    <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
    </form>
</div>
  <h4>Previous topic</h4>
  <p class="topless"><a href="worker.html"
                        title="previous chapter">Internals: The worker</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="app-overview.html"
                        title="next chapter">“The Big Instance” Refactor</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/internals/protocol.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="app-overview.html" title="“The Big Instance” Refactor"
             >next</a> |</li>
        <li class="right" >
          <a href="worker.html" title="Internals: The worker"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Celery 4.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Internals</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../copyright.html">Copyright</a> 2009-2017, Ask Solem &amp; contributors.
    </div>
  </body>
</html>