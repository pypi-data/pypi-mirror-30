
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Using Amazon SQS &#8212; Celery 4.2.0 documentation</title>
    <link rel="stylesheet" href="../../_static/celery.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="First Steps with Celery" href="../first-steps-with-celery.html" />
    <link rel="prev" title="Using Redis" href="redis.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../first-steps-with-celery.html" title="First Steps with Celery"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="redis.html" title="Using Redis"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Celery 4.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Getting Started</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Brokers</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
<div class="deck">

    
        <p>
        This document describes the current stable version of Celery (4.2).
        For development docs,
        <a href="http://docs.celeryproject.org/en/master/getting-started/brokers/sqs.html">go here</a>.
        </p>
    

</div>
    <div class="section" id="using-amazon-sqs">
<span id="broker-sqs"></span><h1>Using Amazon SQS<a class="headerlink" href="#using-amazon-sqs" title="Permalink to this headline">¶</a></h1>
<div class="section" id="installation">
<span id="broker-sqs-installation"></span><h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>For the Amazon SQS support you have to install additional dependencies.
You can install both Celery and these dependencies in one go using
the <code class="docutils literal notranslate"><span class="pre">celery[sqs]</span></code> <a class="reference internal" href="../introduction.html#bundles"><span class="std std-ref">bundle</span></a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> pip install celery<span class="o">[</span>sqs<span class="o">]</span>
</pre></div>
</div>
</div>
<div class="section" id="configuration">
<span id="broker-sqs-configuration"></span><h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>You have to specify SQS in the broker URL:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">broker_url</span> <span class="o">=</span> <span class="s1">&#39;sqs://ABCDEFGHIJKLMNOPQRST:ZYXK7NiynGlTogH8Nj+P9nlE73sq3@&#39;</span>
</pre></div>
</div>
<p>where the URL format is:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sqs://aws_access_key_id:aws_secret_access_key@
</pre></div>
</div>
<p>you must <em>remember to include the “&#64;” at the end</em>.</p>
<p>The login credentials can also be set using the environment variables
<span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">AWS_ACCESS_KEY_ID</span></code> and <span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">AWS_SECRET_ACCESS_KEY</span></code>,
in that case the broker URL may only be <code class="docutils literal notranslate"><span class="pre">sqs://</span></code>.</p>
<p>If you are using IAM roles on instances, you can set the BROKER_URL to:
<code class="docutils literal notranslate"><span class="pre">sqs://</span></code> and kombu will attempt to retrieve access tokens from the instance
metadata.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you specify AWS credentials in the broker URL, then please keep in mind
that the secret access key may contain unsafe characters that need to be
URL encoded.</p>
</div>
</div>
<div class="section" id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<div class="section" id="region">
<h3>Region<a class="headerlink" href="#region" title="Permalink to this headline">¶</a></h3>
<p>The default region is <code class="docutils literal notranslate"><span class="pre">us-east-1</span></code> but you can select another region
by configuring the <a class="reference internal" href="../../userguide/configuration.html#std:setting-broker_transport_options"><code class="xref std std-setting docutils literal notranslate"><span class="pre">broker_transport_options</span></code></a> setting:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">broker_transport_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;region&#39;</span><span class="p">:</span> <span class="s1">&#39;eu-west-1&#39;</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p>An overview of Amazon Web Services regions can be found here:</p>
<blockquote class="last">
<div><a class="reference external" href="http://aws.amazon.com/about-aws/globalinfrastructure/">http://aws.amazon.com/about-aws/globalinfrastructure/</a></div></blockquote>
</div>
</div>
<div class="section" id="visibility-timeout">
<h3>Visibility Timeout<a class="headerlink" href="#visibility-timeout" title="Permalink to this headline">¶</a></h3>
<p>The visibility timeout defines the number of seconds to wait
for the worker to acknowledge the task before the message is redelivered
to another worker. Also see caveats below.</p>
<p>This option is set via the <a class="reference internal" href="../../userguide/configuration.html#std:setting-broker_transport_options"><code class="xref std std-setting docutils literal notranslate"><span class="pre">broker_transport_options</span></code></a> setting:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">broker_transport_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;visibility_timeout&#39;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">}</span>  <span class="c1"># 1 hour.</span>
</pre></div>
</div>
<p>The default visibility timeout is 30 minutes.</p>
</div>
<div class="section" id="polling-interval">
<h3>Polling Interval<a class="headerlink" href="#polling-interval" title="Permalink to this headline">¶</a></h3>
<p>The polling interval decides the number of seconds to sleep between
unsuccessful polls. This value can be either an int or a float.
By default the value is <em>one second</em>: this means the worker will
sleep for one second when there’s no more messages to read.</p>
<p>You must note that <strong>more frequent polling is also more expensive, so increasing
the polling interval can save you money</strong>.</p>
<p>The polling interval can be set via the <a class="reference internal" href="../../userguide/configuration.html#std:setting-broker_transport_options"><code class="xref std std-setting docutils literal notranslate"><span class="pre">broker_transport_options</span></code></a>
setting:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">broker_transport_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;polling_interval&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">}</span>
</pre></div>
</div>
<p>Very frequent polling intervals can cause <em>busy loops</em>, resulting in the
worker using a lot of CPU time. If you need sub-millisecond precision you
should consider using another transport, like <cite>RabbitMQ &lt;broker-amqp&gt;</cite>,
or <cite>Redis &lt;broker-redis&gt;</cite>.</p>
</div>
<div class="section" id="queue-prefix">
<h3>Queue Prefix<a class="headerlink" href="#queue-prefix" title="Permalink to this headline">¶</a></h3>
<p>By default Celery won’t assign any prefix to the queue names,
If you have other services using SQS you can configure it do so
using the <a class="reference internal" href="../../userguide/configuration.html#std:setting-broker_transport_options"><code class="xref std std-setting docutils literal notranslate"><span class="pre">broker_transport_options</span></code></a> setting:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">broker_transport_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;queue_name_prefix&#39;</span><span class="p">:</span> <span class="s1">&#39;celery-&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="caveats">
<span id="sqs-caveats"></span><h2>Caveats<a class="headerlink" href="#caveats" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">If a task isn’t acknowledged within the <code class="docutils literal notranslate"><span class="pre">visibility_timeout</span></code>,
the task will be redelivered to another worker and executed.</p>
<blockquote>
<div><p>This causes problems with ETA/countdown/retry tasks where the
time to execute exceeds the visibility timeout; in fact if that
happens it will be executed again, and again in a loop.</p>
<p>So you have to increase the visibility timeout to match
the time of the longest ETA you’re planning to use.</p>
<p>Note that Celery will redeliver messages at worker shutdown,
so having a long visibility timeout will only delay the redelivery
of ‘lost’ tasks in the event of a power failure or forcefully terminated
workers.</p>
<p>Periodic tasks won’t be affected by the visibility timeout,
as it is a concept separate from ETA/countdown.</p>
<p>The maximum visibility timeout supported by AWS as of this writing
is 12 hours (43200 seconds):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">broker_transport_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;visibility_timeout&#39;</span><span class="p">:</span> <span class="mi">43200</span><span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">SQS doesn’t yet support worker remote control commands.</p>
</li>
<li><p class="first">SQS doesn’t yet support events, and so cannot be used with
<strong class="program">celery events</strong>, <strong class="program">celerymon</strong>, or the Django Admin
monitor.</p>
</li>
</ul>
<div class="section" id="results">
<span id="sqs-results-configuration"></span><h3>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h3>
<p>Multiple products in the Amazon Web Services family could be a good candidate
to store or publish results with, but there’s no such result backend included
at this point.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Don’t use the <code class="docutils literal notranslate"><span class="pre">amqp</span></code> result backend with SQS.</p>
<p class="last">It will create one queue for every task, and the queues will
not be collected. This could cost you money that would be better
spent contributing an AWS result store backend back to Celery :)</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/celery_512.png" alt="Logo"/>
            </a></p><iframe src="https://ghbtns.com/github-btn.html?user=celery&repo=celery&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>
<div id="donate">
    <b>Please help support this community project with a donation:</b>
    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
    <input type="hidden" name="cmd" value="_s-xclick">
    <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
    ">
    <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
    <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
    </form>
</div>
  <h4>Previous topic</h4>
  <p class="topless"><a href="redis.html"
                        title="previous chapter">Using Redis</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../first-steps-with-celery.html"
                        title="next chapter">First Steps with Celery</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/getting-started/brokers/sqs.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../first-steps-with-celery.html" title="First Steps with Celery"
             >next</a> |</li>
        <li class="right" >
          <a href="redis.html" title="Using Redis"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Celery 4.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Getting Started</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Brokers</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../../copyright.html">Copyright</a> 2009-2017, Ask Solem &amp; contributors.
    </div>
  </body>
</html>