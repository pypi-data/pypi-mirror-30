
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>First Steps with Celery &#8212; Celery 4.2.0 documentation</title>
    <link rel="stylesheet" href="../_static/celery.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="Next Steps" href="next-steps.html" />
    <link rel="prev" title="Using Amazon SQS" href="brokers/sqs.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="next-steps.html" title="Next Steps"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="brokers/sqs.html" title="Using Amazon SQS"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Celery 4.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Getting Started</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
<div class="deck">

    
        <p>
        This document describes the current stable version of Celery (4.2).
        For development docs,
        <a href="http://docs.celeryproject.org/en/master/getting-started/first-steps-with-celery.html">go here</a>.
        </p>
    

</div>
    <div class="section" id="first-steps-with-celery">
<span id="first-steps"></span><span id="tut-celery"></span><h1>First Steps with Celery<a class="headerlink" href="#first-steps-with-celery" title="Permalink to this headline">¶</a></h1>
<p>Celery is a task queue with batteries included.
It’s easy to use so that you can get started without learning
the full complexities of the problem it solves. It’s designed
around best practices so that your product can scale
and integrate with other languages, and it comes with the
tools and support you need to run such a system in production.</p>
<p>In this tutorial you’ll learn the absolute basics of using Celery.</p>
<p>Learn about;</p>
<ul class="simple">
<li>Choosing and installing a message transport (broker).</li>
<li>Installing Celery and creating your first task.</li>
<li>Starting the worker and calling tasks.</li>
<li>Keeping track of tasks as they transition through different states,
and inspecting return values.</li>
</ul>
<p>Celery may seem daunting at first - but don’t worry - this tutorial
will get you started in no time. It’s deliberately kept simple, so
as to not confuse you with advanced features.
After you have finished this tutorial,
it’s a good idea to browse the rest of the documentation.
For example the <a class="reference internal" href="next-steps.html#next-steps"><span class="std std-ref">Next Steps</span></a> tutorial will
showcase Celery’s capabilities.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#choosing-a-broker" id="id3">Choosing a Broker</a><ul>
<li><a class="reference internal" href="#rabbitmq" id="id4">RabbitMQ</a></li>
<li><a class="reference internal" href="#redis" id="id5">Redis</a></li>
<li><a class="reference internal" href="#other-brokers" id="id6">Other brokers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installing-celery" id="id7">Installing Celery</a></li>
<li><a class="reference internal" href="#application" id="id8">Application</a></li>
<li><a class="reference internal" href="#running-the-celery-worker-server" id="id9">Running the Celery worker server</a></li>
<li><a class="reference internal" href="#calling-the-task" id="id10">Calling the task</a></li>
<li><a class="reference internal" href="#keeping-results" id="id11">Keeping Results</a></li>
<li><a class="reference internal" href="#configuration" id="id12">Configuration</a></li>
<li><a class="reference internal" href="#where-to-go-from-here" id="id13">Where to go from here</a></li>
<li><a class="reference internal" href="#troubleshooting" id="id14">Troubleshooting</a><ul>
<li><a class="reference internal" href="#worker-doesn-t-start-permission-error" id="id15">Worker doesn’t start: Permission Error</a></li>
<li><a class="reference internal" href="#result-backend-doesn-t-work-or-tasks-are-always-in-pending-state" id="id16">Result backend doesn’t work or tasks are always in <code class="docutils literal notranslate"><span class="pre">PENDING</span></code> state</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="choosing-a-broker">
<span id="celerytut-broker"></span><h2><a class="toc-backref" href="#id3">Choosing a Broker</a><a class="headerlink" href="#choosing-a-broker" title="Permalink to this headline">¶</a></h2>
<p>Celery requires a solution to send and receive messages; usually this
comes in the form of a separate service called a <em>message broker</em>.</p>
<p>There are several choices available, including:</p>
<div class="section" id="rabbitmq">
<h3><a class="toc-backref" href="#id4">RabbitMQ</a><a class="headerlink" href="#rabbitmq" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.rabbitmq.com/">RabbitMQ</a> is feature-complete, stable, durable and easy to install.
It’s an excellent choice for a production environment.
Detailed information about using RabbitMQ with Celery:</p>
<blockquote>
<div><a class="reference internal" href="brokers/rabbitmq.html#broker-rabbitmq"><span class="std std-ref">Using RabbitMQ</span></a></div></blockquote>
<p>If you’re using Ubuntu or Debian install RabbitMQ by executing this
command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo apt-get install rabbitmq-server
</pre></div>
</div>
<p>When the command completes, the broker will already be running in the background,
ready to move messages for you: <code class="docutils literal notranslate"><span class="pre">Starting</span> <span class="pre">rabbitmq-server:</span> <span class="pre">SUCCESS</span></code>.</p>
<p>Don’t worry if you’re not running Ubuntu or Debian, you can go to this
website to find similarly simple installation instructions for other
platforms, including Microsoft Windows:</p>
<blockquote>
<div><a class="reference external" href="http://www.rabbitmq.com/download.html">http://www.rabbitmq.com/download.html</a></div></blockquote>
</div>
<div class="section" id="redis">
<h3><a class="toc-backref" href="#id5">Redis</a><a class="headerlink" href="#redis" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://redis.io/">Redis</a> is also feature-complete, but is more susceptible to data loss in
the event of abrupt termination or power failures. Detailed information about using Redis:</p>
<p><a class="reference internal" href="brokers/redis.html#broker-redis"><span class="std std-ref">Using Redis</span></a></p>
</div>
<div class="section" id="other-brokers">
<h3><a class="toc-backref" href="#id6">Other brokers</a><a class="headerlink" href="#other-brokers" title="Permalink to this headline">¶</a></h3>
<p>In addition to the above, there are other experimental transport implementations
to choose from, including <a class="reference internal" href="brokers/sqs.html#broker-sqs"><span class="std std-ref">Amazon SQS</span></a>.</p>
<p>See <a class="reference internal" href="brokers/index.html#broker-overview"><span class="std std-ref">Broker Overview</span></a> for a full list.</p>
</div>
</div>
<div class="section" id="installing-celery">
<span id="celerytut-installation"></span><h2><a class="toc-backref" href="#id7">Installing Celery</a><a class="headerlink" href="#installing-celery" title="Permalink to this headline">¶</a></h2>
<p>Celery is on the Python Package Index (PyPI), so it can be installed
with standard Python tools like <code class="docutils literal notranslate"><span class="pre">pip</span></code> or <code class="docutils literal notranslate"><span class="pre">easy_install</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> pip install celery
</pre></div>
</div>
</div>
<div class="section" id="application">
<h2><a class="toc-backref" href="#id8">Application</a><a class="headerlink" href="#application" title="Permalink to this headline">¶</a></h2>
<p>The first thing you need is a Celery instance.  We call this the <em>Celery
application</em> or just <em>app</em> for short. As this instance is used as
the entry-point for everything you want to do in Celery, like creating tasks and
managing workers, it must be possible for other modules to import it.</p>
<p>In this tutorial we keep everything contained in a single module,
but for larger projects you want to create
a <a class="reference internal" href="next-steps.html#project-layout"><span class="std std-ref">dedicated module</span></a>.</p>
<p>Let’s create the file <code class="file docutils literal notranslate"><span class="pre">tasks.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">Celery</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="s1">&#39;tasks&#39;</span><span class="p">,</span> <span class="n">broker</span><span class="o">=</span><span class="s1">&#39;pyamqp://guest@localhost//&#39;</span><span class="p">)</span>

<span class="nd">@app.task</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
<p>The first argument to <code class="xref py py-class docutils literal notranslate"><span class="pre">Celery</span></code> is the name of the current module.
This is only needed so that names can be automatically generated when the tasks are
defined in the <cite>__main__</cite> module.</p>
<p>The second argument is the broker keyword argument, specifying the URL of the
message broker you want to use. Here using RabbitMQ (also the default option).</p>
<p>See <a class="reference internal" href="#celerytut-broker"><span class="std std-ref">Choosing a Broker</span></a> above for more choices –
for RabbitMQ you can use <code class="docutils literal notranslate"><span class="pre">amqp://localhost</span></code>, or for Redis you can
use <code class="docutils literal notranslate"><span class="pre">redis://localhost</span></code>.</p>
<p>You defined a single task, called <code class="docutils literal notranslate"><span class="pre">add</span></code>, returning the sum of two numbers.</p>
</div>
<div class="section" id="running-the-celery-worker-server">
<span id="celerytut-running-the-worker"></span><h2><a class="toc-backref" href="#id9">Running the Celery worker server</a><a class="headerlink" href="#running-the-celery-worker-server" title="Permalink to this headline">¶</a></h2>
<p>You can now run the worker by executing our program with the <code class="docutils literal notranslate"><span class="pre">worker</span></code>
argument:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A tasks worker --loglevel<span class="o">=</span>info
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">See the <a class="reference internal" href="#celerytut-troubleshooting"><span class="std std-ref">Troubleshooting</span></a> section if the worker
doesn’t start.</p>
</div>
<p>In production you’ll want to run the worker in the
background as a daemon. To do this you need to use the tools provided
by your platform, or something like <a class="reference external" href="http://supervisord.org">supervisord</a> (see <a class="reference internal" href="../userguide/daemonizing.html#daemonizing"><span class="std std-ref">Daemonization</span></a>
for more information).</p>
<p>For a complete listing of the command-line options available, do:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>  celery worker --help
</pre></div>
</div>
<p>There are also several other commands available, and help is also available:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery <span class="nb">help</span>
</pre></div>
</div>
</div>
<div class="section" id="calling-the-task">
<span id="celerytut-calling"></span><h2><a class="toc-backref" href="#id10">Calling the task</a><a class="headerlink" href="#calling-the-task" title="Permalink to this headline">¶</a></h2>
<p>To call our task you can use the <a class="reference internal" href="../reference/celery.app.task.html#celery.app.task.Task.delay" title="celery.app.task.Task.delay"><code class="xref py py-meth docutils literal notranslate"><span class="pre">delay()</span></code></a> method.</p>
<p>This is a handy shortcut to the <a class="reference internal" href="../reference/celery.app.task.html#celery.app.task.Task.apply_async" title="celery.app.task.Task.apply_async"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply_async()</span></code></a>
method that gives greater control of the task execution (see
<a class="reference internal" href="../userguide/calling.html#guide-calling"><span class="std std-ref">Calling Tasks</span></a>):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">tasks</span> <span class="k">import</span> <span class="n">add</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">add</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>The task has now been processed by the worker you started earlier.
You can verify this by looking at the worker’s console output.</p>
<p>Calling a task returns an <a class="reference internal" href="../reference/celery.result.html#celery.result.AsyncResult" title="celery.result.AsyncResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncResult</span></code></a> instance.
This can be used to check the state of the task, wait for the task to finish,
or get its return value (or if the task failed, to get the exception and traceback).</p>
<p>Results are not enabled by default. In order to do remote procedure calls
or keep track of task results in a database, you will need to configure Celery to use a result
backend.  This is described in the next section.</p>
</div>
<div class="section" id="keeping-results">
<span id="celerytut-keeping-results"></span><h2><a class="toc-backref" href="#id11">Keeping Results</a><a class="headerlink" href="#keeping-results" title="Permalink to this headline">¶</a></h2>
<p>If you want to keep track of the tasks’ states, Celery needs to store or send
the states somewhere. There are several
built-in result backends to choose from: <a class="reference external" href="http://www.sqlalchemy.org/">SQLAlchemy</a>/<a class="reference external" href="http://djangoproject.com">Django</a> ORM,
<a class="reference external" href="http://memcached.org">Memcached</a>, <a class="reference external" href="https://redis.io/">Redis</a>, <a class="reference internal" href="../userguide/configuration.html#conf-rpc-result-backend"><span class="std std-ref">RPC</span></a> (<a class="reference external" href="http://www.rabbitmq.com/">RabbitMQ</a>/AMQP),
and – or you can define your own.</p>
<p>For this example we use the <cite>rpc</cite> result backend, that sends states
back as transient messages. The backend is specified via the <code class="docutils literal notranslate"><span class="pre">backend</span></code> argument to
<a class="reference internal" href="../reference/celery.html#celery.Celery" title="celery.Celery"><code class="xref py py-class docutils literal notranslate"><span class="pre">Celery</span></code></a>, (or via the <a class="reference internal" href="../userguide/configuration.html#std:setting-result_backend"><code class="xref std std-setting docutils literal notranslate"><span class="pre">result_backend</span></code></a> setting if
you choose to use a configuration module):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="s1">&#39;tasks&#39;</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s1">&#39;rpc://&#39;</span><span class="p">,</span> <span class="n">broker</span><span class="o">=</span><span class="s1">&#39;pyamqp://&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Or if you want to use Redis as the result backend, but still use RabbitMQ as
the message broker (a popular combination):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="s1">&#39;tasks&#39;</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s1">&#39;redis://localhost&#39;</span><span class="p">,</span> <span class="n">broker</span><span class="o">=</span><span class="s1">&#39;pyamqp://&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To read more about result backends please see <a class="reference internal" href="../userguide/tasks.html#task-result-backends"><span class="std std-ref">Result Backends</span></a>.</p>
<p>Now with the result backend configured, let’s call the task again.
This time you’ll hold on to the <a class="reference internal" href="../reference/celery.result.html#celery.result.AsyncResult" title="celery.result.AsyncResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncResult</span></code></a> instance returned
when you call a task:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">add</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../reference/celery.result.html#celery.result.AsyncResult.ready" title="celery.result.AsyncResult.ready"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ready()</span></code></a> method returns whether the task
has finished processing or not:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">ready</span><span class="p">()</span>
<span class="go">False</span>
</pre></div>
</div>
<p>You can wait for the result to complete, but this is rarely used
since it turns the asynchronous call into a synchronous one:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">8</span>
</pre></div>
</div>
<p>In case the task raised an exception, <a class="reference internal" href="../reference/celery.result.html#celery.result.AsyncResult.get" title="celery.result.AsyncResult.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a> will
re-raise the exception, but you can override this by specifying
the <code class="docutils literal notranslate"><span class="pre">propagate</span></code> argument:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">propagate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>If the task raised an exception, you can also gain access to the
original traceback:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">traceback</span>
<span class="go">?</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../reference/celery.result.html#module-celery.result" title="celery.result"><code class="xref py py-mod docutils literal notranslate"><span class="pre">celery.result</span></code></a> for the complete result object reference.</p>
</div>
<div class="section" id="configuration">
<span id="celerytut-configuration"></span><h2><a class="toc-backref" href="#id12">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>Celery, like a consumer appliance, doesn’t need much configuration to operate.
It has an input and an output. The input must be connected to a broker, and the output can
be optionally connected to a result backend. However, if you look closely at the back,
there’s a lid revealing loads of sliders, dials, and buttons: this is the configuration.</p>
<p>The default configuration should be good enough for most use cases, but there are
many options that can be configured to make Celery work exactly as needed.
Reading about the options available is a good idea to familiarize yourself with what
can be configured. You can read about the options in the
<a class="reference internal" href="../userguide/configuration.html#configuration"><span class="std std-ref">Configuration and defaults</span></a> reference.</p>
<p>The configuration can be set on the app directly or by using a dedicated
configuration module.
As an example you can configure the default serializer used for serializing
task payloads by changing the <a class="reference internal" href="../userguide/configuration.html#std:setting-task_serializer"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_serializer</span></code></a> setting:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">task_serializer</span> <span class="o">=</span> <span class="s1">&#39;json&#39;</span>
</pre></div>
</div>
<p>If you’re configuring many settings at once you can use <code class="docutils literal notranslate"><span class="pre">update</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
    <span class="n">task_serializer</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">,</span>
    <span class="n">accept_content</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">],</span>  <span class="c1"># Ignore other content</span>
    <span class="n">result_serializer</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">,</span>
    <span class="n">timezone</span><span class="o">=</span><span class="s1">&#39;Europe/Oslo&#39;</span><span class="p">,</span>
    <span class="n">enable_utc</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>For larger projects, a dedicated configuration module is recommended.
Hard coding periodic task intervals and task routing options is discouraged.
It is much better to keep these in a centralized location. This is especially
true for libraries, as it enables users to control how their tasks behave.
A centralized configuration will also allow your SysAdmin to make simple changes
in the event of system trouble.</p>
<p>You can tell your Celery instance to use a configuration module
by calling the <a class="reference internal" href="../reference/celery.html#celery.Celery.config_from_object" title="celery.Celery.config_from_object"><code class="xref py py-meth docutils literal notranslate"><span class="pre">app.config_from_object()</span></code></a> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">config_from_object</span><span class="p">(</span><span class="s1">&#39;celeryconfig&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This module is often called “<code class="docutils literal notranslate"><span class="pre">celeryconfig</span></code>”, but you can use any
module name.</p>
<p>In the above case, a module named <code class="docutils literal notranslate"><span class="pre">celeryconfig.py</span></code> must be available to load from the
current directory or on the Python path. It could look something like this:</p>
<p><code class="file docutils literal notranslate"><span class="pre">celeryconfig.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">broker_url</span> <span class="o">=</span> <span class="s1">&#39;pyamqp://&#39;</span>
<span class="n">result_backend</span> <span class="o">=</span> <span class="s1">&#39;rpc://&#39;</span>

<span class="n">task_serializer</span> <span class="o">=</span> <span class="s1">&#39;json&#39;</span>
<span class="n">result_serializer</span> <span class="o">=</span> <span class="s1">&#39;json&#39;</span>
<span class="n">accept_content</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">]</span>
<span class="n">timezone</span> <span class="o">=</span> <span class="s1">&#39;Europe/Oslo&#39;</span>
<span class="n">enable_utc</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<p>To verify that your configuration file works properly and doesn’t
contain any syntax errors, you can try to import it:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python -m celeryconfig
</pre></div>
</div>
<p>For a complete reference of configuration options, see <a class="reference internal" href="../userguide/configuration.html#configuration"><span class="std std-ref">Configuration and defaults</span></a>.</p>
<p>To demonstrate the power of configuration files, this is how you’d
route a misbehaving task to a dedicated queue:</p>
<p><code class="file docutils literal notranslate"><span class="pre">celeryconfig.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">task_routes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;tasks.add&#39;</span><span class="p">:</span> <span class="s1">&#39;low-priority&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Or instead of routing it you could rate limit the task
instead, so that only 10 tasks of this type can be processed in a minute
(10/m):</p>
<p><code class="file docutils literal notranslate"><span class="pre">celeryconfig.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">task_annotations</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;tasks.add&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;rate_limit&#39;</span><span class="p">:</span> <span class="s1">&#39;10/m&#39;</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you’re using RabbitMQ or Redis as the
broker then you can also direct the workers to set a new rate limit
for the task at runtime:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> celery -A tasks control rate_limit tasks.add <span class="m">10</span>/m
<span class="go">worker@example.com: OK</span>
<span class="go">    new rate limit set successfully</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../userguide/routing.html#guide-routing"><span class="std std-ref">Routing Tasks</span></a> to read more about task routing,
and the <a class="reference internal" href="../userguide/configuration.html#std:setting-task_annotations"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_annotations</span></code></a> setting for more about annotations,
or <a class="reference internal" href="../userguide/monitoring.html#guide-monitoring"><span class="std std-ref">Monitoring and Management Guide</span></a> for more about remote control commands
and how to monitor what your workers are doing.</p>
</div>
<div class="section" id="where-to-go-from-here">
<h2><a class="toc-backref" href="#id13">Where to go from here</a><a class="headerlink" href="#where-to-go-from-here" title="Permalink to this headline">¶</a></h2>
<p>If you want to learn more you should continue to the
<a class="reference internal" href="next-steps.html#next-steps"><span class="std std-ref">Next Steps</span></a> tutorial, and after that you
can read the <a class="reference internal" href="../userguide/index.html#guide"><span class="std std-ref">User Guide</span></a>.</p>
</div>
<div class="section" id="troubleshooting">
<span id="celerytut-troubleshooting"></span><h2><a class="toc-backref" href="#id14">Troubleshooting</a><a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<p>There’s also a troubleshooting section in the <a class="reference internal" href="../faq.html#faq"><span class="std std-ref">Frequently Asked Questions</span></a>.</p>
<div class="section" id="worker-doesn-t-start-permission-error">
<h3><a class="toc-backref" href="#id15">Worker doesn’t start: Permission Error</a><a class="headerlink" href="#worker-doesn-t-start-permission-error" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">If you’re using Debian, Ubuntu or other Debian-based distributions:</p>
<blockquote>
<div><p>Debian recently renamed the <code class="file docutils literal notranslate"><span class="pre">/dev/shm</span></code> special file
to <code class="file docutils literal notranslate"><span class="pre">/run/shm</span></code>.</p>
<p>A simple workaround is to create a symbolic link:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> ln -s /run/shm /dev/shm
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Others:</p>
<blockquote>
<div><p>If you provide any of the <a class="reference internal" href="../reference/celery.bin.worker.html#cmdoption-celery-worker-pidfile"><code class="xref std std-option docutils literal notranslate"><span class="pre">--pidfile</span></code></a>,
<a class="reference internal" href="../reference/celery.bin.worker.html#cmdoption-celery-worker-f"><code class="xref std std-option docutils literal notranslate"><span class="pre">--logfile</span></code></a> or
<a class="reference internal" href="../reference/celery.bin.worker.html#cmdoption-celery-worker-statedb"><code class="xref std std-option docutils literal notranslate"><span class="pre">--statedb</span></code></a> arguments, then you must
make sure that they point to a file or directory that’s writable and
readable by the user starting the worker.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="result-backend-doesn-t-work-or-tasks-are-always-in-pending-state">
<h3><a class="toc-backref" href="#id16">Result backend doesn’t work or tasks are always in <code class="docutils literal notranslate"><span class="pre">PENDING</span></code> state</a><a class="headerlink" href="#result-backend-doesn-t-work-or-tasks-are-always-in-pending-state" title="Permalink to this headline">¶</a></h3>
<p>All tasks are <a class="reference internal" href="../userguide/tasks.html#std:state-PENDING"><code class="xref std std-state docutils literal notranslate"><span class="pre">PENDING</span></code></a> by default, so the state would’ve been
better named “unknown”. Celery doesn’t update the state when a task
is sent, and any task with no history is assumed to be pending (you know
the task id, after all).</p>
<ol class="arabic">
<li><p class="first">Make sure that the task doesn’t have <code class="docutils literal notranslate"><span class="pre">ignore_result</span></code> enabled.</p>
<blockquote>
<div><p>Enabling this option will force the worker to skip updating
states.</p>
</div></blockquote>
</li>
<li><p class="first">Make sure the <a class="reference internal" href="../userguide/configuration.html#std:setting-task_ignore_result"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_ignore_result</span></code></a> setting isn’t enabled.</p>
</li>
<li><p class="first">Make sure that you don’t have any old workers still running.</p>
<blockquote>
<div><p>It’s easy to start multiple workers by accident, so make sure
that the previous worker is properly shut down before you start a new one.</p>
<p>An old worker that isn’t configured with the expected result backend
may be running and is hijacking the tasks.</p>
<p>The <a class="reference internal" href="../reference/celery.bin.worker.html#cmdoption-celery-worker-pidfile"><code class="xref std std-option docutils literal notranslate"><span class="pre">--pidfile</span></code></a> argument can be set to
an absolute path to make sure this doesn’t happen.</p>
</div></blockquote>
</li>
<li><p class="first">Make sure the client is configured with the right backend.</p>
<blockquote>
<div><p>If, for some reason, the client is configured to use a different backend
than the worker, you won’t be able to receive the result.
Make sure the backend is configured correctly:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">delay</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">backend</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/celery_512.png" alt="Logo"/>
            </a></p><iframe src="https://ghbtns.com/github-btn.html?user=celery&repo=celery&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>
<div id="donate">
    <b>Please help support this community project with a donation:</b>
    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
    <input type="hidden" name="cmd" value="_s-xclick">
    <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
    ">
    <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
    <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
    </form>
</div>
  <h4>Previous topic</h4>
  <p class="topless"><a href="brokers/sqs.html"
                        title="previous chapter">Using Amazon SQS</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="next-steps.html"
                        title="next chapter">Next Steps</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/getting-started/first-steps-with-celery.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="next-steps.html" title="Next Steps"
             >next</a> |</li>
        <li class="right" >
          <a href="brokers/sqs.html" title="Using Amazon SQS"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Celery 4.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Getting Started</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../copyright.html">Copyright</a> 2009-2017, Ask Solem &amp; contributors.
    </div>
  </body>
</html>