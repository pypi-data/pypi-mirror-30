
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>SearchIndex API &#8212; Haystack 2.5.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.5.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Input Types" href="inputtypes.html" />
    <link rel="prev" title="SearchQuerySet API" href="searchqueryset_api.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="searchindex-api">
<span id="ref-searchindex-api"></span><h1><code class="docutils literal"><span class="pre">SearchIndex</span></code> API<a class="headerlink" href="#searchindex-api" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="SearchIndex">
<em class="property">class </em><code class="descname">SearchIndex</code><a class="headerlink" href="#SearchIndex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <code class="docutils literal"><span class="pre">SearchIndex</span></code> class allows the application developer a way to provide data to
the backend in a structured format. Developers familiar with Django’s <code class="docutils literal"><span class="pre">Form</span></code>
or <code class="docutils literal"><span class="pre">Model</span></code> classes should find the syntax for indexes familiar.</p>
<p>This class is arguably the most important part of integrating Haystack into your
application, as it has a large impact on the quality of the search results and
how easy it is for users to find what they’re looking for. Care and effort
should be put into making your indexes the best they can be.</p>
<div class="section" id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h2>
<p>For the impatient:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">haystack</span> <span class="k">import</span> <span class="n">indexes</span>
<span class="kn">from</span> <span class="nn">myapp.models</span> <span class="k">import</span> <span class="n">Note</span>


<span class="k">class</span> <span class="nc">NoteIndex</span><span class="p">(</span><span class="n">indexes</span><span class="o">.</span><span class="n">SearchIndex</span><span class="p">,</span> <span class="n">indexes</span><span class="o">.</span><span class="n">Indexable</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">indexes</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">document</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_template</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">indexes</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">model_attr</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">)</span>
    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">indexes</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">model_attr</span><span class="o">=</span><span class="s1">&#39;pub_date&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Note</span>

    <span class="k">def</span> <span class="nf">index_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">using</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="s2">&quot;Used when the entire index for model is updated.&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model</span><span class="p">()</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__lte</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>Unlike relational databases, most search engines supported by Haystack are
primarily document-based. They focus on a single text blob which they tokenize,
analyze and index. When searching, this field is usually the primary one that
is searched.</p>
<p>Further, the schema used by most engines is the same for all types of data
added, unlike a relational database that has a table schema for each chunk of
data.</p>
<p>It may be helpful to think of your search index as something closer to a
key-value store instead of imagining it in terms of a RDBMS.</p>
<div class="section" id="why-create-fields">
<h3>Why Create Fields?<a class="headerlink" href="#why-create-fields" title="Permalink to this headline">¶</a></h3>
<p>Despite being primarily document-driven, most search engines also support the
ability to associate other relevant data with the indexed document. These
attributes can be mapped through the use of fields within Haystack.</p>
<p>Common uses include storing pertinent data information, categorizations of the
document, author information and related data. By adding fields for these pieces
of data, you provide a means to further narrow/filter search terms. This can
be useful from either a UI perspective (a better advanced search form) or from a
developer standpoint (section-dependent search, off-loading certain tasks to
search, et cetera).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Haystack reserves the following field names for internal use: <code class="docutils literal"><span class="pre">id</span></code>,
<code class="docutils literal"><span class="pre">django_ct</span></code>, <code class="docutils literal"><span class="pre">django_id</span></code> &amp; <code class="docutils literal"><span class="pre">content</span></code>. The <code class="docutils literal"><span class="pre">name</span></code> &amp; <code class="docutils literal"><span class="pre">type</span></code> names
used to be reserved but no longer are.</p>
<p class="last">You can override these field names using the <code class="docutils literal"><span class="pre">HAYSTACK_ID_FIELD</span></code>,
<code class="docutils literal"><span class="pre">HAYSTACK_DJANGO_CT_FIELD</span></code> &amp; <code class="docutils literal"><span class="pre">HAYSTACK_DJANGO_ID_FIELD</span></code> if needed.</p>
</div>
</div>
<div class="section" id="significance-of-document-true">
<h3>Significance Of <code class="docutils literal"><span class="pre">document=True</span></code><a class="headerlink" href="#significance-of-document-true" title="Permalink to this headline">¶</a></h3>
<p>Most search engines that were candidates for inclusion in Haystack all had a
central concept of a document that they indexed. These documents form a corpus
within which to primarily search. Because this ideal is so central and most of
Haystack is designed to have pluggable backends, it is important to ensure that
all engines have at least a bare minimum of the data they need to function.</p>
<p>As a result, when creating a <code class="docutils literal"><span class="pre">SearchIndex</span></code>, one (and only one) field must be
marked with <code class="docutils literal"><span class="pre">document=True</span></code>. This signifies to Haystack that whatever is
placed in this field while indexing is to be the primary text the search engine
indexes. The name of this field can be almost anything, but <code class="docutils literal"><span class="pre">text</span></code> is one of
the more common names used.</p>
</div>
<div class="section" id="stored-indexed-fields">
<h3>Stored/Indexed Fields<a class="headerlink" href="#stored-indexed-fields" title="Permalink to this headline">¶</a></h3>
<p>One shortcoming of the use of search is that you rarely have all or the most
up-to-date information about an object in the index. As a result, when
retrieving search results, you will likely have to access the object in the
database to provide better information.</p>
<p>However, this can also hit the database quite heavily (think
<code class="docutils literal"><span class="pre">.get(pk=result.id)</span></code> per object). If your search is popular, this can lead
to a big performance hit. There are two ways to prevent this. The first way is
<code class="docutils literal"><span class="pre">SearchQuerySet.load_all</span></code>, which tries to group all similar objects and pull
them through one query instead of many. This still hits the DB and incurs a
performance penalty.</p>
<p>The other option is to leverage stored fields. By default, all fields in
Haystack are either indexed (searchable by the engine) or stored (retained by
the engine and presented in the results). By using a stored field, you can
store commonly used data in such a way that you don’t need to hit the database
when processing the search result to get more information.</p>
<p>For example, one great way to leverage this is to pre-render an object’s
search result template DURING indexing. You define an additional field, render
a template with it and it follows the main indexed record into the index. Then,
when that record is pulled when it matches a query, you can simply display the
contents of that field, which avoids the database hit.:</p>
<p>Within <code class="docutils literal"><span class="pre">myapp/search_indexes.py</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NoteIndex</span><span class="p">(</span><span class="n">SearchIndex</span><span class="p">,</span> <span class="n">indexes</span><span class="o">.</span><span class="n">Indexable</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">document</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_template</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">model_attr</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">)</span>
    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">(</span><span class="n">model_attr</span><span class="o">=</span><span class="s1">&#39;pub_date&#39;</span><span class="p">)</span>
    <span class="c1"># Define the additional field.</span>
    <span class="n">rendered</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">use_template</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indexed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, inside a template named <code class="docutils literal"><span class="pre">search/indexes/myapp/note_rendered.txt</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">h2</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nb">object</span><span class="o">.</span><span class="n">title</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">h2</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nb">object</span><span class="o">.</span><span class="n">content</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>And finally, in <code class="docutils literal"><span class="pre">search/search.html</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">...</span>

<span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">object_list</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;search_result&quot;</span><span class="o">&gt;</span>
        <span class="p">{{</span> <span class="n">result</span><span class="o">.</span><span class="n">rendered</span><span class="o">|</span><span class="n">safe</span> <span class="p">}}</span>
    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="keeping-the-index-fresh">
<h2>Keeping The Index Fresh<a class="headerlink" href="#keeping-the-index-fresh" title="Permalink to this headline">¶</a></h2>
<p>There are several approaches to keeping the search index in sync with your
database. None are more correct than the others and which one you use depends
on the traffic you see, the churn rate of your data, and what concerns are
important to you (CPU load, how recent, et cetera).</p>
<p>The conventional method is to use <code class="docutils literal"><span class="pre">SearchIndex</span></code> in combination with cron
jobs. Running a <code class="docutils literal"><span class="pre">./manage.py</span> <span class="pre">update_index</span></code> every couple hours will keep your
data in sync within that timeframe and will handle the updates in a very
efficient batch. Additionally, Whoosh (and to a lesser extent Xapian) behaves
better when using this approach.</p>
<p>Another option is to use <code class="docutils literal"><span class="pre">RealtimeSignalProcessor</span></code>, which uses Django’s
signals to immediately update the index any time a model is saved/deleted. This
yields a much more current search index at the expense of being fairly
inefficient. Solr &amp; Elasticsearch are the only backends that handles this well
under load, and even then, you should make sure you have the server capacity
to spare.</p>
<p>A third option is to develop a custom <code class="docutils literal"><span class="pre">QueuedSignalProcessor</span></code> that, much like
<code class="docutils literal"><span class="pre">RealtimeSignalProcessor</span></code>, uses Django’s signals to enqueue messages for
updates/deletes. Then writing a management command to consume these messages
in batches, yielding a nice compromise between the previous two options.</p>
<p>For more information see <a class="reference internal" href="signal_processors.html"><span class="doc">Signal Processors</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Haystack doesn’t ship with a <code class="docutils literal"><span class="pre">QueuedSignalProcessor</span></code> largely because there is
such a diversity of lightweight queuing options and that they tend to
polarize developers. Queuing is outside of Haystack’s goals (provide good,
powerful search) and, as such, is left to the developer.</p>
<p class="last">Additionally, the implementation is relatively trivial &amp; there are already
good third-party add-ons for Haystack to enable this.</p>
</div>
</div>
<div class="section" id="advanced-data-preparation">
<h2>Advanced Data Preparation<a class="headerlink" href="#advanced-data-preparation" title="Permalink to this headline">¶</a></h2>
<p>In most cases, using the <cite>model_attr</cite> parameter on your fields allows you to
easily get data from a Django model to the document in your index, as it handles
both direct attribute access as well as callable functions within your model.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">model_attr</span></code> keyword argument also can look through relations in
models. So you can do something like <code class="docutils literal"><span class="pre">model_attr='author__first_name'</span></code>
to pull just the first name of the author, similar to some lookups used
by Django’s ORM.</p>
</div>
<p>However, sometimes, even more control over what gets placed in your index is
needed. To facilitate this, <code class="docutils literal"><span class="pre">SearchIndex</span></code> objects have a ‘preparation’ stage
that populates data just before it is indexed. You can hook into this phase in
several ways.</p>
<p>This should be very familiar to developers who have used Django’s <code class="docutils literal"><span class="pre">forms</span></code>
before as it loosely follows similar concepts, though the emphasis here is
less on cleansing data from user input and more on making the data friendly
to the search backend.</p>
<div class="section" id="prepare-foo-self-object">
<h3>1. <code class="docutils literal"><span class="pre">prepare_FOO(self,</span> <span class="pre">object)</span></code><a class="headerlink" href="#prepare-foo-self-object" title="Permalink to this headline">¶</a></h3>
<p>The most common way to affect a single field’s data is to create a
<code class="docutils literal"><span class="pre">prepare_FOO</span></code> method (where FOO is the name of the field). As a parameter
to this method, you will receive the instance that is attempting to be indexed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This method is analogous to Django’s <code class="docutils literal"><span class="pre">Form.clean_FOO</span></code> methods.</p>
</div>
<p>To keep with our existing example, one use case might be altering the name
inside the <code class="docutils literal"><span class="pre">author</span></code> field to be “firstname lastname &lt;email&gt;”. In this case,
you might write the following code:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NoteIndex</span><span class="p">(</span><span class="n">SearchIndex</span><span class="p">,</span> <span class="n">indexes</span><span class="o">.</span><span class="n">Indexable</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">document</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_template</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">model_attr</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">)</span>
    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">(</span><span class="n">model_attr</span><span class="o">=</span><span class="s1">&#39;pub_date&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Note</span>

    <span class="k">def</span> <span class="nf">prepare_author</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> &lt;</span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">get_full_name</span><span class="p">(),</span> <span class="n">obj</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
</pre></div>
</div>
<p>This method should return a single value (or list/tuple/dict) to populate that
field’s data upon indexing. Note that this method takes priority over whatever
data may come from the field itself.</p>
<p>Just like <code class="docutils literal"><span class="pre">Form.clean_FOO</span></code>, the field’s <code class="docutils literal"><span class="pre">prepare</span></code> runs before the
<code class="docutils literal"><span class="pre">prepare_FOO</span></code>, allowing you to access <code class="docutils literal"><span class="pre">self.prepared_data</span></code>. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NoteIndex</span><span class="p">(</span><span class="n">SearchIndex</span><span class="p">,</span> <span class="n">indexes</span><span class="o">.</span><span class="n">Indexable</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">document</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_template</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">model_attr</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">)</span>
    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">(</span><span class="n">model_attr</span><span class="o">=</span><span class="s1">&#39;pub_date&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Note</span>

    <span class="k">def</span> <span class="nf">prepare_author</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="c1"># Say we want last name first, the hard way.</span>
        <span class="n">author</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="s1">&#39;author&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_data</span><span class="p">:</span>
            <span class="n">name_bits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_data</span><span class="p">[</span><span class="s1">&#39;author&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">author</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name_bits</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name_bits</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">author</span>
</pre></div>
</div>
<p>This method is fully function with <code class="docutils literal"><span class="pre">model_attr</span></code>, so if there’s no convenient
way to access the data you want, this is an excellent way to prepare it:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NoteIndex</span><span class="p">(</span><span class="n">SearchIndex</span><span class="p">,</span> <span class="n">indexes</span><span class="o">.</span><span class="n">Indexable</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">document</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_template</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">model_attr</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">)</span>
    <span class="n">categories</span> <span class="o">=</span> <span class="n">MultiValueField</span><span class="p">()</span>
    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">(</span><span class="n">model_attr</span><span class="o">=</span><span class="s1">&#39;pub_date&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Note</span>

    <span class="k">def</span> <span class="nf">prepare_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="c1"># Since we&#39;re using a M2M relationship with a complex lookup,</span>
        <span class="c1"># we can prepare the list here.</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">category</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">category_set</span><span class="o">.</span><span class="n">active</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-created&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="section" id="prepare-self-object">
<h3>2. <code class="docutils literal"><span class="pre">prepare(self,</span> <span class="pre">object)</span></code><a class="headerlink" href="#prepare-self-object" title="Permalink to this headline">¶</a></h3>
<p>Each <code class="docutils literal"><span class="pre">SearchIndex</span></code> gets a <code class="docutils literal"><span class="pre">prepare</span></code> method, which handles collecting all
the data. This method should return a dictionary that will be the final data
used by the search backend.</p>
<p>Overriding this method is useful if you need to collect more than one piece
of data or need to incorporate additional data that is not well represented
by a single <code class="docutils literal"><span class="pre">SearchField</span></code>. An example might look like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NoteIndex</span><span class="p">(</span><span class="n">SearchIndex</span><span class="p">,</span> <span class="n">indexes</span><span class="o">.</span><span class="n">Indexable</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">document</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_template</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">model_attr</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">)</span>
    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">(</span><span class="n">model_attr</span><span class="o">=</span><span class="s1">&#39;pub_date&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Note</span>

    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepared_data</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">NoteIndex</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>

        <span class="c1"># Add in tags (assuming there&#39;s a M2M relationship to Tag on the model).</span>
        <span class="c1"># Note that this would NOT get picked up by the automatic</span>
        <span class="c1"># schema tools provided by Haystack.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepared_data</span><span class="p">[</span><span class="s1">&#39;tags&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">object</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_data</span>
</pre></div>
</div>
<p>If you choose to use this method, you should make a point to be careful to call
the <code class="docutils literal"><span class="pre">super()</span></code> method before altering the data. Without doing so, you may have
an incomplete set of data populating your indexes.</p>
<p>This method has the final say in all data, overriding both what the fields
provide as well as any <code class="docutils literal"><span class="pre">prepare_FOO</span></code> methods on the class.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This method is roughly analogous to Django’s <code class="docutils literal"><span class="pre">Form.full_clean</span></code> and
<code class="docutils literal"><span class="pre">Form.clean</span></code> methods. However, unlike these methods, it is not fired
as the result of trying to access <code class="docutils literal"><span class="pre">self.prepared_data</span></code>. It requires
an explicit call.</p>
</div>
</div>
<div class="section" id="overriding-prepare-self-object-on-individual-searchfield-objects">
<h3>3. Overriding <code class="docutils literal"><span class="pre">prepare(self,</span> <span class="pre">object)</span></code> On Individual <code class="docutils literal"><span class="pre">SearchField</span></code> Objects<a class="headerlink" href="#overriding-prepare-self-object-on-individual-searchfield-objects" title="Permalink to this headline">¶</a></h3>
<p>The final way to manipulate your data is to implement a custom <code class="docutils literal"><span class="pre">SearchField</span></code>
object and write its <code class="docutils literal"><span class="pre">prepare</span></code> method to populate/alter the data any way you
choose. For instance, a (naive) user-created <code class="docutils literal"><span class="pre">GeoPointField</span></code> might look
something like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils</span> <span class="k">import</span> <span class="n">six</span>
<span class="kn">from</span> <span class="nn">haystack</span> <span class="k">import</span> <span class="n">indexes</span>

<span class="k">class</span> <span class="nc">GeoPointField</span><span class="p">(</span><span class="n">indexes</span><span class="o">.</span><span class="n">CharField</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0.00-0.00&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GeoPointField</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">longitude</span><span class="p">))</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">prepare</span></code> method simply returns the value to be used for that field. It’s
entirely possible to include data that’s not directly referenced to the object
here, depending on your needs.</p>
<p>Note that this is NOT a recommended approach to storing geographic data in a
search engine (there is no formal suggestion on this as support is usually
non-existent), merely an example of how to extend existing fields.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This method is analagous to Django’s <code class="docutils literal"><span class="pre">Field.clean</span></code> methods.</p>
</div>
</div>
</div>
<div class="section" id="adding-new-fields">
<h2>Adding New Fields<a class="headerlink" href="#adding-new-fields" title="Permalink to this headline">¶</a></h2>
<p>If you have an existing <code class="docutils literal"><span class="pre">SearchIndex</span></code> and you add a new field to it, Haystack
will add this new data on any updates it sees after that point. However, this
will not populate the existing data you already have.</p>
<p>In order for the data to be picked up, you will need to run <code class="docutils literal"><span class="pre">./manage.py</span>
<span class="pre">rebuild_index</span></code>. This will cause all backends to rebuild the existing data
already present in the quickest and most efficient way.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">With the Solr backend, you’ll also have to add to the appropriate
<code class="docutils literal"><span class="pre">schema.xml</span></code> for your configuration before running the <code class="docutils literal"><span class="pre">rebuild_index</span></code>.</p>
</div>
</div>
<div class="section" id="search-index">
<h2><code class="docutils literal"><span class="pre">Search</span> <span class="pre">Index</span></code><a class="headerlink" href="#search-index" title="Permalink to this headline">¶</a></h2>
<div class="section" id="get-model">
<h3><code class="docutils literal"><span class="pre">get_model</span></code><a class="headerlink" href="#get-model" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="SearchIndex.get_model">
<code class="descclassname">SearchIndex.</code><code class="descname">get_model</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span><a class="headerlink" href="#SearchIndex.get_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Should return the <code class="docutils literal"><span class="pre">Model</span></code> class (not an instance) that the rest of the
<code class="docutils literal"><span class="pre">SearchIndex</span></code> should use.</p>
<p>This method is required &amp; you must override it to return the correct class.</p>
</div>
<div class="section" id="index-queryset">
<h3><code class="docutils literal"><span class="pre">index_queryset</span></code><a class="headerlink" href="#index-queryset" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="SearchIndex.index_queryset">
<code class="descclassname">SearchIndex.</code><code class="descname">index_queryset</code><span class="sig-paren">(</span><em>self</em>, <em>using=None</em><span class="sig-paren">)</span><a class="headerlink" href="#SearchIndex.index_queryset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Get the default QuerySet to index when doing a full update.</p>
<p>Subclasses can override this method to avoid indexing certain objects.</p>
</div>
<div class="section" id="read-queryset">
<h3><code class="docutils literal"><span class="pre">read_queryset</span></code><a class="headerlink" href="#read-queryset" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="SearchIndex.read_queryset">
<code class="descclassname">SearchIndex.</code><code class="descname">read_queryset</code><span class="sig-paren">(</span><em>self</em>, <em>using=None</em><span class="sig-paren">)</span><a class="headerlink" href="#SearchIndex.read_queryset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Get the default QuerySet for read actions.</p>
<p>Subclasses can override this method to work with other managers.
Useful when working with default managers that filter some objects.</p>
</div>
<div class="section" id="build-queryset">
<h3><code class="docutils literal"><span class="pre">build_queryset</span></code><a class="headerlink" href="#build-queryset" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="SearchIndex.build_queryset">
<code class="descclassname">SearchIndex.</code><code class="descname">build_queryset</code><span class="sig-paren">(</span><em>self</em>, <em>start_date=None</em>, <em>end_date=None</em><span class="sig-paren">)</span><a class="headerlink" href="#SearchIndex.build_queryset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Get the default QuerySet to index when doing an index update.</p>
<p>Subclasses can override this method to take into account related
model modification times.</p>
<p>The default is to use <code class="docutils literal"><span class="pre">SearchIndex.index_queryset</span></code> and filter
based on <code class="docutils literal"><span class="pre">SearchIndex.get_updated_field</span></code></p>
</div>
<div class="section" id="prepare">
<h3><code class="docutils literal"><span class="pre">prepare</span></code><a class="headerlink" href="#prepare" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="SearchIndex.prepare">
<code class="descclassname">SearchIndex.</code><code class="descname">prepare</code><span class="sig-paren">(</span><em>self</em>, <em>obj</em><span class="sig-paren">)</span><a class="headerlink" href="#SearchIndex.prepare" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Fetches and adds/alters data before indexing.</p>
</div>
<div class="section" id="get-content-field">
<h3><code class="docutils literal"><span class="pre">get_content_field</span></code><a class="headerlink" href="#get-content-field" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="SearchIndex.get_content_field">
<code class="descclassname">SearchIndex.</code><code class="descname">get_content_field</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span><a class="headerlink" href="#SearchIndex.get_content_field" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Returns the field that supplies the primary document to be indexed.</p>
</div>
<div class="section" id="update">
<h3><code class="docutils literal"><span class="pre">update</span></code><a class="headerlink" href="#update" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="SearchIndex.update">
<code class="descclassname">SearchIndex.</code><code class="descname">update</code><span class="sig-paren">(</span><em>self</em>, <em>using=None</em><span class="sig-paren">)</span><a class="headerlink" href="#SearchIndex.update" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Updates the entire index.</p>
<p>If <code class="docutils literal"><span class="pre">using</span></code> is provided, it specifies which connection should be
used. Default relies on the routers to decide which backend should
be used.</p>
</div>
<div class="section" id="update-object">
<h3><code class="docutils literal"><span class="pre">update_object</span></code><a class="headerlink" href="#update-object" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="SearchIndex.update_object">
<code class="descclassname">SearchIndex.</code><code class="descname">update_object</code><span class="sig-paren">(</span><em>self</em>, <em>instance</em>, <em>using=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#SearchIndex.update_object" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Update the index for a single object. Attached to the class’s
post-save hook.</p>
<p>If <code class="docutils literal"><span class="pre">using</span></code> is provided, it specifies which connection should be
used. Default relies on the routers to decide which backend should
be used.</p>
</div>
<div class="section" id="remove-object">
<h3><code class="docutils literal"><span class="pre">remove_object</span></code><a class="headerlink" href="#remove-object" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="SearchIndex.remove_object">
<code class="descclassname">SearchIndex.</code><code class="descname">remove_object</code><span class="sig-paren">(</span><em>self</em>, <em>instance</em>, <em>using=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#SearchIndex.remove_object" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Remove an object from the index. Attached to the class’s
post-delete hook.</p>
<p>If <code class="docutils literal"><span class="pre">using</span></code> is provided, it specifies which connection should be
used. Default relies on the routers to decide which backend should
be used.</p>
</div>
<div class="section" id="clear">
<h3><code class="docutils literal"><span class="pre">clear</span></code><a class="headerlink" href="#clear" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="SearchIndex.clear">
<code class="descclassname">SearchIndex.</code><code class="descname">clear</code><span class="sig-paren">(</span><em>self</em>, <em>using=None</em><span class="sig-paren">)</span><a class="headerlink" href="#SearchIndex.clear" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Clears the entire index.</p>
<p>If <code class="docutils literal"><span class="pre">using</span></code> is provided, it specifies which connection should be
used. Default relies on the routers to decide which backend should
be used.</p>
</div>
<div class="section" id="reindex">
<h3><code class="docutils literal"><span class="pre">reindex</span></code><a class="headerlink" href="#reindex" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="SearchIndex.reindex">
<code class="descclassname">SearchIndex.</code><code class="descname">reindex</code><span class="sig-paren">(</span><em>self</em>, <em>using=None</em><span class="sig-paren">)</span><a class="headerlink" href="#SearchIndex.reindex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Completely clears the index for this model and rebuilds it.</p>
<p>If <code class="docutils literal"><span class="pre">using</span></code> is provided, it specifies which connection should be
used. Default relies on the routers to decide which backend should
be used.</p>
</div>
<div class="section" id="get-updated-field">
<h3><code class="docutils literal"><span class="pre">get_updated_field</span></code><a class="headerlink" href="#get-updated-field" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="SearchIndex.get_updated_field">
<code class="descclassname">SearchIndex.</code><code class="descname">get_updated_field</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span><a class="headerlink" href="#SearchIndex.get_updated_field" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Get the field name that represents the updated date for the model.</p>
<p>If specified, this is used by the reindex command to filter out results
from the <code class="docutils literal"><span class="pre">QuerySet</span></code>, enabling you to reindex only recent records. This
method should either return None (reindex everything always) or a
string of the <code class="docutils literal"><span class="pre">Model</span></code>’s <code class="docutils literal"><span class="pre">DateField</span></code>/<code class="docutils literal"><span class="pre">DateTimeField</span></code> name.</p>
</div>
<div class="section" id="should-update">
<h3><code class="docutils literal"><span class="pre">should_update</span></code><a class="headerlink" href="#should-update" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="SearchIndex.should_update">
<code class="descclassname">SearchIndex.</code><code class="descname">should_update</code><span class="sig-paren">(</span><em>self</em>, <em>instance</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#SearchIndex.should_update" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Determine if an object should be updated in the index.</p>
<p>It’s useful to override this when an object may save frequently and
cause excessive reindexing. You should check conditions on the instance
and return False if it is not to be indexed.</p>
<p>The <code class="docutils literal"><span class="pre">kwargs</span></code> passed along to this method can be the same as the ones passed
by Django when a Model is saved/delete, so it’s possible to check if the object
has been created or not. See <code class="docutils literal"><span class="pre">django.db.models.signals.post_save</span></code> for details
on what is passed.</p>
<p>By default, returns True (always reindex).</p>
</div>
<div class="section" id="load-all-queryset">
<h3><code class="docutils literal"><span class="pre">load_all_queryset</span></code><a class="headerlink" href="#load-all-queryset" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="SearchIndex.load_all_queryset">
<code class="descclassname">SearchIndex.</code><code class="descname">load_all_queryset</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span><a class="headerlink" href="#SearchIndex.load_all_queryset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Provides the ability to override how objects get loaded in conjunction
with <code class="docutils literal"><span class="pre">RelatedSearchQuerySet.load_all</span></code>. This is useful for post-processing the
results from the query, enabling things like adding <code class="docutils literal"><span class="pre">select_related</span></code> or
filtering certain data.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Utilizing this functionality can have negative performance implications.
Please see the section on <code class="docutils literal"><span class="pre">RelatedSearchQuerySet</span></code> within
<a class="reference internal" href="searchqueryset_api.html"><span class="doc">SearchQuerySet API</span></a> for further information.</p>
</div>
<p>By default, returns <code class="docutils literal"><span class="pre">all()</span></code> on the model’s default manager.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NoteIndex</span><span class="p">(</span><span class="n">SearchIndex</span><span class="p">,</span> <span class="n">indexes</span><span class="o">.</span><span class="n">Indexable</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">document</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_template</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">model_attr</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">)</span>
    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">(</span><span class="n">model_attr</span><span class="o">=</span><span class="s1">&#39;pub_date&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Note</span>

    <span class="k">def</span> <span class="nf">load_all_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Pull all objects related to the Note in search results.</span>
        <span class="k">return</span> <span class="n">Note</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">select_related</span><span class="p">()</span>
</pre></div>
</div>
<p>When searching, the <code class="docutils literal"><span class="pre">RelatedSearchQuerySet</span></code> appends on a call to <code class="docutils literal"><span class="pre">in_bulk</span></code>, so be
sure that the <code class="docutils literal"><span class="pre">QuerySet</span></code> you provide can accommodate this and that the ids
passed to <code class="docutils literal"><span class="pre">in_bulk</span></code> will map to the model in question.</p>
<p>If you need a specific <code class="docutils literal"><span class="pre">QuerySet</span></code> in one place, you can specify this at the
<code class="docutils literal"><span class="pre">RelatedSearchQuerySet</span></code> level using the <code class="docutils literal"><span class="pre">load_all_queryset</span></code> method. See
<a class="reference internal" href="searchqueryset_api.html"><span class="doc">SearchQuerySet API</span></a> for usage.</p>
</div>
</div>
<div class="section" id="modelsearchindex">
<h2><code class="docutils literal"><span class="pre">ModelSearchIndex</span></code><a class="headerlink" href="#modelsearchindex" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">ModelSearchIndex</span></code> class allows for automatic generation of a
<code class="docutils literal"><span class="pre">SearchIndex</span></code> based on the fields of the model assigned to it.</p>
<p>With the exception of the automated introspection, it is a <code class="docutils literal"><span class="pre">SearchIndex</span></code>
class, so all notes above pertaining to <code class="docutils literal"><span class="pre">SearchIndexes</span></code> apply. As with the
<code class="docutils literal"><span class="pre">ModelForm</span></code> class in Django, it employs an inner class called <code class="docutils literal"><span class="pre">Meta</span></code>, which
should contain a <code class="docutils literal"><span class="pre">model</span></code> attribute. By default all non-relational model
fields are included as search fields on the index, but fields can be restricted
by way of a <code class="docutils literal"><span class="pre">fields</span></code> whitelist, or excluded with an <code class="docutils literal"><span class="pre">excludes</span></code> list, to
prevent certain fields from appearing in the class.</p>
<p>In addition, it adds a <cite>text</cite> field that is the <code class="docutils literal"><span class="pre">document=True</span></code> field and
has <cite>use_template=True</cite> option set, just like the <code class="docutils literal"><span class="pre">BasicSearchIndex</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Usage of this class might result in inferior <code class="docutils literal"><span class="pre">SearchIndex</span></code> objects, which
can directly affect your search results. Use this to establish basic
functionality and move to custom <cite>SearchIndex</cite> objects for better control.</p>
</div>
<p>At this time, it does not handle related fields.</p>
<div class="section" id="id1">
<h3>Quick Start<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>For the impatient:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">haystack</span> <span class="k">import</span> <span class="n">indexes</span>
<span class="kn">from</span> <span class="nn">myapp.models</span> <span class="k">import</span> <span class="n">Note</span>

<span class="c1"># All Fields</span>
<span class="k">class</span> <span class="nc">AllNoteIndex</span><span class="p">(</span><span class="n">indexes</span><span class="o">.</span><span class="n">ModelSearchIndex</span><span class="p">,</span> <span class="n">indexes</span><span class="o">.</span><span class="n">Indexable</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Note</span>

<span class="c1"># Blacklisted Fields</span>
<span class="k">class</span> <span class="nc">LimitedNoteIndex</span><span class="p">(</span><span class="n">indexes</span><span class="o">.</span><span class="n">ModelSearchIndex</span><span class="p">,</span> <span class="n">indexes</span><span class="o">.</span><span class="n">Indexable</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Note</span>
        <span class="n">excludes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span>

<span class="c1"># Whitelisted Fields</span>
<span class="k">class</span> <span class="nc">NoteIndex</span><span class="p">(</span><span class="n">indexes</span><span class="o">.</span><span class="n">ModelSearchIndex</span><span class="p">,</span> <span class="n">indexes</span><span class="o">.</span><span class="n">Indexable</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Note</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;pub_date&#39;</span><span class="p">]</span>

    <span class="c1"># Note that regular ``SearchIndex`` methods apply.</span>
    <span class="k">def</span> <span class="nf">index_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">using</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="s2">&quot;Used when the entire index for model is updated.&quot;</span>
        <span class="k">return</span> <span class="n">Note</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__lte</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="toc.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#"><code class="docutils literal"><span class="pre">SearchIndex</span></code> API</a><ul>
<li><a class="reference internal" href="#quick-start">Quick Start</a></li>
<li><a class="reference internal" href="#background">Background</a><ul>
<li><a class="reference internal" href="#why-create-fields">Why Create Fields?</a></li>
<li><a class="reference internal" href="#significance-of-document-true">Significance Of <code class="docutils literal"><span class="pre">document=True</span></code></a></li>
<li><a class="reference internal" href="#stored-indexed-fields">Stored/Indexed Fields</a></li>
</ul>
</li>
<li><a class="reference internal" href="#keeping-the-index-fresh">Keeping The Index Fresh</a></li>
<li><a class="reference internal" href="#advanced-data-preparation">Advanced Data Preparation</a><ul>
<li><a class="reference internal" href="#prepare-foo-self-object">1. <code class="docutils literal"><span class="pre">prepare_FOO(self,</span> <span class="pre">object)</span></code></a></li>
<li><a class="reference internal" href="#prepare-self-object">2. <code class="docutils literal"><span class="pre">prepare(self,</span> <span class="pre">object)</span></code></a></li>
<li><a class="reference internal" href="#overriding-prepare-self-object-on-individual-searchfield-objects">3. Overriding <code class="docutils literal"><span class="pre">prepare(self,</span> <span class="pre">object)</span></code> On Individual <code class="docutils literal"><span class="pre">SearchField</span></code> Objects</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-new-fields">Adding New Fields</a></li>
<li><a class="reference internal" href="#search-index"><code class="docutils literal"><span class="pre">Search</span> <span class="pre">Index</span></code></a><ul>
<li><a class="reference internal" href="#get-model"><code class="docutils literal"><span class="pre">get_model</span></code></a></li>
<li><a class="reference internal" href="#index-queryset"><code class="docutils literal"><span class="pre">index_queryset</span></code></a></li>
<li><a class="reference internal" href="#read-queryset"><code class="docutils literal"><span class="pre">read_queryset</span></code></a></li>
<li><a class="reference internal" href="#build-queryset"><code class="docutils literal"><span class="pre">build_queryset</span></code></a></li>
<li><a class="reference internal" href="#prepare"><code class="docutils literal"><span class="pre">prepare</span></code></a></li>
<li><a class="reference internal" href="#get-content-field"><code class="docutils literal"><span class="pre">get_content_field</span></code></a></li>
<li><a class="reference internal" href="#update"><code class="docutils literal"><span class="pre">update</span></code></a></li>
<li><a class="reference internal" href="#update-object"><code class="docutils literal"><span class="pre">update_object</span></code></a></li>
<li><a class="reference internal" href="#remove-object"><code class="docutils literal"><span class="pre">remove_object</span></code></a></li>
<li><a class="reference internal" href="#clear"><code class="docutils literal"><span class="pre">clear</span></code></a></li>
<li><a class="reference internal" href="#reindex"><code class="docutils literal"><span class="pre">reindex</span></code></a></li>
<li><a class="reference internal" href="#get-updated-field"><code class="docutils literal"><span class="pre">get_updated_field</span></code></a></li>
<li><a class="reference internal" href="#should-update"><code class="docutils literal"><span class="pre">should_update</span></code></a></li>
<li><a class="reference internal" href="#load-all-queryset"><code class="docutils literal"><span class="pre">load_all_queryset</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#modelsearchindex"><code class="docutils literal"><span class="pre">ModelSearchIndex</span></code></a><ul>
<li><a class="reference internal" href="#id1">Quick Start</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="toc.html">Documentation overview</a><ul>
  <li><a href="index.html">Welcome to Haystack!</a><ul>
      <li>Previous: <a href="searchqueryset_api.html" title="previous chapter"><code class="docutils literal"><span class="pre">SearchQuerySet</span></code> API</a></li>
      <li>Next: <a href="inputtypes.html" title="next chapter">Input Types</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/searchindex_api.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2009-2016, Daniel Lindsley.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/searchindex_api.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>