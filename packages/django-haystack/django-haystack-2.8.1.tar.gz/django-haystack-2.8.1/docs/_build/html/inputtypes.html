
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Input Types &#8212; Haystack 2.5.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.5.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="SearchField API" href="searchfield_api.html" />
    <link rel="prev" title="SearchIndex API" href="searchindex_api.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="input-types">
<span id="ref-inputtypes"></span><h1>Input Types<a class="headerlink" href="#input-types" title="Permalink to this headline">¶</a></h1>
<p>Input types allow you to specify more advanced query behavior. They serve as a
way to alter the query, often in backend-specific ways, without altering your
Python code; as well as enabling use of more advanced features.</p>
<p>Input types currently are only useful with the <code class="docutils literal"><span class="pre">filter/exclude</span></code> methods on
<code class="docutils literal"><span class="pre">SearchQuerySet</span></code>. Expanding this support to other methods is on the roadmap.</p>
<div class="section" id="available-input-types">
<h2>Available Input Types<a class="headerlink" href="#available-input-types" title="Permalink to this headline">¶</a></h2>
<p>Included with Haystack are the following input types:</p>
<div class="section" id="raw">
<h3><code class="docutils literal"><span class="pre">Raw</span></code><a class="headerlink" href="#raw" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="haystack.inputs.Raw">
<em class="property">class </em><code class="descclassname">haystack.inputs.</code><code class="descname">Raw</code><a class="headerlink" href="#haystack.inputs.Raw" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Raw allows you to specify backend-specific query syntax. If Haystack doesn’t
provide a way to access special query functionality, you can make use of this
input type to pass it along.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Fielded.</span>
<span class="n">sqs</span> <span class="o">=</span> <span class="n">SearchQuerySet</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">author</span><span class="o">=</span><span class="n">Raw</span><span class="p">(</span><span class="s1">&#39;daniel OR jones&#39;</span><span class="p">))</span>

<span class="c1"># Non-fielded.</span>
<span class="c1"># See ``AltParser`` for a better way to construct this.</span>
<span class="n">sqs</span> <span class="o">=</span> <span class="n">SearchQuerySet</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">Raw</span><span class="p">(</span><span class="s1">&#39;{!dismax qf=author mm=1}haystack&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="clean">
<h3><code class="docutils literal"><span class="pre">Clean</span></code><a class="headerlink" href="#clean" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="haystack.inputs.Clean">
<em class="property">class </em><code class="descclassname">haystack.inputs.</code><code class="descname">Clean</code><a class="headerlink" href="#haystack.inputs.Clean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="docutils literal"><span class="pre">Clean</span></code> takes standard user (untrusted) input and sanitizes it. It ensures
that no unintended operators or special characters make it into the query.</p>
<p>This is roughly analogous to Django’s <code class="docutils literal"><span class="pre">autoescape</span></code> support.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, if you hand a <code class="docutils literal"><span class="pre">SearchQuerySet</span></code> a bare string, it will get
wrapped in this class.</p>
</div>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># This becomes &quot;daniel or jones&quot;.</span>
<span class="n">sqs</span> <span class="o">=</span> <span class="n">SearchQuerySet</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">Clean</span><span class="p">(</span><span class="s1">&#39;daniel OR jones&#39;</span><span class="p">))</span>

<span class="c1"># Things like ``:`` &amp; ``/`` get escaped.</span>
<span class="n">sqs</span> <span class="o">=</span> <span class="n">SearchQuerySet</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">Clean</span><span class="p">(</span><span class="s1">&#39;http://www.example.com&#39;</span><span class="p">))</span>

<span class="c1"># Equivalent (automatically wrapped in ``Clean``).</span>
<span class="n">sqs</span> <span class="o">=</span> <span class="n">SearchQuerySet</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://www.example.com&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="exact">
<h3><code class="docutils literal"><span class="pre">Exact</span></code><a class="headerlink" href="#exact" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="haystack.inputs.Exact">
<em class="property">class </em><code class="descclassname">haystack.inputs.</code><code class="descname">Exact</code><a class="headerlink" href="#haystack.inputs.Exact" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="docutils literal"><span class="pre">Exact</span></code> allows for making sure a phrase is exactly matched, unlike the usual
<code class="docutils literal"><span class="pre">AND</span></code> lookups, where words may be far apart.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sqs</span> <span class="o">=</span> <span class="n">SearchQuerySet</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">author</span><span class="o">=</span><span class="n">Exact</span><span class="p">(</span><span class="s1">&#39;n-gram support&#39;</span><span class="p">))</span>

<span class="c1"># Equivalent.</span>
<span class="n">sqs</span> <span class="o">=</span> <span class="n">SearchQuerySet</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">author__exact</span><span class="o">=</span><span class="s1">&#39;n-gram support&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="not">
<h3><code class="docutils literal"><span class="pre">Not</span></code><a class="headerlink" href="#not" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="haystack.inputs.Not">
<em class="property">class </em><code class="descclassname">haystack.inputs.</code><code class="descname">Not</code><a class="headerlink" href="#haystack.inputs.Not" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="docutils literal"><span class="pre">Not</span></code> allows negation of the query fragment it wraps. As <code class="docutils literal"><span class="pre">Not</span></code> is a subclass
of <code class="docutils literal"><span class="pre">Clean</span></code>, it will also sanitize the query.</p>
<p>This is generally only used internally. Most people prefer to use the
<code class="docutils literal"><span class="pre">SearchQuerySet.exclude</span></code> method.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sqs</span> <span class="o">=</span> <span class="n">SearchQuerySet</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">author</span><span class="o">=</span><span class="n">Not</span><span class="p">(</span><span class="s1">&#39;daniel&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="autoquery">
<h3><code class="docutils literal"><span class="pre">AutoQuery</span></code><a class="headerlink" href="#autoquery" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="haystack.inputs.AutoQuery">
<em class="property">class </em><code class="descclassname">haystack.inputs.</code><code class="descname">AutoQuery</code><a class="headerlink" href="#haystack.inputs.AutoQuery" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="docutils literal"><span class="pre">AutoQuery</span></code> takes a more complex user query (that includes simple, standard
query syntax bits) &amp; forms a proper query out of them. It also handles
sanitizing that query using <code class="docutils literal"><span class="pre">Clean</span></code> to ensure the query doesn’t break.</p>
<p><code class="docutils literal"><span class="pre">AutoQuery</span></code> accommodates for handling regular words, NOT-ing words &amp;
extracting exact phrases.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Against the main text field with an accidental &quot;:&quot; before &quot;search&quot;.</span>
<span class="c1"># Generates a query like ``haystack (NOT whoosh) &quot;fast search&quot;``</span>
<span class="n">sqs</span> <span class="o">=</span> <span class="n">SearchQuerySet</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">AutoQuery</span><span class="p">(</span><span class="s1">&#39;haystack -whoosh &quot;fast :search&quot;&#39;</span><span class="p">))</span>

<span class="c1"># Equivalent.</span>
<span class="n">sqs</span> <span class="o">=</span> <span class="n">SearchQuerySet</span><span class="p">()</span><span class="o">.</span><span class="n">auto_query</span><span class="p">(</span><span class="s1">&#39;haystack -whoosh &quot;fast :search&quot;&#39;</span><span class="p">)</span>

<span class="c1"># Fielded.</span>
<span class="n">sqs</span> <span class="o">=</span> <span class="n">SearchQuerySet</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">author</span><span class="o">=</span><span class="n">AutoQuery</span><span class="p">(</span><span class="s1">&#39;daniel -day -lewis&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="altparser">
<h3><code class="docutils literal"><span class="pre">AltParser</span></code><a class="headerlink" href="#altparser" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="haystack.inputs.AltParser">
<em class="property">class </em><code class="descclassname">haystack.inputs.</code><code class="descname">AltParser</code><a class="headerlink" href="#haystack.inputs.AltParser" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="docutils literal"><span class="pre">AltParser</span></code> lets you specify that a portion of the query should use a
separate parser in the search engine. This is search-engine-specific, so it may
decrease the portability of your app.</p>
<p>Currently only supported under Solr.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># DisMax.</span>
<span class="n">sqs</span> <span class="o">=</span> <span class="n">SearchQuerySet</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">AltParser</span><span class="p">(</span><span class="s1">&#39;dismax&#39;</span><span class="p">,</span> <span class="s1">&#39;haystack&#39;</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">mm</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># Prior to the spatial support, you could do...</span>
<span class="n">sqs</span> <span class="o">=</span> <span class="n">SearchQuerySet</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">AltParser</span><span class="p">(</span><span class="s1">&#39;dismax&#39;</span><span class="p">,</span> <span class="s1">&#39;haystack&#39;</span><span class="p">,</span> <span class="n">qf</span><span class="o">=</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="n">mm</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-your-own-input-types">
<h2>Creating Your Own Input Types<a class="headerlink" href="#creating-your-own-input-types" title="Permalink to this headline">¶</a></h2>
<p>Building your own input type is relatively simple. All input types are simple
classes that provide an <code class="docutils literal"><span class="pre">__init__</span></code> &amp; a <code class="docutils literal"><span class="pre">prepare</span></code> method.</p>
<p>The <code class="docutils literal"><span class="pre">__init__</span></code> may accept any <code class="docutils literal"><span class="pre">args/kwargs</span></code>, though the typical use usually
just involves a query string.</p>
<p>The <code class="docutils literal"><span class="pre">prepare</span></code> method lets you alter the query the user provided before it
becomes of the main query. It is lazy, called as late as possible, right before
the final query is built &amp; shipped to the engine.</p>
<p>A full, if somewhat silly, example looks like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">haystack.inputs</span> <span class="k">import</span> <span class="n">Clean</span>


<span class="k">class</span> <span class="nc">NoShoutCaps</span><span class="p">(</span><span class="n">Clean</span><span class="p">):</span>
    <span class="n">input_type_name</span> <span class="o">=</span> <span class="s1">&#39;no_shout_caps&#39;</span>
    <span class="c1"># This is the default &amp; doesn&#39;t need to be specified.</span>
    <span class="n">post_process</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Stash the original, if you need it.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original</span> <span class="o">=</span> <span class="n">query_string</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NoShoutCaps</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">query_string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_obj</span><span class="p">):</span>
        <span class="c1"># We need a reference to the current ``SearchQuery`` object this</span>
        <span class="c1"># will run against, in case we need backend-specific code.</span>
        <span class="n">query_string</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">NoShoutCaps</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">query_obj</span><span class="p">)</span>

        <span class="c1"># Take that, capital letters!</span>
        <span class="k">return</span> <span class="n">query_string</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="toc.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Input Types</a><ul>
<li><a class="reference internal" href="#available-input-types">Available Input Types</a><ul>
<li><a class="reference internal" href="#raw"><code class="docutils literal"><span class="pre">Raw</span></code></a></li>
<li><a class="reference internal" href="#clean"><code class="docutils literal"><span class="pre">Clean</span></code></a></li>
<li><a class="reference internal" href="#exact"><code class="docutils literal"><span class="pre">Exact</span></code></a></li>
<li><a class="reference internal" href="#not"><code class="docutils literal"><span class="pre">Not</span></code></a></li>
<li><a class="reference internal" href="#autoquery"><code class="docutils literal"><span class="pre">AutoQuery</span></code></a></li>
<li><a class="reference internal" href="#altparser"><code class="docutils literal"><span class="pre">AltParser</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-your-own-input-types">Creating Your Own Input Types</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="toc.html">Documentation overview</a><ul>
  <li><a href="index.html">Welcome to Haystack!</a><ul>
      <li>Previous: <a href="searchindex_api.html" title="previous chapter"><code class="docutils literal"><span class="pre">SearchIndex</span></code> API</a></li>
      <li>Next: <a href="searchfield_api.html" title="next chapter"><code class="docutils literal"><span class="pre">SearchField</span></code> API</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/inputtypes.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2009-2016, Daniel Lindsley.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/inputtypes.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>